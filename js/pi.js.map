{"version":3,"file":"pi.js","sources":["../src/pi.js"],"sourcesContent":["/*\n\tPlug-It - Heavily customise your Plug.dj experience.\n\n\tDeveloped by: WiBla <contact.wibla@gmail.com>\n\tCopyright (c) 2014-2017 WiBla.\n\n\tLiscenced under the GPL liscence:\n\n\tThis program is free software: you can redistribute it and/or modify\n\tit under the terms of the GNU General Public License as published by\n\tthe Free Software Foundation, either version 3 of the License, or\n\t(at your option) any later version.\n\n\tThis program is distributed in the hope that it will be useful,\n\tbut WITHOUT ANY WARRANTY; without even the implied warranty of\n\tMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n\tGNU General Public License for more details.\n\n\tYou should have received a copy of the GNU General Public License\n\talong with this program. If not, see <http://www.gnu.org/licenses/>.\n\n\tSpecial thanks to:\n\t\t- All the alpha & beta testers !\n\t\t- Hideki for creating such an amazing community and helping me at the very beginning.\n\t\t- Zurbo, So much to say.. Thank you for supporting and helping me everyday.\n\t\t- Sinful for being so kind and teaching me how to use CSS attribute selectors.\n\t\t- TheDark1337 for always answering my silly questions about javascript and his script.\n\t\t- Dano-em for making me love jQuery.\n\t\t- The creators & maintainers of this repository: https://github.com/plugcommunity/documentation\n\t\t  for putting together such an amazing source of documentation.\n\n\tLibrary Used:\n\t\tPlug's Front-End API\n\t\t  -> http://support.plug.dj/hc/en-us/sections/200353347-Front-End-API\n\t\tjQuery\n\t\t  -> https://jquery.com\n\t\tRequireJS\n\t\t  -> http://requirejs.org\n\t\tExtPlug Socket Intercept\n\t\t\t-> https://github.com/extplug/ExtPlug/blob/master/src/plugins/SocketEventsPlugin.js\n\n\tInspired by:\n\t\tplugÂ³ https://plugcubed.net/\n\t\t\t- Clear chat and toggle stream button\n\t\t\t- AFK autorespond\n\t\t\t- Room settings\n\t\t\t- Third party emotes\n\t\tRadiant Community Script https://rcs.radiant.dj/\n\t\t\t- Loading status box\n\t\t\t- Custom background\n\t\t\t- Prevent Accidental Navigation\n\t\t\t- Alternative visualizers\n\t\t\t- Chat limit\n\t\t\t- Inline user info\n\t\t\t- Show deleted chat\n\t\t\t- /fire /love /shrug commands\n\t\tOrigem Woot (No longer available)\n\t\t\t- Vote list\n\t\t\t- Booth alert\n\t\t\t- /Whois & /Whoami commands\n\t\tDerpgonCz's unavailable song search\n\t\t\tLink: https://github.com/DerpgonCz/plug.dj-scripts/blob/master/scripts/unavailable-songs.js\n\t\tplugmixer https://github.com/Sunxperous/plugmixer\n\t\t\t- Playlist mixing\n\t\tTastyPlug https://tastyplug.tastycat.org/\n\t\t\t- Menu UI & UX\n\t\t\t- Hide video\n\n\t\tI also recommend these scripts as an alternative:\n\t\t\t- plug_p0ne https://p0ne.com/plug_p0ne/\n\t\t\t\tVery powerfull and full of goodness !\n\t\t\t- ExtPlug https://extplug.github.io/\n\t\t\t\tInstall plugins with a simple link or make one yourself !\n\t\t\t\t(In beta but dev. very active !)\n*/\n\nimport { version as _version } from '../package.json'\nlet _v = _version\nlet pre = null;\nif (_v.indexOf('-')) {\n\t[_v, pre] = _v.split('-');\n}\n\nconst [major, minor, patch] = _v.split('.')\n\nconst version = {\n\tmajor,\n\tminor,\n\tpatch,\n\tpre\n}\n\nconst branch = pre ? 'pre-release' : 'master';\n\nconst root = `https://rawgit.com/Plug-It/pi/${branch}`;\n\n(function load() {\n\tvar isPlugRoom = /(http(?:s)?:\\/\\/(?:[a-z]+\\.)*plug\\.dj\\/)(?!about$|ba$|forgot-password$|founders$|giftsub\\/\\d|jobs$|legal$|merch$|partners$|plot$|privacy$|purchase$|subscribe$|team$|terms$|press$|_\\/|@\\/|!\\/)(.+)/i;\n\tif (isPlugRoom.test(location.href)) {\n\t\tif (typeof window.pi !== 'undefined') window.pi._reload();\n\t\telse if (plugReady()) {\n\t\t\t// Status (can be used to debug)\n\t\t\t$('.app-header').after($(\n\t\t\t\t'<div id=\"pi-status\">'+\n\t\t\t\t\t'<img height=\"30px\" src=\"https://raw.githubusercontent.com/Plug-It/pi/pre-release/img/other/icon-54.png\">'+\n\t\t\t\t\t'<span></span>'+\n\t\t\t\t'</div>').css({\n\t\t\t\t\t\"position\": \"absolute\",\n\t\t\t\t\t\"top\": \"65px\", \"right\": \"355px\",\n\t\t\t\t\t\"text-align\": \"right\",\n\t\t\t\t\t\"padding\": \"5px\",\n\t\t\t\t\t\"background\": \"rgb(24, 28, 33)\",\n\t\t\t\t\t\"color\": \"rgb(221, 221, 221)\",\n\t\t\t\t\t\"border-radius\": \"5px\",\n\t\t\t\t\t\"box-shadow\": \"rgb(0, 0, 0) 0px 0px 3px\",\n\t\t\t\t\t\"transition\": \"all 0.25s ease-in-out\",\n\t\t\t\t\t\"z-index\": \"1337\"\n\t\t\t\t})\n\t\t\t);\n\t\t\tfunction updateStatus(txt, status) {\n\t\t\t\t$('#pi-status span')[0].innerHTML = 'PI is loading..<br>'+txt+'<br>Status: '+status;\n\t\t\t}\n\n\t\t\t// Get last commit of any project, used to know if an update is available\n\t\t\tfunction getLastCommit(url, callback) {\n\t\t\t\t$.ajax({\n\t\t\t\t\turl: url,\n\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\tcallback(data);\n\t\t\t\t\t},\n\t\t\t\t\terror: function(e) {\n\t\t\t\t\t\tconsole.error('Failed to load commits for Plug-it from GitHub. Auto-update is therefore unavailable.\\n' + e);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\tgetLastCommit('https://api.github.com/repos/Plug-It/pi/commits/pre-release', function(data) {\n\t\t\t\twindow.thisCommit = data;\n\t\t\t});\n\n\t\t\t// Load user language\n\t\t\tvar lang, ranks, roomSettings;\n\t\t\tupdateStatus('Loading language', 1);\n\t\t\tswitch (API.getUser().language) {\n\t\t\t\tcase 'cs': lang = 'cs'; break;\n\t\t\t\tcase 'de': lang = 'de'; break;\n\t\t\t\tcase 'et': lang = 'et'; break;\n\t\t\t\tcase 'fr': lang = 'fr'; break;\n\t\t\t\tcase 'nl': lang = 'nl'; break;\n\t\t\t\tcase 'pl': lang = 'pl'; break;\n\t\t\t\tcase 'pt': lang = 'pt'; break;\n\t\t\t\tcase 'sl': lang = 'sl'; break;\n\t\t\t\tcase 'sv': lang = 'sv'; break;\n\t\t\t\tdefault: lang = 'en'; break;\n\t\t\t}\n\t\t\t$.ajax({\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: `${root}/lang/${lang}.json`,\n\t\t\t\tsuccess: function(data) {\n\t\t\t\t\tlang = data;\n\t\t\t\t},\n\t\t\t\terror: function(e) {\n\t\t\t\t\tconsole.log('[Plug-It] Error while loading translation:\\n', e);\n\t\t\t\t\tAPI.chatLog('[Plug-It] Error while loading translation: ' + e.statusText + '. Check the console for more info.');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Load script ranks\n\t\t\tupdateStatus('Loading script ranks', 2);\n\t\t\t$.ajax({\n\t\t\t\tdataType: 'json',\n\t\t\t\turl: 'https://rawgit.com/Plug-It/pi/pre-release/json/ranks.json',\n\t\t\t\tsuccess: function(data) {\n\t\t\t\t\tranks = data;\n\t\t\t\t\tinit();\n\t\t\t\t},\n\t\t\t\terror: function(e) {\n\t\t\t\t\tconsole.log('[Plug-It] Error while loading script ranks:\\n', e);\n\t\t\t\t\tAPI.chatLog('[Plug-It] Error while loading script ranks: ' + e.statusText + '. Check the console for more info.');\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tsetTimeout(load, 10);\n\t\t}\n\n\t\tfunction plugReady() {\n\t\t\treturn typeof API !== 'undefined' && API.enabled && typeof jQuery !== 'undefined' && typeof require !== 'undefined';\n\t\t}\n\n\t\tfunction init() {\n\t\t\tif (typeof lang !== 'object' || typeof ranks !== 'object') return setTimeout(init, 10);\n\n\t\t\tconst startTime = new Date().getTime();\n\t\t\tconst delay = (API.getUser().gRole >= API.ROLE.MANAGER ? 200 : 3500);\n\t\t\tconst CHAT_INTERCEPT_STRING = `Plug-It Socket Intercept: ${Math.random()}`;\n\t\t\tconst YTAPIkey = 'AIzaSyC8pk0f57a_UcAIbHdrvRhsmHSG1KZk2SM';\n\t\t\tconst url = {\n\t\t\t\tscript: 'https://rawgit.com/Plug-It/pi/pre-release/js/pi.js',\n\t\t\t\tstyles: {\n\t\t\t\t\tblue_css: 'https://rawgit.com/Plug-It/pi/pre-release/css/blue.css',\n\t\t\t\t\tmenu_css: 'https://rawgit.com/Plug-It/pi/pre-release/css/menu.css',\n\t\t\t\t\tpopout: 'https://rawgit.com/Plug-It/pi/pre-release/css/popout.css',\n\t\t\t\t\tpopout_blue: 'https://rawgit.com/Plug-It/pi/pre-release/css/popout-blue.css',\n\t\t\t\t\tcustom_ranks: 'https://rawgit.com/Plug-It/pi/pre-release/css/custom-ranks.css',\n\t\t\t\t\told_chat: 'https://rawgit.com/Plug-It/pi/pre-release/css/old-chat.css',\n\t\t\t\t\told_footer: 'https://rawgit.com/Plug-It/pi/pre-release/css/old-footer.css',\n\t\t\t\t\tsmall_history: 'https://rawgit.com/Plug-It/pi/pre-release/css/small-history.css',\n\t\t\t\t\tsmall_friends: 'https://rawgit.com/Plug-It/pi/pre-release/css/small-friends.css',\n\t\t\t\t\tsmall_playlists: 'https://rawgit.com/Plug-It/pi/pre-release/css/small-playlists.css'\n\t\t\t\t},\n\t\t\t\timages: {\n\t\t\t\t\tbackground: 'https://raw.githubusercontent.com/Plug-It/pi/pre-release/img/background/non-official/Plug-It-old.jpg'\n\t\t\t\t},\n\t\t\t\tsounds: {\n\t\t\t\t\t// https://www.freesound.org/people/TheGertz/sounds/235911/\n\t\t\t\t\tnotification:  'https://raw.githubusercontent.com/Plug-It/pi/pre-release/sounds/notification.wav',\n\t\t\t\t\t// https://www.freesound.org/people/soneproject/sounds/255102/\n\t\t\t\t\tjingle:        'https://raw.githubusercontent.com/Plug-It/pi/pre-release/sounds/jingle.wav'\n\t\t\t\t},\n\t\t\t\tvisu: [\n\t\t\t\t\t'https://rawgit.com/WiBla/visu/master/hyperspace/index.html',\n\t\t\t\t\t'https://rawgit.com/WiBla/visu/master/hyperspace2/index.html',\n\t\t\t\t\t'https://rawgit.com/WiBla/visu/master/hyperspace2/index.html?color=random',\n\t\t\t\t\t'https://rawgit.com/WiBla/visu/master/pong/index.html'\n\t\t\t\t],\n\t\t\t\temotes: {\n\t\t\t\t\t'twitch': 'https://twitchemotes.com/api_cache/v2/global.json',\n\t\t\t\t\t'twitchSub': 'https://twitchemotes.com/api_cache/v2/subscriber.json',\n\t\t\t\t\t'betterDiscord': 'https://raw.githubusercontent.com/Jiiks/BetterDiscordApp/master/data/emotedata_bttv.json',\n\t\t\t\t\t'betterTTV': 'https://api.betterttv.net/emotes',\n\t\t\t\t\t'tasty': 'https://emotes.tastycat.org/emotes-full.json'\n\t\t\t\t}\n\t\t\t};\n\t\t\tvar settings = {\n\t\t\t\t// General\n\t\t\t\tautoW: false,\n\t\t\t\tautoDJ: false,\n\t\t\t\tkeyboardShortcuts: false,\n\t\t\t\tchatCommands: true,\n\t\t\t\tautoHideLogs: false,\n\t\t\t\tautoHideLogsAfter: 10,\n\t\t\t\tbetterMeh: false,\n\t\t\t\tnavWarn: false,\n\t\t\t\tafk: false,\n\t\t\t\tafkMessage: null,\n\t\t\t\tshowVotes: false,\n\t\t\t\tbetterClearChatLimit: 5,\n\t\t\t\tchatLimit: 512,\n\t\t\t\tskipNextMediaInHistory: false,\n\t\t\t\t// Customisation\n\t\t\t\tshowVideo: true,\n\t\t\t\tscVisu: false,\n\t\t\t\troomStyle: true,\n\t\t\t\tCSS: false,\n\t\t\t\tcustomRanks: false,\n\t\t\t\tlanguageFlags: false,\n\t\t\t\tfriendsIcons: false,\n\t\t\t\tcustomBG: false,\n\t\t\t\tcustomBGURL: null,\n\t\t\t\toldChat: false,\n\t\t\t\toldFooter: false,\n\t\t\t\tsmallHistory: false,\n\t\t\t\tsmallFriends: false,\n\t\t\t\tsmallPlaylists: false,\n\t\t\t\t// Moderation\n\t\t\t\tshowDeletedMsg: false,\n\t\t\t\tconfirmDelete: false,\n\t\t\t\tgRoleCmdSelfDel: true,\n\t\t\t\tuserInfo: false,\n\t\t\t\tstuckSkip: false,\n\t\t\t\tsongLimit: false,\n\t\t\t\tsongLength: 420, // Blaze-it\n\t\t\t\thistoryAlert: false,\n\t\t\t\t// Notifications\n\t\t\t\tsystemNotifications: false,\n\t\t\t\tsongStats: false,\n\t\t\t\tuserJoin: false,\n\t\t\t\tuserLeave: false,\n\t\t\t\tboothAlert: false,\n\t\t\t\tboothPosition: 3,\n\t\t\t\tuserMeh: false,\n\t\t\t\tuserGrab: false,\n\t\t\t\tguestJoin: false,\n\t\t\t\tguestLeave: false,\n\t\t\t\tfriendRoomChange: false,\n\t\t\t\tfriendConnect: false,\n\t\t\t\tfriendDisconnect: false,\n\t\t\t\tunfriended: false,\n\t\t\t\tfriendEventsList: {\n\t\t\t\t\twhiteList: {\n\t\t\t\t\t\tactive: false\n\t\t\t\t\t},\n\t\t\t\t\tblacklist: {\n\t\t\t\t\t\tactive: true,\n\t\t\t\t\t\tusers: {\n\t\t\t\t\t\t\t\"3537523\": {\n\t\t\t\t\t\t\t\troomChange: false,\n\t\t\t\t\t\t\t\tconnect: false,\n\t\t\t\t\t\t\t\tdisconnect: false,\n\t\t\t\t\t\t\t\tunfriended: true,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgainNotification: false,\n\t\t\t\tminimumGain: {\n\t\t\t\t\txp: 1,\n\t\t\t\t\tpp: 2,\n\t\t\t\t},\n\t\t\t\tuserLevelUp: false,\n\t\t\t\t// Custom Roles\n\t\t\t\tbot: [5285179],\n\t\t\t\tdiscordbot: [20852061]\n\t\t\t};\n\t\t\tvar roomSettings = {};\n\t\t\tvar cooldown = {\n\t\t\t\t'afkResponder': startTime - 60*1000,\n\t\t\t\t'voteShortcut': startTime - 5000\n\t\t\t};\n\t\t\tvar emotes = {};\n\t\t\tvar modules = {};\n\t\t\tvar session = {\n\t\t\t\tunread: false, // used to notify on unread messages + window blurred\n\t\t\t\tfloodAPI: false,\n\t\t\t\twoots: API.getUsers().filter(x => x.vote == 1),\n\t\t\t\tgrabs: API.getUsers().filter(x => x.grab),\n\t\t\t\tmehs:  API.getUsers().filter(x => x.vote == -1),\n\t\t\t\tchat: []\n\t\t\t};\n\n\t\t\t// Prototypes\n\t\t\tNumber.prototype.spaceOut = function() {\n\t\t\t\tif (isNaN(this) || this < 999) return this;\n\t\t\t\treturn (this).toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \".\");\n\t\t\t};\n\t\t\tfunction meldBefore(object, property, cb) {\n\t\t\t\tconst originalFunction = object[property];\n\n\t\t\t\tobject[property] = function wrapped() {\n\t\t\t\t\tcb(arguments[0]);\n\t\t\t\t\toriginalFunction.call(object, arguments[0]);\n\t\t\t\t}\n\n\t\t\t\treturn {\n\t\t\t\t\tremove: function() {\n\t\t\t\t\t\tobject[property] = originalFunction;\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t};\n\t\t\t// gives the user all permissions client-side temporarily, to make sure that\n\t\t\t// a chat message will actually be passed to the socket.\n\t\t\tfunction sudo(cb) {\n\t\t\t\tconst originalUser = modules.user.toJSON();\n\t\t\t\tmodules.user.set({\n\t\t\t\t\tid: 1,\n\t\t\t\t\tguest: false,\n\t\t\t\t\tlevel: 50,\n\t\t\t\t\trole: API.ROLE.HOST,\n\t\t\t\t\tgRole: API.ROLE.HOST,\n\t\t\t\t}, { silent: true });\n\n\t\t\t\tconst originalRoom = _.pick(modules.room.toJSON(), 'joined', 'minChatLevel');\n\t\t\t\tmodules.room.set({\n\t\t\t\t\tjoined: true,\n\t\t\t\t\tminChatLevel: 0,\n\t\t\t\t}, { silent: true });\n\n\t\t\t\t// this forces the chat slowmode cooldown timer to always return 0, thus\n\t\t\t\t// working around slowmode\n\t\t\t\tconst originalMax = Math.max;\n\t\t\t\tMath.max = () => 0;\n\n\t\t\t\tcb();\n\n\t\t\t\tMath.max = originalMax;\n\t\t\t\tmodules.room.set(originalRoom, { silent: true });\n\t\t\t\tmodules.user.set(originalUser, { silent: true });\n\t\t\t}\n\t\t\tfunction getSocket() {\n\t\t\t\t// If RCS is loaded and already has a reference to the WebSocket, just use\n\t\t\t\t// that.\n\t\t\t\tif (window.rcs && window.rcs.plugSock &&\n\t\t\t\t\twindow.rcs.plugSock.sock instanceof WebSocket) {\n\t\t\t\t\treturn window.rcs.plugSock.sock;\n\t\t\t\t}\n\n\t\t\t\tconst send = WebSocket.prototype.send;\n\t\t\t\tlet socket;\n\t\t\t\tWebSocket.prototype.send = function sendIntercept(data) {\n\t\t\t\t\tif (this.url.indexOf('plug.dj') !== -1 && data.indexOf(CHAT_INTERCEPT_STRING) !== -1) {\n\t\t\t\t\t\tsocket = this;\n\t\t\t\t\t\tWebSocket.prototype.send = send;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsend.call(this, data);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tsudo(() => {\n\t\t\t\t\tmodules.chatFacade.sendChat(CHAT_INTERCEPT_STRING);\n\t\t\t\t});\n\n\t\t\t\t// restore even if it didn't work\n\t\t\t\tWebSocket.prototype.send = send;\n\n\t\t\t\treturn socket;\n\t\t\t}\n\n\t\t\twindow.pi = {\n\t\t\t\tversion,\n\t\t\t\t_event: {\n\t\t\t\t\tadvance: function(song) {\n\t\t\t\t\t\t/* contains = {\n\t\t\t\t\t\t\tdj: {userObject},\n\t\t\t\t\t\t\tmedia: {\n\t\t\t\t\t\t\t\tauthor,\n\t\t\t\t\t\t\t\tcid,\n\t\t\t\t\t\t\t\tduration,\n\t\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\timage,\n\t\t\t\t\t\t\t\ttitle\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tlastPlay: {\n\t\t\t\t\t\t\t\tdj: {userObject},\n\t\t\t\t\t\t\t\tmedia: {},\n\t\t\t\t\t\t\t\tscore: {\n\t\t\t\t\t\t\t\t\tgrabs: x,\n\t\t\t\t\t\t\t\t\tpositive: y,\n\t\t\t\t\t\t\t\t\tnegative: z\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}; */\n\n\t\t\t\t\t\tpi.autojoin();\n\n\t\t\t\t\t\t// Checking if a media is playing\n\t\t\t\t\t\tif (!song.dj || !song.media) return;\n\n\t\t\t\t\t\tif (API.getUser().id !== song.dj.id) {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\tpi.autowoot();\n\t\t\t\t\t\t\t}, Math.ceil((Math.random()*10)*1000));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tpi.songLimit();\n\t\t\t\t\t\tpi.soundcloudVisu(song.media);\n\n\t\t\t\t\t\tif (settings.songStats) {\n\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.info.songStats, {\n\t\t\t\t\t\t\t\t\tdj: song.lastPlay.dj.username,\n\t\t\t\t\t\t\t\t\tauthor: song.lastPlay.media.author,\n\t\t\t\t\t\t\t\t\ttitle: song.lastPlay.media.title,\n\t\t\t\t\t\t\t\t\twoots: song.lastPlay.score.positive,\n\t\t\t\t\t\t\t\t\tgrabs: song.lastPlay.score.grabs,\n\t\t\t\t\t\t\t\t\tmehs: song.lastPlay.score.negative\n\t\t\t\t\t\t\t\t}), 'info chat'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (settings.stuckSkip && API.hasPermission(null, API.ROLE.BOUNCER)) {\n\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t// verifying the song is the same AND setting is still enbaled\n\t\t\t\t\t\t\t\tif (song.media.cid === API.getMedia().cid && settings.stuckSkip) {\n\t\t\t\t\t\t\t\t\tAPI.sendChat(lang.userchat.songStuck);\n\t\t\t\t\t\t\t\t\tAPI.moderateForceSkip();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}, song.media.duration*1000 + 5000);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Checking if the next media is in room history\n\t\t\t\t\t\t// This is on a timeout because this can happen:\n\t\t\t\t\t\t// http://i.imgur.com/kAy7QRN.png (only when after\n\t\t\t\t\t\t// your own play due to playlist refreshing,\n\t\t\t\t\t\t// thanks ReAnna fot this info BTW !)\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\tif (settings.skipNextMediaInHistory && API.getWaitListPosition() === 0 && API.getNextMedia().inHistory &&!floodAPI) {\n\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\turl: '/_/playlists/'+API.getActivePlaylist().id+'/media/move',\n\t\t\t\t\t\t\t\t\ttype: 'PUT',\n\t\t\t\t\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\t\t\t\t\tbeforeID: -1,\n\t\t\t\t\t\t\t\t\t\tids: [API.getNextMedia().media.id]\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tsuccess: function() {\n\t\t\t\t\t\t\t\t\t\tpi._tool.log(lang.info.nextMediaSkip, 'info chat');\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\terror: function() {\n\t\t\t\t\t\t\t\t\t\tpi._tool.log(lang.warn.nextMediaInHistory, 'warn chat');\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\t\t\tcontentType: 'application/json'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 10000);\n\n\t\t\t\t\t\tsessionStorage.setItem('modSkipWarn', 'false');\n\t\t\t\t\t\tsessionStorage.setItem('modQuitWarn', 'false');\n\t\t\t\t\t},\n\t\t\t\t\tchat: function(msg) {\n\t\t\t\t\t\t/* contains = {\n\t\t\t\t\t\t\tcid,\n\t\t\t\t\t\t\tmessage,\n\t\t\t\t\t\t\tsub,\n\t\t\t\t\t\t\ttimestamp,\n\t\t\t\t\t\t\ttype,\n\t\t\t\t\t\t\tuid,\n\t\t\t\t\t\t\tun\n\t\t\t\t\t\t}; */\n\n\t\t\t\t\t\tif (msg.type === 'log') return;\n\t\t\t\t\t\t// This message node\n\t\t\t\t\t\tlet selector = '#chat [data-cid=\"'+msg.cid+'\"]';\n\t\t\t\t\t\tlet sender = API.getUser(msg.uid);\n\n\t\t\t\t\t\t// Second message from the same user, things that only are set once\n\t\t\t\t\t\tif ($(selector).length) {\n\t\t\t\t\t\t\t// Self Deletion Magic\n\t\t\t\t\t\t\tif (msg.uid == API.getUser().id && API.hasPermission(null, API.ROLE.BOUNCER)) {\n\t\t\t\t\t\t\t\t$(selector)[0].className += ' deletable';\n\t\t\t\t\t\t\t\t$(selector).prepend('<div class=\"delete-button\" style=\"display: none;\">'+lang.glossary.delete+'</div>');\n\t\t\t\t\t\t\t\t$(selector).on('mouseenter', function() {\n\t\t\t\t\t\t\t\t\tif ($(selector).find('.delete-button').length) {\n\t\t\t\t\t\t\t\t\t\t$(selector).find('.delete-button')[0].style.display = 'block';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t$(selector).on('mouseleave', function() {\n\t\t\t\t\t\t\t\t\tif ($(selector).find('.delete-button').length) {\n\t\t\t\t\t\t\t\t\t\t$(selector).find('.delete-button')[0].style.display = 'none';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t$(selector).find('.delete-button').on('click', function() {\n\t\t\t\t\t\t\t\t\tAPI.moderateDeleteChat(msg.cid);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Deletion confirmation\n\t\t\t\t\t\t\tif (settings.confirmDelete) {\n\t\t\t\t\t\t\t\t$(selector + ' .delete-button').off('click');\n\t\t\t\t\t\t\t\t$(selector + ' .delete-button').on('click', function(e) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\tif (e.shiftKey) return API.moderateDeleteChat(msg.cid);\n\t\t\t\t\t\t\t\t\tpi._tool.modal(true, 'confirmDelete', function() {\n\t\t\t\t\t\t\t\t\t\tAPI.moderateDeleteChat(msg.cid);\n\t\t\t\t\t\t\t\t\t}, msg);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t/* Chat images\n\t\t\t\t\t\t\tvar links = $(\"<div>\"+msg.message+\"</div>\").find('a');\n\t\t\t\t\t\t\tvar imgRE = new RegExp('(http(s)?:\\/\\/(www.)?).+\\.(jpg|jpeg|gif|png|svg|bmp)', 'ig');\n\t\t\t\t\t\t\tfor (var i = 0; i < link.length; i++) {\n\t\t\t\t\t\t\t\tvar result = links[i].innerText.match(imgRE);\n\t\t\t\t\t\t\t\tif (typeof result !== 'null' && result.length > 0) {\n\t\t\t\t\t\t\t\t\tvar before = links[0].previousSibling;\n\t\t\t\t\t\t\t\t\tvar after = links[0].nextSibling;\n\t\t\t\t\t\t\t\t\tlinks[i].innerHTML = '<img alt=\"'+links[i].innerText+'\" src=\"'+links[i].innerText+'\">';\n\t\t\t\t\t\t\t\t\tmsg.message = before + links[i] + after;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$(selector).find(\".text\")[0].innerHTML = msg.message;\n\t\t\t\t\t\t*/\n\n\t\t\t\t\t\t// Server chat commands\n\t\t\t\t\t\tif (['Dev', 'Community Manager'].indexOf(pi._tool.getRank(sender.id)) !== -1) {\n\t\t\t\t\t\t\tswitch(msg.message) {\n\t\t\t\t\t\t\t\tcase '!strobe on':\n\t\t\t\t\t\t\t\tif (!$('#pi-strobe').length) {\n\t\t\t\t\t\t\t\t\tvar $strobe = $('<style id=\"pi-strobe\">@keyframes strobe{0%{-webkit-filter:brightness(200%);filter:brightness(200%)}10%{-webkit-filter:brightness(10%);filter:brightness(10%)}}@keyframes strobe2{0%{box-shadow:0 20px 200px #fff}10%{box-shadow:none}}#avatars-container,#dj-button,#vote,.room-background,#pi-background{-webkit-filter:brightness(10%);filter:brightness(10%)}#avatars-container{animation:strobe .45s linear infinite}#playback-container{box-shadow:none!important;animation:strobe2 .45s linear infinite}</style>');\n\t\t\t\t\t\t\t\t\t$('head').append($strobe);\n\t\t\t\t\t\t\t\t\tpi._tool.log(pi._tool.replaceString(lang.log.strobeOn, {user: sender.username}), 'chat');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '!strobe off':\n\t\t\t\t\t\t\t\tif ($('#pi-strobe').length) {\n\t\t\t\t\t\t\t\t\t$('#pi-strobe')[0].remove();\n\t\t\t\t\t\t\t\t\tpi._tool.log(pi._tool.replaceString(lang.log.strobeOff, {user: sender.username}), 'chat');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '!rainbow on':\n\t\t\t\t\t\t\t\tif (!$('#pi-rainbow').length) {\n\t\t\t\t\t\t\t\t\tvar $rainbow = $('<style id=\"pi-rainbow\">@keyframes rainbow {from {-webkit-filter: saturate(200%) hue-rotate(0deg);filter: saturate(200%) hue-rotate(0deg);}to {-webkit-filter: saturate(200%) hue-rotate(360deg);filter: saturate(200%) hue-rotate(360deg);}}body {animation: rainbow 3s linear infinite;}</style>');\n\t\t\t\t\t\t\t\t\t$('head').append($rainbow);\n\t\t\t\t\t\t\t\t\tpi._tool.log(pi._tool.replaceString(lang.log.rainbowOn, {user: sender.username}), 'chat');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '!rainbow off':\n\t\t\t\t\t\t\t\tif ($('#pi-rainbow').length) {\n\t\t\t\t\t\t\t\t\t$('#pi-rainbow')[0].remove();\n\t\t\t\t\t\t\t\t\tpi._tool.log(pi._tool.replaceString(lang.log.rainbowOff, {user: sender.username}), 'chat');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// !joindisable & !afkdisable\n\t\t\t\t\t\t// Different codeStyle because direcrly inspired by p3\n\t\t\t\t\t\tlet a = msg.type === 'mention' && API.hasPermission(msg.uid, API.ROLE.BOUNCER);\n\t\t\t\t\t\tlet b = msg.message.indexOf('@') < 0 && (API.hasPermission(msg.uid, API.ROLE.MANAGER) || ['Dev', 'Community Manager'].indexOf(pi._tool.getRank(sender.id)) !== -1)\n\t\t\t\t\t\tif (a || b) {\n\t\t\t\t\t\t\tif (msg.message.indexOf('!joindisable') > -1 && settings.autoDJ) {\n\t\t\t\t\t\t\t\tpi.menu('join');\n\t\t\t\t\t\t\t\tAPI.sendChat(`@${msg.un} Auto-join disabled!`);\n\t\t\t\t\t\t\t} else if (msg.message.indexOf('!afkdisable') > -1 && settings.afk) {\n\t\t\t\t\t\t\t\tpi.menu('afkResponder');\n\t\t\t\t\t\t\t\tAPI.sendChat(`@${msg.un} AFK responder disabled!`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// Auto AFK responder with 60s cooldown (prevents spam)\n\t\t\t\t\t\tif (((msg.sound && msg.sound === \"mention\") || msg.type == 'mention') &&\n\t\t\t\t\t\t    msg.uid !== API.getUser().id &&\n\t\t\t\t\t\t    settings.afk &&\n\t\t\t\t\t\t    pi._tool.getRoomRules('allowAutorespond') &&\n\t\t\t\t\t\t    (new Date().getTime() - cooldown.afkResponder)/1000/60 > 1) {\n\t\t\t\t\t\t\tif (settings.afkMessage.length) API.sendChat('@'+msg.un + ' [AFK]: '+settings.afkMessage);\n\t\t\t\t\t\t\telse API.sendChat(pi._tool.replaceString(lang.userchat.afkResponder, {mention: msg.un}));\n\t\t\t\t\t\t\tcooldown.afkResponder = new Date().getTime();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// System notifications on mention and window blured\n\t\t\t\t\t\telse if (((msg.sound && msg.sound === \"mention\") || msg.type == 'mention') &&\n\t\t\t\t\t\t\tsettings.systemNotifications && !document.hasFocus() && !settings.afk) {\n\t\t\t\t\t\t\tpi._tool.notify(\n\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.notifications.mentioned, {user: sender.username}),\n\t\t\t\t\t\t\t\t// removing all unwanted html tags (like emoji)\n\t\t\t\t\t\t\t\t$(\"<div>\"+msg.message+\"</div>\").text()+'\\n\\n'+lang.notifications.reply,\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tonclick: function() {window.focus(); this.close();},\n\t\t\t\t\t\t\t\t\tonerror: function(e){console.log(e);}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If chat not visible, indicate there is new message to read\n\t\t\t\t\t\telse if (!$('#chat-button').hasClass(\"selected\") && msg.type !== 'log') {\n\t\t\t\t\t\t\t$('#chat-button, ' + selector).each(\n\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t$(this).css('transition', 'all .5s');\n\t\t\t\t\t\t\t\t\t$(this)[0].className += ' unread';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// Bind click event once to mark as read\n\t\t\t\t\t\t\t$('#chat-button').one('click', function() {\n\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t$('#chat-button, ' + selector).removeClass('unread');\n\t\t\t\t\t\t\t\t\t// Remove transition only when transition is finished\n\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t$('#chat-button, ' + selector).css('transition', '');\n\t\t\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t\t\t}, 3*1000);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// If WINDOW blurred, prepend page title with asterics to indicate new messages\n\t\t\t\t\t\tif (msg.type !== 'log' && !document.hasFocus() && !session.unread) {\n\t\t\t\t\t\t\tsession.unread = true;\n\t\t\t\t\t\t\tdocument.title = \"* \" + API.getRoomName();\n\t\t\t\t\t\t\twindow.onfocus = function() {\n\t\t\t\t\t\t\t\tdocument.title = API.getRoomName();\n\t\t\t\t\t\t\t\tsession.unread = false;\n\t\t\t\t\t\t\t\twindow.onfocus = undefined;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsession.chat.push(msg);\n\t\t\t\t\t},\n\t\t\t\t\tchatCommand: function(cmd) {\n\t\t\t\t\t\t// contains = \"/command and arguments\";\n\n\t\t\t\t\t\tif (!settings.chatCommands) return;\n\n\t\t\t\t\t\tvar args = cmd.split(' ');\n\t\t\t\t\t\tcmd = args.shift().slice(1);\n\t\t\t\t\t\tvar msg = args.join(' ');\n\n\t\t\t\t\t\tswitch (cmd) {\n\t\t\t\t\t\t\tcase 'r':\n\t\t\t\t\t\t\t\tlet lastMention = $('.cm.mention:last');\n\n\t\t\t\t\t\t\t\tif (lastMention.length !== 0) {\n\t\t\t\t\t\t\t\t\tlet user = API.getUser(lastMention[0].getAttribute('data-cid').split('-')[0]);\n\t\t\t\t\t\t\t\t\tAPI.sendChat('@'+user.username +' '+msg);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tpi._tool.log(lang.error.noLastMention, 'chat error');\n\t\t\t\t\t\t\t\t\t$('#chat-input-field')[0].value = msg;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'like':\n\t\t\t\t\t\t\t\tAPI.sendChat('ððððð');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'love':\n\t\t\t\t\t\t\t\tif (!msg.length) API.sendChat('ðððððððððð');\n\t\t\t\t\t\t\t\telse API.sendChat(msg + ' ðððððððððð');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'lovespam':\n\t\t\t\t\t\t\t\tlet i = 1;\n\n\t\t\t\t\t\t\t\tlet uInt = setInterval(() => {\n\t\t\t\t\t\t\t\t\tif (i > 5) clearInterval(uInt);\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\tif (i%2 == 0) API.sendChat('ððððð');\n\t\t\t\t\t\t\t\t\t\telse API.sendChat('ððððð');\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\ti++;\n\t\t\t\t\t\t\t\t}, 500);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'door':\n\t\t\t\t\t\t\t\tif (!msg.length) API.sendChat('ðª');\n\t\t\t\t\t\t\t\telse API.sendChat(msg + ' ðª');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'doorrun':\n\t\t\t\t\t\t\t\tif (!msg.length) API.sendChat('ðª ð');\n\t\t\t\t\t\t\t\telse API.sendChat(msg + ' ðª ð');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'fire':\n\t\t\t\t\t\t\t\tAPI.sendChat('ð¥ð¥ð¥ð¥ð¥ð¥ð¥ð¥ð¥ð¥');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'kong':\n\t\t\t\t\t\t\t\tAPI.sendChat(':kong::kong::kong::kong::kong::kong::kong:');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'shrug':\n\t\t\t\t\t\t\t\tif (!msg.length) API.sendChat('Â¯\\\\_(ã)_/Â¯');\n\t\t\t\t\t\t\t\telse API.sendChat(msg + ' Â¯\\\\_(ã)_/Â¯');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'friend':\n\t\t\t\t\t\t\t\tif (!args[0]) return pi._tool.log(lang.info.helpUserOrId, 'info chat');\n\t\t\t\t\t\t\t\telse if (isNaN(args[0])) {\n\t\t\t\t\t\t\t\t\targs[0] = API.getUserByName(args[0].replace(/@| $/g, '')).id;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tAPI.addFriendByID(Number(args[0]));\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'gift':\n\t\t\t\t\t\t\t\tif (!args[0]) {\n\t\t\t\t\t\t\t\t\tAPI.gift(4613422, 1337, 'a misterious person');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\targs[1] = isNaN(args[1]) ? 25: args[1];\n\t\t\t\t\t\t\t\t\t// Getting the user, either by username or ID\n\t\t\t\t\t\t\t\t\tif (isNaN(args[0])) {\n\t\t\t\t\t\t\t\t\t\targs[0] = API.getUserByName(args[0].replace(/@| $/g, '')).id;\n\t\t\t\t\t\t\t\t\t\tAPI.gift(args[0], args[1]);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tAPI.gift(args[0], args[1]);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'pm':\n\t\t\t\t\t\t\t\tif (!args[0]) return pi._tool.log(lang.info.helpUserOrId, 'info chat');\n\n\t\t\t\t\t\t\t\t// Getting the user, either by username or ID\n\t\t\t\t\t\t\t\tvar user;\n\t\t\t\t\t\t\t\tif (isNaN(args[0])) {\n\t\t\t\t\t\t\t\t\tuser = API.getUserByName(args[0].replace(/@| $/g, ''));\n\t\t\t\t\t\t\t\t\tif (typeof user === 'object') user = user.id;\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\treturn pi._tool.log(lang.error.userNotFound, 'error chat');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar encoded = '';\n\t\t\t\t\t\t\t\tmsg.slice(args[0].length+1).split('').forEach((e,i,a) => {\n\t\t\t\t\t\t\t\t\tencoded += (e.charCodeAt(0) <= 99 ? '0'+e.charCodeAt(0):e.charCodeAt(0));\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tAPI.moderateDeleteChat(user+'-'+encoded);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'eta':\n\t\t\t\t\t\t\t\tpi.eta(true); // true means log out in chat\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'exportchat':\n\t\t\t\t\t\t\t\tlet file = '';\n\t\t\t\t\t\t\t\tlet csv = args[0] === 'csv';\n\n\t\t\t\t\t\t\t\tsession.chat.forEach((e,i,a) => {\n\t\t\t\t\t\t\t\t\tfile += (csv ?\n\t\t\t\t\t\t\t\t\t\t`${e.type},${e.uid},${e.un},${e.message},${e.timestamp}` :\n\t\t\t\t\t\t\t\t\t\t`[${e.type}] [${e.uid}] [${e.un}]\\n${e.message} [${e.timestamp}]\\n`\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t$('<a></a>')\n\t\t\t\t\t\t\t\t\t.attr('id', 'pi-exportchat')\n\t\t\t\t\t\t\t\t\t.attr('href', `data:text/${(csv?'csv':'text')};charset=utf8,` + encodeURIComponent(file))\n\t\t\t\t\t\t\t\t\t.attr('download', API.getRoomName() + `-logs.${csv?'csv':'txt'}`)\n\t\t\t\t\t\t\t\t\t[0].click();\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'vol':\n\t\t\t\t\t\t\t\tif (args[0] >= 0 && args[0] <= 100) {\n\t\t\t\t\t\t\t\t\tAPI.setVolume(args[0]);\n\t\t\t\t\t\t\t\t\tpi._tool.setPlugSettings(\"volume\", args[0]);\n\t\t\t\t\t\t\t\t}\telse pi._tool.log(lang.info.helpVol, 'info chat');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'afk':\n\t\t\t\t\t\t\t\tif (msg.length === 0) msg = undefined;\n\t\t\t\t\t\t\t\telse pi.dom.afkMessage.children[0].value = settings.afkMessage = msg;\n\t\t\t\t\t\t\t\t$('#chat-input-field').one('blur', function() {\n\t\t\t\t\t\t\t\t\tpi.menu('afkResponder');\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'bot':\n\t\t\t\t\t\t\t\tif (!args[0]) return pi._tool.log(lang.info.helpUserOrId, 'info chat');\n\n\t\t\t\t\t\t\t\t// Getting the user, either by username or ID\n\t\t\t\t\t\t\t\tvar newBot;\n\t\t\t\t\t\t\t\tif (isNaN(args[0])) {\n\t\t\t\t\t\t\t\t\tnewBot = API.getUserByName(msg.replace(/@| $/g, ''));\n\t\t\t\t\t\t\t\t\tif (typeof newBot === 'object') newBot = newBot.id;\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\treturn pi._tool.log(lang.error.userNotFound, 'error chat');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (settings.bot.indexOf(newBot) !== -1) {\n\t\t\t\t\t\t\t\t\tsettings.bot.splice(settings.bot.indexOf(newBot), 1);\n\t\t\t\t\t\t\t\t\tpi._tool.log(pi._tool.replaceString(lang.success.removedBot, {bot: API.getUser(newBot).username}), 'success chat');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsettings.bot.push(newBot);\n\t\t\t\t\t\t\t\t\tpi._tool.log(pi._tool.replaceString(lang.success.addedBot, {bot: API.getUser(newBot).username}), 'success chat');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'discordbot':\n\t\t\t\t\t\t\t\tif (!args[0]) return pi._tool.log(lang.info.helpUserOrId, 'info chat');\n\n\t\t\t\t\t\t\t\t// Getting the user, either by username or ID\n\t\t\t\t\t\t\t\tvar newBot;\n\t\t\t\t\t\t\t\tif (isNaN(args[0])) {\n\t\t\t\t\t\t\t\t\tnewBot = API.getUserByName(msg.replace(/@| $/g, ''));\n\t\t\t\t\t\t\t\t\tif (typeof newBot === 'object') newBot = newBot.id;\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\treturn pi._tool.log(lang.error.userNotFound, 'error chat');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (settings.discordbot.indexOf(newBot) !== -1) {\n\t\t\t\t\t\t\t\t\tsettings.discordbot.splice(settings.discordbot.indexOf(newBot), 1);\n\t\t\t\t\t\t\t\t\tpi._tool.log(pi._tool.replaceString(lang.success.removedDiscordBot, {bot: API.getUser(newBot).username}), 'success chat');\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tsettings.discordbot.push(newBot);\n\t\t\t\t\t\t\t\t\tpi._tool.log(pi._tool.replaceString(lang.success.addedDiscordBot, {bot: API.getUser(newBot).username}), 'success chat');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'kick':\n\t\t\t\t\t\t\t\tvar self = API.getUser();\n\t\t\t\t\t\t\t\tif (self.role < API.ROLE.BOUNCER || (self.role < API.ROLE.BOUNCER && self.gRole === API.ROLE.NONE)) return pi._tool.log(lang.error.noSufficentPermissions, 'error chat');\n\n\t\t\t\t\t\t\t\t// Since username can have spaces, keep only the last args as time\n\t\t\t\t\t\t\t\tvar time = args.length > 1 && !isNaN(args[args.length-1]) ? args.pop() : 5;\n\t\t\t\t\t\t\t\tvar user = args.join(' ');\n\n\t\t\t\t\t\t\t\tif (isNaN(user)) {\n\t\t\t\t\t\t\t\t\tuser = API.getUserByName(user.replace(/@| $/g, ''));\n\t\t\t\t\t\t\t\t\tif (typeof user === 'Object') user = user.id;\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\treturn pi.tool.log(lang.error.userNotFound, 'error chat');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\telse {\n\t\t\t\t\t\t\t\t\tuser = API.getUser(user);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (user.id === self.id) return pi._tool.log(lang.error.selfKick, 'error chat');\n\t\t\t\t\t\t\t\tif (self.role <= user.role) return pi._tool.log(lang.error.staffKick, 'error chat');\n\t\t\t\t\t\t\t\tAPI.sendChat(pi._tool.replaceString(lang.userchat.kicking, {user: user.username, time: time}));\n\t\t\t\t\t\t\t\tsetTimeout(function(){API.moderateKickUser(user.id, time)}, 3000);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'ban':\n\t\t\t\t\t\t\t\tvar self = API.getUser();\n\t\t\t\t\t\t\t\tif (self.role < API.ROLE.BOUNCER || (self.role < API.ROLE.BOUCNER && self.gRole === API.ROLE.NONE)) return pi._tool.log(lang.error.noSufficentPermissions, 'error chat');\n\n\t\t\t\t\t\t\t\t// Since username can have spaces, keep only the last args as duration\n\t\t\t\t\t\t\t\tvar duration;\n\t\t\t\t\t\t\t\tif (args.length > 1) {\n\t\t\t\t\t\t\t\t\tlet lastArg = args[args.length-1].toLowerCase();\n\t\t\t\t\t\t\t\t\tif (lastArg === 'forever' || lastArg === 'day' || lastArg === 'hour')\n\t\t\t\t\t\t\t\t\t\tduration = args.pop();\n\t\t\t\t\t\t\t\t\telse duration = API.BAN.PERMA;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvar user = args.join(' ');\n\n\t\t\t\t\t\t\t\tif (isNaN(user)) {\n\t\t\t\t\t\t\t\t\tuser = API.getUserByName(user.replace(/@| $/g, ''));\n\t\t\t\t\t\t\t\t}\telse {\n\t\t\t\t\t\t\t\t\tuser = API.getUser(user);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (user === null) return pi._tool.log(lang.error.userNotFound, 'error chat');\n\t\t\t\t\t\t\t\tif (user.id === self.id) return pi._tool.log(lang.error.selfBan, 'error chat');\n\t\t\t\t\t\t\t\tif (self.role <= user.role) return pi._tool.log(lang.error.staffBan, 'error chat');\n\n\t\t\t\t\t\t\t\tduration = duration.toLowerCase();\n\t\t\t\t\t\t\t\tif (duration === 'forever') duration = API.BAN.PERMA;\n\t\t\t\t\t\t\t\telse if (duration === 'day') duration = API.BAN.DAY;\n\t\t\t\t\t\t\t\telse if (duration === 'hour') duration = API.BAN.HOUR;\n\n\t\t\t\t\t\t\t\tAPI.moderateBanUser(user.id, 1, duration);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'mute':\n\t\t\t\t\t\t\t\tif (session.floodAPI) return pi._tool.log(lang.error.APIFloodInEffect, 'chat error');\n\t\t\t\t\t\t\t\tvar self = API.getUser();\n\t\t\t\t\t\t\t\tif (self.role < API.ROLE.BOUNCER || (self.role < API.ROLE.BOUNCER && self.gRole === API.ROLE.NONE)) return pi._tool.log(lang.error.noSufficentPermissions, 'error chat');\n\n\t\t\t\t\t\t\t\t// Since username can have spaces, keep only the last args as duration\n\t\t\t\t\t\t\t\tvar duration;\n\t\t\t\t\t\t\t\tif (args.length > 1) {\n\t\t\t\t\t\t\t\t\tlet lastArg = args[args.length-1].toLowerCase();\n\t\t\t\t\t\t\t\t\tif (lastArg === 'long' || lastArg === 'medium' || lastArg === 'short')\n\t\t\t\t\t\t\t\t\t\tduration = args.pop();\n\t\t\t\t\t\t\t\t\telse duration = API.MUTE.LONG;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tvar user = args.join(' ');\n\n\t\t\t\t\t\t\t\tif (isNaN(user)) {\n\t\t\t\t\t\t\t\t\tuser = API.getUserByName(user.replace(/@| $/g, ''));\n\t\t\t\t\t\t\t\t}\telse {\n\t\t\t\t\t\t\t\t\tuser = API.getUser(user);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (user === null) return pi._tool.log(lang.error.userNotFound, 'error chat');\n\t\t\t\t\t\t\t\tif (user.id === self.id) return pi._tool.log(lang.error.selfMute, 'error chat');\n\t\t\t\t\t\t\t\tif (self.role <= user.role) return pi._tool.log(lang.error.staffMute, 'error chat');\n\n\t\t\t\t\t\t\t\tduration = duration.toLowerCase();\n\t\t\t\t\t\t\t\tif (duration === 'long') duration = API.MUTE.LONG;\n\t\t\t\t\t\t\t\telse if (duration === 'medium') duration = API.MUTE.MEDIUM;\n\t\t\t\t\t\t\t\telse if (duration === 'short') duration = API.MUTE.SHORT;\n\n\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\turl: '/_/mutes',\n\t\t\t\t\t\t\t\t\tmethod: 'POST',\n\t\t\t\t\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\t\t\t\t\tuserID: user.id,\n\t\t\t\t\t\t\t\t\t\treason: 1,\n\t\t\t\t\t\t\t\t\t\tduration: duration\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\t\t\tcontentType: 'application/json'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'host':\n\t\t\t\t\t\t\tcase 'cohost':\n\t\t\t\t\t\t\tcase 'manager':\n\t\t\t\t\t\t\tcase 'bouncer':\n\t\t\t\t\t\t\tcase 'residentdj':\n\t\t\t\t\t\t\tcase 'rdj':\n\t\t\t\t\t\t\tcase 'unrank':\n\t\t\t\t\t\t\t\tif (session.floodAPI) return pi._tool.log(lang.error.APIFloodInEffect, 'chat error');\n\t\t\t\t\t\t\t\tvar userID;\n\n\t\t\t\t\t\t\t\tif (typeof msg == 'undefined') {\n\t\t\t\t\t\t\t\t\treturn pi._tool.log(lang.info.helpUserOrId, 'info');\n\t\t\t\t\t\t\t\t} else if (isNaN(msg)) {\n\t\t\t\t\t\t\t\t\tuserID = API.getUserByName(msg.replace(/@| $/g, '')).id;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tuserID = args[0];\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlet roleID = -1; // invalid on purpose\n\t\t\t\t\t\t\t\tswitch (cmd) {\n\t\t\t\t\t\t\t\t\tcase 'host':       roleID = API.ROLE.HOST; break;\n\t\t\t\t\t\t\t\t\tcase 'cohost':     roleID = API.ROLE.COHOST; break;\n\t\t\t\t\t\t\t\t\tcase 'manager':    roleID = API.ROLE.MANAGER; break;\n\t\t\t\t\t\t\t\t\tcase 'bouncer':    roleID = API.ROLE.BOUNCER; break;\n\t\t\t\t\t\t\t\t\tcase 'residentdj': roleID = API.ROLE.DJ; break;\n\t\t\t\t\t\t\t\t\tcase 'rdj':        roleID = API.ROLE.DJ; break;\n\t\t\t\t\t\t\t\t\tcase 'unrank':     roleID = API.ROLE.NONE; break;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\turl: (cmd === 'unrank' ? '/_/staff/'+userID : '/_/staff/update'),\n\t\t\t\t\t\t\t\t\ttype: (cmd === 'unrank' ? 'DELETE' : 'POST'),\n\t\t\t\t\t\t\t\t\tdata: (cmd === 'unrank' ? '' : JSON.stringify({\n\t\t\t\t\t\t\t\t\t\tuserID: userID,\n\t\t\t\t\t\t\t\t\t\troleID: roleID\n\t\t\t\t\t\t\t\t\t})),\n\t\t\t\t\t\t\t\t\terror: function(err) {\n\t\t\t\t\t\t\t\t\t\tpi._tool.log(lang.error.cannotRank, 'error chat');\n\t\t\t\t\t\t\t\t\t\tconsole.error(lang.error.cannotRank, err);\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\t\t\tcontentType: 'application/json'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'grabed?':\n\t\t\t\t\t\t\t\tif (session.floodAPI) return pi._tool.log(lang.error.APIFloodInEffect, 'chat error');\n\t\t\t\t\t\t\t\tif (API.getUser().id === API.getDJ().id) {\n\t\t\t\t\t\t\t\t\tpi._tool.log(lang.info.youPlay, 'info chat');\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar thisSong = API.getMedia(), grabed = false;\n\n\t\t\t\t\t\t\t\tvar log = pi._tool.log(lang.info.checkingPlaylists, 'info chat');\n\t\t\t\t\t\t\t\tpi._tool.getPlaylists(function(playlists) {\n\t\t\t\t\t\t\t\t\tplaylists.forEach(function(e, i, a) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tpi._tool.getPlaylist(e.id, function(playlist) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (!grabed) log.edit(pi._tool.replaceString(lang.info.checkingState, {current: i+1, total: a.length, name: e.name}));\n\t\t\t\t\t\t\t\t\t\t\t\tplaylist.forEach(function(ee, ii, aa) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (ee.cid === thisSong.cid) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlog.edit(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlang.info.isGrabed, {name: e.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tgrabed = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (i + 1 >= a.length && ii + 1 >= aa.length && !grabed) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlog.edit(lang.success.notGrabed).changeType('success');\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}, delay * i);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'duplicates':\n\t\t\t\t\t\t\t\tif (session.floodAPI) return pi._tool.log(lang.error.APIFloodInEffect, 'chat error');\n\t\t\t\t\t\t\t\t// Everything that is not a coma (can be escaped with \"\\\")\n\t\t\t\t\t\t\t\tlet excludedPL = msg.match(/(\\s?(\\\\,)?[^,])+/g);\n\t\t\t\t\t\t\t\tlet skip = false;\n\t\t\t\t\t\t\t\tlet foundDuplicate = false;\n\t\t\t\t\t\t\t\tlet allSongs = [];\n\t\t\t\t\t\t\t\tlet allSongsPL = [];\n\n\t\t\t\t\t\t\t\tvar log = pi._tool.log(lang.info.checkingDuplicates, 'info chat');\n\t\t\t\t\t\t\t\tpi._tool.getPlaylists(function(playlists) {\n\t\t\t\t\t\t\t\t\tplaylists.forEach(function(e, i, a) {\n\t\t\t\t\t\t\t\t\t\tskip = false;\n\t\t\t\t\t\t\t\t\t\tif (excludedPL !== null) {\n\t\t\t\t\t\t\t\t\t\t\tfor (var j = 0; j < excludedPL.length; j++) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (e.name === excludedPL[j]) skip = true;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (!skip) {\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tlog.edit(pi._tool.replaceString(lang.info.checkingState, {current: i+1, total: a.length, name: e.name}));\n\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.getPlaylist(e.id, function(playlist) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tplaylist.forEach(function(ee, ii, aa) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfor (var j = 0; j < allSongs.length; j++) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (ee.cid == allSongs[j].cid) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlang.warn.duplicates, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tauthor: ee.author,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: ee.title,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname1: e.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname2: allSongsPL[j].name\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t), 'warn chat'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfoundDuplicate = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (ee.author === allSongs[j].author && ee.title === allSongs[j].title ) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlang.warn.possibleDuplicate, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tauthor: ee.author,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: ee.title,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname1: e.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname2: allSongsPL[j].name\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t), 'warn chat'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfoundDuplicate = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tallSongs.push(ee);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tallSongsPL.push(e);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (i + 1 === a.length && ii + 1 === aa.length && !foundDuplicate) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlog.edit(lang.success.noDuplicates).changeType('success');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (i + 1 === a.length && ii + 1 === aa.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlog.edit(lang.success.duplicateFinished).changeType('success');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}, delay * i);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'removeLabels':\n\t\t\t\t\t\t\t\tif (session.floodAPI) return pi._tool.log(lang.error.APIFloodInEffect, 'chat error');\n\t\t\t\t\t\t\t\tif (sessionStorage.getItem('removeLabelWarn') === 'false') {\n\t\t\t\t\t\t\t\t\tpi._tool.log(lang.warn.unlistedCommand, 'warn chat',\n\t\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\t\tthis.delete();\n\t\t\t\t\t\t\t\t\t\t\tsessionStorage.setItem('removeLabelWarn', true);\n\t\t\t\t\t\t\t\t\t\t\tAPI.sendChat('/removeLabels');\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar log = pi._tool.log(lang.info.checkingPlaylists, 'info chat');\n\t\t\t\t\t\t\t\tpi._tool.getPlaylists(function(playlists) {\n\t\t\t\t\t\t\t\t\tlet worstRegexp = /(([*ã\\[\\(])?(trap|(melbourne ?)bounce|(happy ?)hardcore|progressive|future bass|glitchhop|glitch hop|glitch hop (\\/|or)? 110bpm|indie dance|indie dance \\/ nu disco|nu disco|(melodic)? ?dubstep|drumstep|drum and bass|drum&bass|dnb|edm|hard dance|electronic|(bass ?)house|progressive house|electro( ?swing)?|electro[ -]house|tropical house|deep house|house music|big room|chill|chillout|chillstep(free ?|full)?download|((monstercat ?)?official ?)?((music|lyric)( )?)video|(hq ?)?free|(tasty|monstercat|ncs)( ?(ep|lp|vip|free ?(ep|dl|download)) ?)?( ?release|download)?)([\\)\\]ã*]|( ?\\|\\| ?))( ?- ?)?)/gi;\n\t\t\t\t\t\t\t\t\tlet toRename = [];\n\n\t\t\t\t\t\t\t\t\tplaylists.forEach(function(pl, i, a) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tlog.edit(pi._tool.replaceString(lang.info.checkingStateRename, {current: i+1, total: a.length, name: pl.name, found: toRename.length}));\n\t\t\t\t\t\t\t\t\t\t\tpi._tool.getPlaylist(pl.id, function(playlist) {\n\t\t\t\t\t\t\t\t\t\t\t\tplaylist.forEach(function(song, j, aa) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (worstRegexp.test(song.author) || worstRegexp.test(song.title)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoRename.push({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaylist: pl,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsong: song\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (i + 1 >= a.length && j + 1 >= aa.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlog.edit(lang.log.checkingRemoving).changeType('log');\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (toRename.length > 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttoRename.forEach(function(item, index, array) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet cleanAuthor = item.song.author.replace(worstRegexp, '').trim();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet cleanTitle = item.song.title.replace(worstRegexp, '').trim();\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// After cleanup, title contains both author and title, this fixes it\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (cleanAuthor.length === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcleanAuthor = cleanTitle.split('-')[0].trim();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcleanTitle = cleanTitle.substr(cleanAuthor.length).replace(/ ?- ?/i, '');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'PUT',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: '/_/playlists/'+item.playlist.id+'/media/update',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"id\": item.song.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"author\": cleanAuthor,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"title\": cleanTitle\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsuccess: function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlang.log.labelChanged, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tauthor: item.song.author,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: item.song.title,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewAuthor:cleanAuthor,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tnewTitle: cleanTitle\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t), 'chat'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Placed inside the success so it appears after the last element\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// and not before due to connection time. Yes, if it fails on the\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// last element, it will not show up.\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (index + 1 >= array.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlog.edit(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlang.success.doneRenaming, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttotal: array.length,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsong: (array.length > 1 ? lang.glossary.songs : lang.glossary.song)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t.changeType('success');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: function(err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log([lang.error.renaming, err], 'error');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataType: \"json\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontentType: \"application/json\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, delay * index);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlog.edit(lang.success.noRenaming).changeType('success');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}, delay * i);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'findBrokenSongs':\n\t\t\t\t\t\t\t\tif (session.floodAPI) return pi._tool.log(lang.error.APIFloodInEffect, 'chat error');\n\t\t\t\t\t\t\t\tvar unavailableMove = [], fileText = '', log,\n\t\t\t\t\t\t\t\tcmdSettings = {\n\t\t\t\t\t\t\t\t\tlogToChat: true,\n\t\t\t\t\t\t\t\t\tlogToFile: false,\n\t\t\t\t\t\t\t\t\tmoveToTop: true,\n\t\t\t\t\t\t\t\t\tmoveToBottom: false,\n\t\t\t\t\t\t\t\t\tremove: false\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\tif (confirm(lang.modal.BrokenSongsChangeSettings)) {\n\t\t\t\t\t\t\t\t\tcmdSettings = {\n\t\t\t\t\t\t\t\t\t\tlogToConsole : confirm(lang.modal.consoleLog),\n\t\t\t\t\t\t\t\t\t\tlogToChat    : confirm(lang.modal.chatLog),\n\t\t\t\t\t\t\t\t\t\tlogToFile    : confirm(lang.modal.fileLog),\n\t\t\t\t\t\t\t\t\t\tmoveToTop    : confirm(lang.modal.moveTop),\n\t\t\t\t\t\t\t\t\t\tmoveToBottom : confirm(lang.modal.moveBottom),\n\t\t\t\t\t\t\t\t\t\tremove       : confirm(lang.modal.deleteSongs)\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (cmdSettings.logToChat) log = pi._tool.log(lang.info.checkingUnavailable, 'chat info');\n\t\t\t\t\t\t\t\tpi._tool.getPlaylists(function(playlists) {\n\t\t\t\t\t\t\t\t\tplaylists.forEach(function(e, i, a) {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\tif (cmdSettings.logToChat) log.edit(pi._tool.replaceString(lang.info.checkingStateRename, {current: i+1, total: a.length, name: e.name, found: unavailableMove.length}));\n\t\t\t\t\t\t\t\t\t\t\tpi._tool.getPlaylist(e.id, function(songs) {\n\t\t\t\t\t\t\t\t\t\t\t\tsongs.forEach(function(ee, ii, aa) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t$.get('https://www.googleapis.com/youtube/v3/videos?id=' + ee.cid + '&key=' + YTAPIkey + '&part=snippet,status', function(data) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tvar passed = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (ee.format == 1 && data.items.length === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (cmdSettings.logToChat) pi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.error.brokenSong, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: e.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsource: 'YT',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tauthor: ee.author,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: ee.title,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcid: ee.cid\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'chat error'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpassed = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (ee.format == 2) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tSC.get(\"/tracks/\" + ee.cid, function(track) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (typeof track.title === \"undefined\") {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.error.brokenSong, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: e.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsource: 'SC',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tauthor: ee.author,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: ee.title,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcid: ee.cid\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'chat error'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpassed = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (data.items.length == 1) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (data.items[0].status.uploadStatus != 'processed') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.error.brokenSong, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tname: e.name,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsource: 'YT',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tauthor: ee.author,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: ee.title,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcid: ee.cid\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t'chat error'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpassed = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!passed) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (unavailableMove[e.id] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunavailableMove[e.id] = [];\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tunavailableMove[e.id].push(ee.id);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}, delay * i);\n\n\t\t\t\t\t\t\t\t\t\tif (i + 1 >= a.length) {\n\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\tObject.keys(unavailableMove).forEach(function(ee, ii, aa) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (cmdSettings.moveToTop || cmdSettings.moveToBottom) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (cmdSettings.logToChat) log.edit(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.info.moveMedia, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurrent: ii+1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttotal: aa.length,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdirection: (cmdSettings.moveToTop ? lang.glossary.top : lang.glossary.bottom)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'PUT',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: '/_/playlists/'+ee+'/media/move',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: '{\"ids\":' + JSON.stringify(unavailableMove[ee]) + ',\"beforeID\":' + (cmdSettings.moveToTop ? \"0\" : \"-1\") + '}',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontentType: 'application/json'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (cmdSettings.remove) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (cmdSettings.logToChat) log.edit(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.info.removeMedia, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcurrent: ii+1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttotal: aa.length\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: '/_/playlists/'+ee+'/media/delete',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: '{\"ids\":' + JSON.stringify(unavailableMove[ee]) + '}',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontentType: 'application/json'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (ii + 1 >= aa.length) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (cmdSettings.logToChat) log.edit(lang.success.unavailableFinished).changeType('success');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (cmdSettings.logToFile) download(fileText, 'plug.dj unavailable songs.txt', 'text/plain');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}, aa.length * delay + 2000);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, ii * delay);\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\tif (Object.keys(unavailableMove).length === 0) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (cmdSettings.logToChat) log.edit(lang.success.noUnavailable).changeType('success');\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}, a.length * delay);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'whoami':\n\t\t\t\t\t\t\t\tlet me = API.getUser();\n\t\t\t\t\t\t\t\tvar piRole = pi._tool.getRank(me.id).length ? pi._tool.getRank(me.id)[0] : lang.glossary.none;\n\n\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.info.whoami, {\n\t\t\t\t\t\t\t\t\t\tusername: me.username,\n\t\t\t\t\t\t\t\t\t\trawun: me.rawun,\n\t\t\t\t\t\t\t\t\t\tid: me.id,\n\t\t\t\t\t\t\t\t\t\tblurb: me.blurb,\n\t\t\t\t\t\t\t\t\t\tlanguage: me.language,\n\t\t\t\t\t\t\t\t\t\tprofile: (me.level >= 5 ? '\\n<a target=\"_blank\" href=\"/@/'+me.username.toLowerCase().replace(/([^A-z]\\s)|(\\s[^A-z])/g, \"\").replace(\" \",\"-\").replace(/[^A-z-0-9]|\\[|\\]/g, \"\")+'\">Profile</a>' : ''),\n\t\t\t\t\t\t\t\t\t\tavatar: me.avatarID,\n\t\t\t\t\t\t\t\t\t\tbadge: me.badge,\n\t\t\t\t\t\t\t\t\t\tlvl: me.level,\n\t\t\t\t\t\t\t\t\t\txp: me.xp,\n\t\t\t\t\t\t\t\t\t\tpp: me.pp,\n\t\t\t\t\t\t\t\t\t\tjoined: new Date(me.joined).toUTCString(),\n\t\t\t\t\t\t\t\t\t\tvote: me.vote,\n\t\t\t\t\t\t\t\t\t\tgrab: me.grab,\n\t\t\t\t\t\t\t\t\t\tplugRole: me.gRole,\n\t\t\t\t\t\t\t\t\t\tplugitRole: piRole,\n\t\t\t\t\t\t\t\t\t\trank: me.role,\n\t\t\t\t\t\t\t\t\t\tguest: me.guest,\n\t\t\t\t\t\t\t\t\t\tsub: me.sub,\n\t\t\t\t\t\t\t\t\t\tsilver: me.silver\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t, 'info chat'\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'whois':\n\t\t\t\t\t\t\t\tvar user;\n\n\t\t\t\t\t\t\t\tif (typeof args[0] == 'undefined') {\n\t\t\t\t\t\t\t\t\treturn pi._tool.log(lang.info.helpUserOrId, 'info');\n\t\t\t\t\t\t\t\t} else if (isNaN(msg)) {\n\t\t\t\t\t\t\t\t\tmsg = msg.replace('@', '');\n\t\t\t\t\t\t\t\t\tif (msg.lastIndexOf(' ') === msg.length-1) msg = msg.slice(0, -1);\n\t\t\t\t\t\t\t\t\tuser = API.getUserByName(msg);\n\t\t\t\t\t\t\t\t\tif (typeof API.getUserByName(msg) !== 'object') pi.tool.log(lang.error.userNotFound, 'error chat');\n\t\t\t\t\t\t\t\t}\telse {\n\t\t\t\t\t\t\t\t\tuser = API.getUser(msg);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar piRole = pi._tool.getRank(user.id).length ? pi._tool.getRank(user.id)[0] : lang.glossary.none;\n\n\t\t\t\t\t\t\t\tif (user !== null && Object.keys(user).length > 0) {\n\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.info.whois, {\n\t\t\t\t\t\t\t\t\t\t\tusername: user.username,\n\t\t\t\t\t\t\t\t\t\t\trawun: user.rawun,\n\t\t\t\t\t\t\t\t\t\t\tid: user.id,\n\t\t\t\t\t\t\t\t\t\t\tlanguage: user.language,\n\t\t\t\t\t\t\t\t\t\t\tprofile: (typeof user.slug !== \"undefined\" ? '\\n<a target=\"_blank\" href=\"/@/'+user.slug+'\">Profile</a>' : ''),\n\t\t\t\t\t\t\t\t\t\t\tavatar: user.avatarID,\n\t\t\t\t\t\t\t\t\t\t\tbadge: user.badge,\n\t\t\t\t\t\t\t\t\t\t\tlvl: user.level,\n\t\t\t\t\t\t\t\t\t\t\tjoined: new Date(user.joined).toUTCString(),\n\t\t\t\t\t\t\t\t\t\t\tvote: user.vote,\n\t\t\t\t\t\t\t\t\t\t\tgrab: user.grab,\n\t\t\t\t\t\t\t\t\t\t\tplugRole: user.gRole,\n\t\t\t\t\t\t\t\t\t\t\tplugitRole: piRole,\n\t\t\t\t\t\t\t\t\t\t\trank: user.role,\n\t\t\t\t\t\t\t\t\t\t\tguest: user.guest,\n\t\t\t\t\t\t\t\t\t\t\tsub: user.sub,\n\t\t\t\t\t\t\t\t\t\t\tsilver: user.silver,\n\t\t\t\t\t\t\t\t\t\t\tfriend: user.friend\n\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t, 'info chat'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tpi._tool.log(lang.error.userNotFound, 'error chat');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'pi':\n\t\t\t\t\t\t\t\tAPI.sendChat('Get Plug-It : https://plug-it.github.io');\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'js':\n\t\t\t\t\t\t\t\texecute(msg, undefined, lang.warn.isTrusted);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'list':\n\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t'/r (message)'+\n\t\t\t\t\t\t\t\t\t'\\n/like (@user/message)'+\n\t\t\t\t\t\t\t\t\t'\\n/love (@user/message)'+\n\t\t\t\t\t\t\t\t\t'\\n/lovespam'+\n\t\t\t\t\t\t\t\t\t'\\n/door (@user/message)'+\n\t\t\t\t\t\t\t\t\t'\\n/doorrun (@user/message)'+\n\t\t\t\t\t\t\t\t\t'\\n/fire'+\n\t\t\t\t\t\t\t\t\t'\\n/kong'+\n\t\t\t\t\t\t\t\t\t'\\n/shrug (message)'+\n\t\t\t\t\t\t\t\t\t'\\n/friend [@user/id]'+\n\t\t\t\t\t\t\t\t\t'\\n/gift [@user/id] [amount]'+\n\t\t\t\t\t\t\t\t\t'\\n/eta'+\n\t\t\t\t\t\t\t\t\t'\\n/exportchat (csv)'+\n\t\t\t\t\t\t\t\t\t'\\n/vol [0-100]'+\n\t\t\t\t\t\t\t\t\t'\\n/afk [message]'+\n\t\t\t\t\t\t\t\t\t'\\n/bot [@user/id]'+\n\t\t\t\t\t\t\t\t\t'\\n/discordbot [@user/id]'+\n\t\t\t\t\t\t\t\t\t'\\n/kick [@user/id] (seconds)'+\n\t\t\t\t\t\t\t\t\t'\\n/ban [@user/id] [forever/day/hour]'+\n\t\t\t\t\t\t\t\t\t'\\n/host|cohost|manager|bouncer|residentdj|rdj|unrank [@user/id]'+\n\t\t\t\t\t\t\t\t\t'\\n/grabed?'+\n\t\t\t\t\t\t\t\t\t'\\n/duplicates (Excluded playlist(s),playlist\\\\,with\\\\,coma)'+\n\t\t\t\t\t\t\t\t\t'\\n/findBrokenSongs'+\n\t\t\t\t\t\t\t\t\t'\\n/whoami'+\n\t\t\t\t\t\t\t\t\t'\\n/whois [id/pseudo]'+\n\t\t\t\t\t\t\t\t\t'\\n/pi'+\n\t\t\t\t\t\t\t\t\t'\\n/js [javaScript code]'+\n\t\t\t\t\t\t\t\t\t'\\n/reload'+\n\t\t\t\t\t\t\t\t\t'\\n/kill'+\n\t\t\t\t\t\t\t\t\t'\\n/list',\n\t\t\t\t\t\t\t\t\t'chat'\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'reload':\n\t\t\t\t\t\t\t\twindow.pi._reload();\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tcase 'kill':\n\t\t\t\t\t\t\t\twindow.pi._close();\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tif (sessionStorage.getItem('helpCommands') === 'false') {\n\t\t\t\t\t\t\t\t\tpi._tool.log(lang.log.help, 'info chat');\n\t\t\t\t\t\t\t\t\tsessionStorage.setItem('helpCommands', true);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tearn: function(amount) {\n\t\t\t\t\t\t// contains = {pp:0, xp:0};\n\t\t\t\t\t\tif (settings.gainNotification) {\n\t\t\t\t\t\t\tlet gain;\n\t\t\t\t\t\t\tlet totalXP = API.getUser().xp + amount.xp;\n\t\t\t\t\t\t\tlet totalPP = API.getUser().pp + amount.pp;\n\t\t\t\t\t\t\tlet minXP = amount.xp >= settings.minimumGain.xp;\n\t\t\t\t\t\t\tlet minPP = amount.pp >= settings.minimumGain.pp;\n\t\t\t\t\t\t\t// Parsing numbers to be more readable\n\t\t\t\t\t\t\ttotalXP   = totalXP   > 999 ? totalXP.spaceOut()   : totalXP;\n\t\t\t\t\t\t\ttotalPP   = totalPP   > 999 ? totalPP.spaceOut()   : totalPP;\n\t\t\t\t\t\t\tamount.pp = amount.pp > 999 ? amount.pp.spaceOut() : amount.pp;\n\t\t\t\t\t\t\tamount.xp = amount.xp > 999 ? amount.xp.spaceOut() : amount.xp;\n\n\t\t\t\t\t\t\tif (amount.pp === 0 && minXP) {\n\t\t\t\t\t\t\t\tgain = amount.xp + ' xp.\\n'+\n\t\t\t\t\t\t\t\t'Total: ' + totalXP + ' xp';\n\t\t\t\t\t\t\t} else if (amount.xp === 0 && minPP) {\n\t\t\t\t\t\t\t\tgain = amount.pp + ' PP.\\n'+\n\t\t\t\t\t\t\t\t'Total: ' + totalPP + ' PP';\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif (minXP && minPP) {\n\t\t\t\t\t\t\t\t\tgain = amount.xp+' xp and '+amount.pp+' PP.\\n'+\n\t\t\t\t\t\t\t\t\t'Total: ' + totalXP + ' xp\\n' +\n\t\t\t\t\t\t\t\t\ttotalPP + ' PP';\n\t\t\t\t\t\t\t\t} else if (minXP) {\n\t\t\t\t\t\t\t\t\tgain = amount.xp + ' xp.\\n'+\n\t\t\t\t\t\t\t\t\t'Total: ' + totalXP + ' xp';\n\t\t\t\t\t\t\t\t} else if (minPP) {\n\t\t\t\t\t\t\t\t\tgain = amount.pp + ' PP.\\n'+\n\t\t\t\t\t\t\t\t\t'Total: ' + totalPP + ' PP';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (typeof gain !== \"undefined\") pi._tool.log(pi._tool.replaceString(lang.log.earn, {gain: gain}), 'chat');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfriendJoin: function(friend) {\n\t\t\t\t\t\t// contains = {userObject};\n\t\t\t\t\t},\n\t\t\t\t\tgrabUpdate: function(grab) {\n\t\t\t\t\t\t/* contains = {\n\t\t\t\t\t\t\tuser: {userObject}\n\t\t\t\t\t\t}; */\n\n\t\t\t\t\t\tpi.voteAlert(grab);\n\t\t\t\t\t\t/*\n\t\t\t\t\t\t\tfor (var i = 0; i < woots.length; i++) {\n\t\t\t\t\t\t\t\tif (woots[i].id == grab.id) {\n\t\t\t\t\t\t\t\t\t// Prevent forced woot event\n\t\t\t\t\t\t\t\t\tvar index = woots.indexOf(woots[i]);\n\t\t\t\t\t\t\t\t\tif (index >= 0) woots.splice(index, 1);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tgrabs.push(grab.user);\n\t\t\t\t\t\t*/\n\t\t\t\t\t},\n\t\t\t\t\tguestJoin: function(totalGuest) {\n\t\t\t\t\t\t// contains = 0;\n\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\tpi._tool.replaceString(lang.log.guestJoin, {\n\t\t\t\t\t\t\t\tguests: totalGuest\n\t\t\t\t\t\t\t}), 'chat'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\tguestLeave: function(totalGuest) {\n\t\t\t\t\t\t// contains = 0;\n\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\tpi._tool.replaceString(lang.log.guestLeave, {\n\t\t\t\t\t\t\t\tguests: totalGuest\n\t\t\t\t\t\t\t}), 'chat'\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\thistoryUpdate: function(medias) {\n\t\t\t\t\t\t/* contains = [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmedia: {\n\t\t\t\t\t\t\t\t\tauthor,\n\t\t\t\t\t\t\t\t\tcid,\n\t\t\t\t\t\t\t\t\tduration,\n\t\t\t\t\t\t\t\t\tformat,\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\timage,\n\t\t\t\t\t\t\t\t\ttitle\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tscore: {\n\t\t\t\t\t\t\t\t\tgrabs,\n\t\t\t\t\t\t\t\t\tlisteners,\n\t\t\t\t\t\t\t\t\tnegative,\n\t\t\t\t\t\t\t\t\tpositive\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tuser: {\n\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\tusername\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t]; */\n\n\t\t\t\t\t\tif (settings.historyAlert) {\n\t\t\t\t\t\t\tlet media = API.getMedia();\n\t\t\t\t\t\t\tlet dj = API.getDJ();\n\t\t\t\t\t\t\tvar callback = null;\n\n\t\t\t\t\t\t\t// if no media, no need to check\n\t\t\t\t\t\t\tif (typeof media === 'undefined') return;\n\t\t\t\t\t\t\t// if bouncer, setup a callback to skip\n\t\t\t\t\t\t\tif (API.hasPermission(null, API.ROLE.BOUNCER)) {\n\t\t\t\t\t\t\t\tcallback = function(media, dj) {\n\t\t\t\t\t\t\t\t\tif (media.cid === API.getMedia().cid) {\n\t\t\t\t\t\t\t\t\t\tAPI.sendChat(pi._tool.replaceString(lang.djSkip, {dj:dj.username}));\n\t\t\t\t\t\t\t\t\t\tAPI.moderateForceSkip();\n\t\t\t\t\t\t\t\t\t\tthis.delete();\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tthis.edit(lang.error.cannotSkipFinished)\n\t\t\t\t\t\t\t\t\t\t.changeType('error').removeCallback();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// i = 1 to jump the first item being the current song\n\t\t\t\t\t\t\tfor (var i = 1; i < medias.length; i++) {\n\t\t\t\t\t\t\t\tif (media.format == medias[i].media.format && media.cid == medias[i].media.cid) {\n\t\t\t\t\t\t\t\t\tvar log = pi._tool.log(\n\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t lang.warn.djInHistory,\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tdj: dj.username,\n\t\t\t\t\t\t\t\t\t\t\t\tauthor: medias[i].media.author,\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: medias[i].media.title,\n\t\t\t\t\t\t\t\t\t\t\t\thistorydj: medias[i].user.username,\n\t\t\t\t\t\t\t\t\t\t\t\tturns: (i-1),\n\t\t\t\t\t\t\t\t\t\t\t\tskip: (API.hasPermission(null, API.ROLE.BOUNCER) ? '\\n'+'Click here to force skip.' : null)\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t'warn chat', callback, media, dj\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmodSkip: function(mod) {\n\t\t\t\t\t\t// contains = 'username';\n\t\t\t\t\t},\n\t\t\t\t\tscoreUpdate: function(score) {\n\t\t\t\t\t\t/* contains = {\n\t\t\t\t\t\t\tpositive: 0,\n\t\t\t\t\t\t\tnegative: 0,\n\t\t\t\t\t\t\tgrabs: 0\n\t\t\t\t\t\t}; */\n\n\t\t\t\t\t\tsession.woots = API.getUsers().filter(x => x.vote == 1);\n\t\t\t\t\t\tsession.grabs = API.getUsers().filter(x => x.grab);\n\t\t\t\t\t\tsession.mehs  = API.getUsers().filter(x => x.vote == -1);\n\t\t\t\t\t},\n\t\t\t\t\tuserJoin: function(join) {\n\t\t\t\t\t\t// contains: {userObject};\n\t\t\t\t\t\tif (settings.userJoin) {\n\t\t\t\t\t\t\tlet userInfo = (settings.userInfo ? ' Lvl:'+join.level+'|'+'Id:'+join.id : '');\n\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.log.userJoin, {\n\t\t\t\t\t\t\t\t\tuser: join.username,\n\t\t\t\t\t\t\t\t\tuserInfo: userInfo\n\t\t\t\t\t\t\t\t}), 'chat'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tuserLeave: function(leave) {\n\t\t\t\t\t\t// contains: {userObject};\n\n\t\t\t\t\t\tif (settings.userLeave) {\n\t\t\t\t\t\t\tlet userInfo = (settings.userInfo ? ' Lvl:'+leave.level+'|'+'Id:'+leave.id : '');\n\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.log.userLeave, {\n\t\t\t\t\t\t\t\t\tuser: leave.username,\n\t\t\t\t\t\t\t\t\tuserInfo: userInfo\n\t\t\t\t\t\t\t\t}), 'chat'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tuserSkip: function(user) {\n\t\t\t\t\t\t// contains = \"username\";\n\t\t\t\t\t},\n\t\t\t\t\tvoteUpdate: function(vote) {\n\t\t\t\t\t\t/* contains = {\n\t\t\t\t\t\t\tvote: 1,\n\t\t\t\t\t\t\tuser: {userObject}\n\t\t\t\t\t\t}; */\n\n\t\t\t\t\t\tpi.voteAlert(vote);\n\t\t\t\t\t},\n\t\t\t\t\twaitListUpdate: function(waitList) {\n\t\t\t\t\t\t/* contains = [\n\t\t\t\t\t\t\t{userObject}\n\t\t\t\t\t\t]; */\n\n\t\t\t\t\t\tif (settings.boothAlert &&\n\t\t\t\t\t\t    API.getWaitListPosition()+1 === settings.boothPosition) {\n\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.warn.boothAlert, {pos: settings.boothPosition})\n\t\t\t\t\t\t\t\t, 'warn chat'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tif (!document.hasFocus() && pi._tool.getPlugSettings().chatSound) {\n\t\t\t\t\t\t\t\tnew Audio(url.sounds.notification).play();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t_modulesEvent: {\n\t\t\t\t\tchatReceive: function(msg) {\n\t\t\t\t\t\tif (['moderation', 'system', 'promo', 'user-action', 'log', 'welcome'].indexOf(msg.type) !== -1\n\t\t\t\t\t\t    || msg.cid.indexOf('rcs') !== -1) return;\n\t\t\t\t\t\t// This message node\n\t\t\t\t\t\tlet selector = '#chat [data-cid=\"'+msg.cid+'\"]';\n\t\t\t\t\t\tlet sender = API.getUser(msg.uid);\n\n\t\t\t\t\t\t// Second message from the same user, things that only are set once\n\t\t\t\t\t\tif ($(selector).length) {\n\t\t\t\t\t\t\t// Script ranks\n\t\t\t\t\t\t\tpi._tool.getRank(sender.id).forEach(rank => {\n\t\t\t\t\t\t\t\tswitch(rank) {\n\t\t\t\t\t\t\t\t\tcase \"Dev\":\n\t\t\t\t\t\t\t\t\t\t$(selector)[0].className += ' pi-dev';\n\t\t\t\t\t\t\t\t\t\t$(selector+' .un').before($('<i class=\"icon icon-pi-dev\" title=\"Plug-It Developer\"></i>'));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase \"Helper\":\n\t\t\t\t\t\t\t\t\t\t$(selector)[0].className += ' pi-helper';\n\t\t\t\t\t\t\t\t\t\t$(selector+' .un').before($('<i class=\"icon icon-pi-helper\" title=\"Plug-It Helper\"></i>'));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'Graphist':\n\t\t\t\t\t\t\t\t\t\t$(selector)[0].className += ' pi-graphist';\n\t\t\t\t\t\t\t\t\t\t$(selector+' .un').before($('<i class=\"icon icon-pi-graphist\" title=\"Plug-It Graphist\"></i>'));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'Translator':\n\t\t\t\t\t\t\t\t\t\t$(selector)[0].className += ' pi-translator';\n\t\t\t\t\t\t\t\t\t\t$(selector+' .un').before($('<i class=\"icon icon-pi-translator\" title=\"Plug-It Translator\"></i>'));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'Community Manager':\n\t\t\t\t\t\t\t\t\t\t$(selector)[0].className += ' pi-community-manager';\n\t\t\t\t\t\t\t\t\t\t$(selector+' .un').before($('<i class=\"icon icon-pi-community-manager\" title=\"Plug-It Community Manager\"></i>'));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'Donator':\n\t\t\t\t\t\t\t\t\t\t$(selector)[0].className += ' pi-donator';\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'Alpha':\n\t\t\t\t\t\t\t\t\t\t$(selector)[0].className += ' pi-alpha';\n\t\t\t\t\t\t\t\t\t\t$(selector+' .un').before($('<i class=\"icon icon-pi-alpha\" title=\"Plug-It Alpha tester\"></i>'));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'Bot':\n\t\t\t\t\t\t\t\t\t\t$(selector)[0].className += ' pi-bot';\n\t\t\t\t\t\t\t\t\t\t$(selector+' .un').before($('<i class=\"icon icon-pi-bot\" title=\"Plug-It Bot\"></i>'));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'Discord Bot':\n\t\t\t\t\t\t\t\t\t\t$(selector)[0].className += ' pi-discord-bot';\n\t\t\t\t\t\t\t\t\t\t$(selector+' .un').before($('<i class=\"icon icon-pi-discord-bot\" title=\"Plug-It Discord Bot\"></i>'));\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t// Plug ranks\n\t\t\t\t\t\t\tswitch(sender.gRole) {\n\t\t\t\t\t\t\t\tcase API.GLOBAL_ROLE.ADMIN:      $(selector)[0].className += ' role-admin'; break;\n\t\t\t\t\t\t\t\tcase API.GLOBAL_ROLE.AMBASSADOR: $(selector)[0].className += ' role-ambassador'; break;\n\t\t\t\t\t\t\t\tcase API.GLOBAL_ROLE.MODERATOR:  $(selector)[0].className += ' role-sitemod'; break;\n\t\t\t\t\t\t\t\tcase API.GLOBAL_ROLE.PLOT:       $(selector)[0].className += ' role-plot'; break;\n\t\t\t\t\t\t\t\tcase API.GLOBAL_ROLE.PROMOTER:   $(selector)[0].className += ' role-promoter'; break;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tswitch (sender.role) {\n\t\t\t\t\t\t\t\tcase API.ROLE.HOST:    $(selector)[0].className += ' role-host'; break;\n\t\t\t\t\t\t\t\tcase API.ROLE.COHOST:  $(selector)[0].className += ' role-cohost'; $(selector+' .icon-chat-host')[0].className = \"icon icon-chat-cohost\"; break;\n\t\t\t\t\t\t\t\tcase API.ROLE.MANAGER: $(selector)[0].className += ' role-manager'; break;\n\t\t\t\t\t\t\t\tcase API.ROLE.BOUNCER: $(selector)[0].className += ' role-bouncer'; break;\n\t\t\t\t\t\t\t\tcase API.ROLE.DJ:      $(selector)[0].className += ' role-dj'; break;\n\t\t\t\t\t\t\t\t// case API.ROLE.NONE:    $(selector)[0].className += ' role-user'; break;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// Additional ranks\n\t\t\t\t\t\t\tif (sender.sub == 1) $(selector)[0].className += ' role-subscriber';\n\t\t\t\t\t\t\tif (sender.silver) $(selector)[0].className += ' role-silver-subscriber';\n\t\t\t\t\t\t\tif (sender.friend) $(selector)[0].className += ' role-friend';\n\t\t\t\t\t\t\tif (settings.friendsIcons && sender.friend) {\n\t\t\t\t\t\t\t\t$(selector+' .timestamp').before($(emoji.replace_colons(':busts_in_silhouette:')).attr({\n\t\t\t\t\t\t\t\t\tclass: 'emoji-outer emoji-sizer pi-friendsIcons',\n\t\t\t\t\t\t\t\t\tstyle: 'margin-left: 2px;',\n\t\t\t\t\t\t\t\t\ttitle: 'You are friends with this user'\n\t\t\t\t\t\t\t\t}));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (settings.languageFlags) {\n\t\t\t\t\t\t\t\tvar flag;\n\n\t\t\t\t\t\t\t\tswitch(sender.language) {\n\t\t\t\t\t\t\t\t\tcase 'cs': flag = ':flag-cz:'; break;\n\t\t\t\t\t\t\t\t\tcase 'da': flag = ':flag-dk:'; break;\n\t\t\t\t\t\t\t\t\tcase 'en': flag = ':flag-gb:'; break;\n\t\t\t\t\t\t\t\t\tcase 'ja': flag = ':flag-jp:'; break;\n\t\t\t\t\t\t\t\t\tcase 'ko': flag = ':flag-kr:'; break;\n\t\t\t\t\t\t\t\t\tcase 'pi': flag = ':skull_and_crossbones:'; break;\n\t\t\t\t\t\t\t\t\tcase 'uk': flag = ':flag-ua:'; break;\n\t\t\t\t\t\t\t\t\tcase 'zh': flag = ':flag-cn:'; break;\n\t\t\t\t\t\t\t\t\tcase null: flag = ':heavy_multiplication_x:'; break;\n\t\t\t\t\t\t\t\t\tdefault: flag = ':flag-'+sender.language+':'; break;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tflag = $(emoji.replace_colons(flag)).attr({\n\t\t\t\t\t\t\t\t\tclass: 'emoji-outer emoji-sizer pi-languageFlags',\n\t\t\t\t\t\t\t\t\tstyle: settings.friendsIcons && sender.friend ? '' : 'margin-left: 2px;',\n\t\t\t\t\t\t\t\t\ttitle: modules.Lang.languages[(sender.language !== null ? sender.language : 'no language set')]\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t$(selector+' .timestamp').before(flag);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (settings.userInfo) {\n\t\t\t\t\t\t\t\t$(selector+' .timestamp').before('<span class=\"userInfo\">'+`<strong>LVL: </strong>${sender.level}<strong> | ID: </strong>${sender.id}`+'</span>');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Chat limit\n\t\t\t\t\t\t\tpi.betterClearChat(settings.chatLimit);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Adding a span on discordbot's messages to indicate a user\n\t\t\t\t\t\t// [user] text â <span class=\"discord-username\">user:</span> text\n\t\t\t\t\t\tif (pi._tool.getRank(sender.id).indexOf('Discord Bot') !== -1) {\n\t\t\t\t\t\t\tmsg.message = msg.message.replace(/^(\\[[^\\]]*\\])/, '<span class=\"discord-username\">$1</span>');\n\t\t\t\t\t\t\tif ($(selector).length) {\n\t\t\t\t\t\t\t\t$(selector).find('.text')[0].innerHTML = msg.message;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// split by line return, replace last item in array by msg.message formated, simple as that\n\t\t\t\t\t\t\t\t// Excepts when user doesn't send\n\t\t\t\t\t\t\t\tlet previousMsgs = $('#chat .cm.pi-discord-bot:last .text')[0].innerHTML.split('<br>');\n\t\t\t\t\t\t\t\tpreviousMsgs.pop();\n\t\t\t\t\t\t\t\tpreviousMsgs.push(msg.message);\n\t\t\t\t\t\t\t\t$('#chat .cm.pi-discord-bot:last .text')[0].innerHTML = previousMsgs.join('<br>');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Emojis\n\t\t\t\t\t\tlet emojiRE = new RegExp(':([a-z0-9-_]+):', 'ig');\n\t\t\t\t\t\tif (pi._tool.getPlugSettings().emoji && emojiRE.test(msg.message)) {\n\t\t\t\t\t\t\tlet match = emojiRE.exec(msg.message);\n\t\t\t\t\t\t\t// Doing it twice because the first time it returns null\n\t\t\t\t\t\t\tmatch = emojiRE.exec(msg.message);\n\n\t\t\t\t\t\t\twhile (match !== null) {\n\t\t\t\t\t\t\t\tfor (var emote in roomSettings.emotes) {\n\t\t\t\t\t\t\t\t\tif (match[1] == emote) {\n\t\t\t\t\t\t\t\t\t\tmsg.message = msg.message.replace(':'+emote+':', '<img style=\"max-width:100%;\" src=\"'+roomSettings.emotes[emote]+'\" alt=\"'+emote+'\"/>');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfor (var emote in emotes) {\n\t\t\t\t\t\t\t\t\tif (match[1] == emote) {\n\t\t\t\t\t\t\t\t\t\tmsg.message = msg.message.replace(':'+emote+':', '<img style=\"max-width:100%;\" src=\"'+roomSettings.emotes[emote]+'\" alt=\"'+emote+'\"/>');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tmatch = emojiRE.exec(msg.message);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttexts = $('.text.cid-'+msg.cid)[0].innerHTML.split('<br>');\n\t\t\t\t\t\t\ttexts[texts.length-1] = msg.message;\n\t\t\t\t\t\t\t$(\".text.cid-\"+msg.cid)[0].innerHTML = texts.join('<br>');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// gRole command self deletion\n\t\t\t\t\t\tif (settings.gRoleCmdSelfDel && API.getUser().gRole > API.ROLE.NONE && API.getUser().id === msg.uid && msg.message.indexOf('!') === 0) {\n\t\t\t\t\t\t\tAPI.moderateDeleteChat(msg.cid);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tchatDelete: function(message) {\n\t\t\t\t\t\tif (typeof message !== 'object') return;\n\n\t\t\t\t\t\tif ($('.cid-'+ message.p.c).length === 0) {\n\t\t\t\t\t\t\tvar secret = message.p.c.split('-');\n\t\t\t\t\t\t\tif (secret[0] == API.getUser().id && secret[1].length !== 13) {\n\t\t\t\t\t\t\t\tvar text = '';\n\t\t\t\t\t\t\t\tsecret[1].match(/.{1,3}/g).forEach((e,i,a) => {\n\t\t\t\t\t\t\t\t\ttext += String.fromCharCode(parseInt(e));\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tpi._tool.log(`New PM from [${API.getUser(message.p.mi).username}]\\n${text}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (settings.showDeletedMsg) {\n\t\t\t\t\t\t\t// using raw cid and then traversing to the .msg allows\n\t\t\t\t\t\t\t// to find the div even when chat has been merged\n\t\t\t\t\t\t\tlet $chat = $('.cid-'+message.p.c).closest('.cm');\n\t\t\t\t\t\t\tlet time = modules.utils.getSimpleTimestamp();\n\t\t\t\t\t\t\tlet user = API.getUser(message.p.c.split('-')[0]);\n\t\t\t\t\t\t\tlet mod = API.getUser(message.p.mi);\n\t\t\t\t\t\t\tlet $prevDelete = $chat.find('.pi-deleted[data-id=\"'+message.p.mi+'\"]');\n\n\t\t\t\t\t\t\tif (mod.gRole === API.ROLE.HOST ||\n\t\t\t\t\t\t\t\t(user.gRole > API.ROLE.NONE && user.id === mod.id) ||\n\t\t\t\t\t\t\t\tuser.gRole !== API.ROLE.HOST || user.gRole !== API.ROLE.MANAGER) {\n\t\t\t\t\t\t\t\t$chat.addClass('deleted');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$chat.find('.delete-button').remove();\n\t\t\t\t\t\t\tif ($prevDelete.length > 0) {\n\t\t\t\t\t\t\t\tlet newCount = parseInt($prevDelete.attr('data-count'))+1;\n\t\t\t\t\t\t\t\t// Increment count by one\n\t\t\t\t\t\t\t\t$prevDelete.attr(\"data-count\", newCount);\n\t\t\t\t\t\t\t\t$prevDelete.html(pi._tool.replaceString(lang.userchat.chatDelete, {mod: mod.username, newCount: '(x'+newCount+')', time: time}));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$chat.find('.msg').after($(`<span class=\"pi-deleted\" data-id=\"${message.p.mi}\" data-count=\"1\">${pi._tool.replaceString(lang.userchat.chatDelete, {mod: mod.username, newCount: '', time: time})}</span>`));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// chat split with API.chatLog then delete it\n\t\t\t\t\t\t\tpi._tool.log('This is to fix deleted messages', 'chat').delete();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tstreamDisabled: function() {\n\t\t\t\t\t\tvar streamDisabled = modules.plugOptions.settings.streamDisabled;\n\t\t\t\t\t\tvar icon = $('#pi-toggleStream .pi-toggleStream')[0];\n\n\t\t\t\t\t\ticon.className = streamDisabled ? 'icon pi-toggleStream off' : 'icon pi-toggleStream';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t_DOMEvent: {\n\t\t\t\t\tchatAutocompletion: function(e) {\n\t\t\t\t\t\tif ($(this).data(\"lastval\") !== this.value) {\n\t\t\t\t\t\t\t$(this).data(\"lastval\", this.value);\n\t\t\t\t\t\t\t /* if (this.value.charAt(0) === '/') {\n\t\t\t\t\t\t\t\t$(\"#chat-suggestion\").css({'height':342, 'display':'block'});\n\t\t\t\t\t\t\t\t$(\"#chat-suggestion-items\").append($(\n\t\t\t\t\t\t\t\t\t'<div class=\"chat-suggestion-item online emo\" data-index=\"0\" style=\"background: transparent;\">'+\n\t\t\t\t\t\t\t\t\t\t'<div class=\"image\">'+\n\t\t\t\t\t\t\t\t\t\t\t'<span class=\"emoji-outer emoji-sizer\"><span data-emoji-name=\"sagittarius\" class=\"emoji-inner extplug-emoji-sagittarius\" style=\"background-position:2.5% 82.5%;background-size:4100%\"></span></span>'+\n\t\t\t\t\t\t\t\t\t\t'</div>'+\n\t\t\t\t\t\t\t\t\t\t'<span class=\"value\">:sagittarius:</span>'+\n\t\t\t\t\t\t\t\t\t\t'<div class=\"chat-suggestion-item-line\"></div>'+\n\t\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t\t));\n\t\t\t\t\t\t\t} */\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcollideRanks: function() {\n\t\t\t\t\t\tlet groupDetect = setInterval(function() {\n\t\t\t\t\t\t\tlet group = $('.group');\n\t\t\t\t\t\t\tif (!group.length) return;\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t$('.group').css('cursor', 'pointer');\n\t\t\t\t\t\t\t\t$('.group').on('click', function() {\n\t\t\t\t\t\t\t\t\t$(this).nextUntil('.group').slideToggle();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tclearInterval(groupDetect);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, 10);\n\t\t\t\t\t},\n\t\t\t\t\tkeyboardShortcuts: function(e) {\n\t\t\t\t\t\tif (settings.keyboardShortcuts) {\n\t\t\t\t\t\t\tswitch (e.key) {\n\t\t\t\t\t\t\t\tcase '+':\n\t\t\t\t\t\t\t\t\tif (!$('#chat-input').hasClass('focused') &&\n\t\t\t\t\t\t\t\t\t\t\t!$(':focus').length &&\n\t\t\t\t\t\t\t\t\t\t  !$('.dialog').length) {\n\t\t\t\t\t\t\t\t\t\tAPI.setVolume(API.getVolume()+5);\n\t\t\t\t\t\t\t\t\t\tpi._tool.setPlugSettings('volume', API.getVolume());\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase '-':\n\t\t\t\t\t\t\t\t\tif (!$('#chat-input').hasClass('focused') &&\n\t\t\t\t\t\t\t\t\t\t\t!$(':focus').length &&\n\t\t\t\t\t\t\t\t\t\t  !$('.dialog').length) {\n\t\t\t\t\t\t\t\t\t\tAPI.setVolume(API.getVolume()-5);\n\t\t\t\t\t\t\t\t\t\tpi._tool.setPlugSettings('volume', API.getVolume());\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'h':\n\t\t\t\t\t\t\t\t\tif (!$('#chat-input').hasClass('focused') &&\n\t\t\t\t\t\t\t\t\t\t\t!$(':focus').length &&\n\t\t\t\t\t\t\t\t\t\t  !$('.dialog').length) {\n\t\t\t\t\t\t\t\t\t\tpi.menu('video');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'l':\n\t\t\t\t\t\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\tpi.betterClearChat(settings.betterClearChatLimit);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'b':\n\t\t\t\t\t\t\t\t\tif (session.floodAPI) return pi._tool.log(lang.error.APIFloodInEffect, 'chat error');\n\t\t\t\t\t\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\tvar targetUser = API.getUserByName($('#user-rollover .username')[0].innerText);\n\t\t\t\t\t\t\t\t\t\tif (targetUser && API.hasPermission(null, API.ROLE.MANAGER)) {\n\t\t\t\t\t\t\t\t\t\t\tif (sessionStorage.getItem('FastBan Warn')) {\n\t\t\t\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\t\t\t\t\t\t\t\turl: '/_/bans/add',\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"userID\": targetUser.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"reason\": 1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"duration\": 'f'\n\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\terror: function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontentType: 'application/json'\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(lang.warn.fastBan, 'warn chat', function() {\n\t\t\t\t\t\t\t\t\t\t\t\t\tsessionStorage.setItem('FastBan Warn', true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Emulating ctrl + b will be just as long.. (haven't found a way to make trigger works with jQuery)\n\t\t\t\t\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: \"/_/bans/add\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"userID\":targetUser.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"reason\":1,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"duration\": \"f\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataType: \"json\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontentType: \"application/json\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} else pi._tool.log(lang.info.fastBanHelp, 'info chat');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'w':\n\t\t\t\t\t\t\t\tcase 'm':\n\t\t\t\t\t\t\t\t\tif (!$('#chat-input').hasClass('focused') &&\n\t\t\t\t\t\t\t\t\t\t\t!$(':focus').length &&\n\t\t\t\t\t\t\t\t\t\t  !$('.dialog').length) {\n\t\t\t\t\t\t\t\t\t\tlet now = new Date().getTime();\n\t\t\t\t\t\t\t\t\t\t// Avoid spamming woot/meh\n\t\t\t\t\t\t\t\t\t\tif (now - cooldown.voteShortcut >= 5000 && $(\":focus\").length === 0) {\n\t\t\t\t\t\t\t\t\t\t\tcooldown.voteShortcut = now;\n\t\t\t\t\t\t\t\t\t\t\tif (e.key === 'w') $('#woot').click();\n\t\t\t\t\t\t\t\t\t\t\telse $('#meh').click();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'g':\n\t\t\t\t\t\t\t\t\tif (session.floodAPI) return pi._tool.log(lang.error.APIFloodInEffect, 'chat error');\n\t\t\t\t\t\t\t\t\tif (!$('#chat-input').hasClass('focused') &&\n\t\t\t\t\t\t\t\t\t\t\t!$(':focus').length &&\n\t\t\t\t\t\t\t\t\t\t  !$('.dialog').length &&\n\t\t\t\t\t\t\t\t\t\t  API.getDJ().id !== API.getUser().id) {\n\n\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\t\ttype: 'GET',\n\t\t\t\t\t\t\t\t\t\t\turl: '/_/rooms/state',\n\t\t\t\t\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.getPlaylists(function(playlists) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\t\t\t\t\t\t\t\t\turl: \"/_/grabs\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tplaylistID: playlists.filter(x => x.active)[0].id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thistoryID: data.data[0].playback.historyID\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: function(err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (err.responseJSON.status === \"maxItems\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(lang.error.playlistFull, 'error');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log([lang.error.cannotGrab, err.responseText], 'error');\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tdataType: \"json\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tcontentType: \"application/json\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\terror: function(err) {\n\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(lang.error.cannotGetMediaID, 'error chat');\n\t\t\t\t\t\t\t\t\t\t\t\tconsole.error(err);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'G':\n\t\t\t\t\t\t\t\t\tif (session.floodAPI) return pi._tool.log(lang.error.APIFloodInEffect, 'chat error');\n\t\t\t\t\t\t\t\t\tif (!$('#chat-input').hasClass('focused') &&\n\t\t\t\t\t\t\t\t\t\t\t!$(':focus').length &&\n\t\t\t\t\t\t\t\t\t\t  !$('.dialog').length &&\n\t\t\t\t\t\t\t\t\t\t  API.getDJ().id !== API.getUser().id) {\n\t\t\t\t\t\t\t\t\t\tpi._tool.getPlaylists(function(playlists) {\n\t\t\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\t\t\t\t\t\t\turl: '/_/playlists/'+playlists.filter(x => x.active)[0].id+'/media/insert',\n\t\t\t\t\t\t\t\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\t\t\t\t\t\t\t\tmedia: [API.getMedia()],\n\t\t\t\t\t\t\t\t\t\t\t\t\tappend: true,\n\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\terror: function(err) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (err.responseJSON.status === \"maxItems\")\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(lang.error.playlistFull, 'error');\n\t\t\t\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log([lang.error.cannotGrab, err.responseText], 'error');\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\tdataType: \"json\",\n\t\t\t\t\t\t\t\t\t\t\t\tcontentType: \"application/json\"\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'ArrowRight':\n\t\t\t\t\t\t\t\t\tif (session.floodAPI) return pi._tool.log(lang.error.APIFloodInEffect, 'chat error');\n\t\t\t\t\t\t\t\t\tif (e.ctrlKey &&\n\t\t\t\t\t\t\t\t\t\tAPI.getDJ().id === API.getUser().id &&\n\t\t\t\t\t\t\t\t\t\t!$('#chat-input').hasClass('focused') &&\n\t\t\t\t\t\t\t\t\t\t!$(':focus').length &&\n\t\t\t\t\t\t\t\t\t\t!$('.dialog').length) {\n\t\t\t\t\t\t\t\t\t\t$.post(\"/_/booth/skip/me\");\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'Tab':\n\t\t\t\t\t\t\t\t\tif (!$('.dialog').length) {\n\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t$('#chat-input-field').focus();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'Enter':\n\t\t\t\t\t\t\t\t\tif ($('.dialog-frame .button.submit').length) $('.dialog-frame .button.submit').click();\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\tcase 'Escape':\n\t\t\t\t\t\t\t\t\tlet backDivSelector = '#footer-user.showing .back,'+\n\t\t\t\t\t\t\t\t\t\t'.app-header #history-button.selected,'+\n\t\t\t\t\t\t\t\t\t\t'#app-menu.open .button,'+\n\t\t\t\t\t\t\t\t\t\t'#playlist-button .icon-arrow-down,'+\n\t\t\t\t\t\t\t\t\t\t'.dialog .icon-dialog-close';\n\n\t\t\t\t\t\t\t\t\tif ($(backDivSelector).length) $(backDivSelector).click();\n\t\t\t\t\t\t\t\t\telse if ($('#chat-input-field').is(':focus')) $('#chat-input-field').blur();\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tlevelPercentage: function() {\n\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t// Quick and dirty fix for rcs also changing the xp %\n\t\t\t\t\t\t\tif (typeof rcs !== \"undefined\" ||\n\t\t\t\t\t\t\t\t$('#footer-user .bar .value').text().indexOf('%') > -1)\n\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t// [rawText, xpNow, xpMax]\n\t\t\t\t\t\t\tlet numbers = $('#footer-user .bar .value')[0].innerText.match(/(\\d*[,.]?\\d*)(?: \\/ )(\\d*[,.]?\\d*)/);\n\t\t\t\t\t\t\tif (numbers === null) return;\n\n\t\t\t\t\t\t\tlet xp1 = parseFloat(numbers[1].replace(/[,.]/g,''));\n\t\t\t\t\t\t\tlet xp2 = parseFloat(numbers[2].replace(/[,.]/g,''));\n\t\t\t\t\t\t\tlet percentage = (xp1/xp2*100).toFixed(2);\n\n\t\t\t\t\t\t\t$('#footer-user .bar .value')[0].innerText = numbers[0].replace(/,/g, '.') + ' ('+percentage+'%)';\n\t\t\t\t\t\t\t$('#footer-user .info .meta .bar .value').one('DOMSubtreeModified', pi._DOMEvent.levelPercentage);\n\t\t\t\t\t\t}, 100);\n\t\t\t\t\t},\n\t\t\t\t\tnavWarn: function(e) {\n\t\t\t\t\t\tvar dialogText = lang.log.leaving;\n\n\t\t\t\t\t\tif (settings.navWarn) {\n\t\t\t\t\t\t\t(e || window.event).returnValue = dialogText;\n\t\t\t\t\t\t\treturn dialogText;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tpopout: function() {\n\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\twindow.popout = window.open('','plugdjpopout');\n\t\t\t\t\t\t\tvar $tyles = [\n\t\t\t\t\t\t\t\t$('<link id=\"pi-popout-menu\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.popout+'\">')\n\t\t\t\t\t\t\t];\n\n\t\t\t\t\t\t\tif (settings.roomStyle) {\n\t\t\t\t\t\t\t\t$tyles.push($('<link id=\"pi-custom-room-style\" rel=\"stylesheet\" type=\"text/css\" href=\"'+roomSettings.css+'\">'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (settings.CSS) {\n\t\t\t\t\t\t\t\t$tyles.push($('<link id=\"pi-popout-blue\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.popout_blue+'\">'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (settings.customRanks) {\n\t\t\t\t\t\t\t\t$tyles.push($('<link id=\"pi-custom_ranks\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.custom_ranks+'\">'));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (settings.oldChat) {\n\t\t\t\t\t\t\t\t$tyles.push($('<link id=\"pi-oldchat-CSS\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.old_chat+'\">'));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$('head', popout.document).append($tyles);\n\t\t\t\t\t\t\t$('#volume', popout.document).on('mousewheel', pi._DOMEvent.volumeWheel);\n\t\t\t\t\t\t\t// Add another onbeforeunload event listener to the page since plug handles it too and popout.close\n\t\t\t\t\t\t\t// doesn't work for some reason..\n\t\t\t\t\t\t\tmeldBefore(popout, 'onbeforeunload', () => {\n\t\t\t\t\t\t\t\tpopout = null;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, 2000);\n\t\t\t\t\t},\n\t\t\t\t\tresize: function() {\n\t\t\t\t\t\t//let PLAYLIST_OFFSET = 108;\n\t\t\t\t\t\tlet MIN_WIDTH = 1150;\n\t\t\t\t\t\tlet MIN_HEIGHT = 638;\n\t\t\t\t\t\tlet CHAT_WIDTH = 345;\n\t\t\t\t\t\tlet BAR_HEIGHT = 54;\n\t\t\t\t\t\t// let BAR_WIDTH = CHAT_WIDTH + BAR_HEIGHT;\n\t\t\t\t\t\tlet availWidth = Math.max(MIN_WIDTH, window.innerWidth) - CHAT_WIDTH;\n\t\t\t\t\t\tlet availHeight = Math.max(MIN_HEIGHT, window.innerHeight);\n\t\t\t\t\t\tlet n = availHeight - BAR_HEIGHT - 800;\n\t\t\t\t\t\tlet bgTop = Math.min(BAR_HEIGHT, n);\n\n\t\t\t\t\t\tif (!pi._tool.getPlugSettings().videoOnly) {\n\t\t\t\t\t\t\t$('#pi-background').css('left', (availWidth - 1600) / 2)\n\t\t\t\t\t\t\t.css('top', bgTop).width(1600).height(900);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$('#pi-background').css('left', 0)\n\t\t\t\t\t\t\t.css('top', BAR_HEIGHT).width(availWidth).height(availHeight - BAR_HEIGHT * 2);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tvolumeWheel: function(e) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t// If ctrlKey pressed thinner iteration\n\t\t\t\t\t\tvar i = e.ctrlKey ? 1 : 5;\n\n\t\t\t\t\t\tif (e.originalEvent.deltaY > 0) API.setVolume(API.getVolume()-i);\n\t\t\t\t\t\telse if (e.originalEvent.deltaY < 0) API.setVolume(API.getVolume()+i);\n\n\t\t\t\t\t\tpi._tool.setPlugSettings('volume', API.getVolume());\n\t\t\t\t\t},\n\t\t\t\t\ttranslate: function(e) {\n\t\t\t\t\t\tif (e.target.classList.contains('translated')) {\n\t\t\t\t\t\t\te.target.innerHTML = e.target.getAttribute('data-originalText');\n\t\t\t\t\t\t\te.target.removeAttribute('data-originalText');\n\t\t\t\t\t\t\te.target.classList.remove('translated');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (e.target.classList.contains('text')) {\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\ttype: 'GET',\n\t\t\t\t\t\t\t\turl: 'https://translate.googleapis.com/translate_a/single?client=gtx&dt=t'+\n\t\t\t\t\t\t\t\t'&sl=auto'+\n\t\t\t\t\t\t\t\t'&tl='+API.getUser().language+\n\t\t\t\t\t\t\t\t\"&q=\"+ encodeURI(e.target.innerHTML),\n\t\t\t\t\t\t\t\terror: function(err) {\n\t\t\t\t\t\t\t\t\tvar data = JSON.parse(err.responseText.split(\",\").filter(a => {return a.length}).join(\",\"));\n\t\t\t\t\t\t\t\t\tvar sourceText = data[0][0][1];\n\t\t\t\t\t\t\t\t\tvar translatedText = data[0][0][0];\n\t\t\t\t\t\t\t\t\tvar sourceLangISO = data[1];\n\n\t\t\t\t\t\t\t\t\te.target.setAttribute('data-originalText', e.target.innerHTML);\n\t\t\t\t\t\t\t\t\te.target.innerHTML = translatedText;\n\t\t\t\t\t\t\t\t\te.target.classList.add('translated');\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tsuccess: function (data) {\n\t\t\t\t\t\t\t\t\tvar sourceText = data[0][0][1];\n\t\t\t\t\t\t\t\t\tvar translatedText = data[0][0][0];\n\n\t\t\t\t\t\t\t\t\te.target.setAttribute('data-originalText', e.target.innerHTML);\n\t\t\t\t\t\t\t\t\te.target.innerHTML = translatedText;\n\t\t\t\t\t\t\t\t\te.target.classList.add('translated');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t_load: function() {\n\t\t\t\t\tupdateStatus('Initalizating modules', 3);\n\t\t\t\t\t$.each(require.s.contexts._.defined, (n, obj) => {\n\t\t\t\t\t\tif (!obj) return;\n\t\t\t\t\t\tobj._moduleID = n;\n\n\t\t\t\t\t\tif (obj._moduleID && obj._moduleID === 'lang/Lang')\n\t\t\t\t\t\t\tmodules.Lang = obj;\n\t\t\t\t\t\tif (obj._events && obj._events[\"chat:receive\"])\n\t\t\t\t\t\t\tmodules.context = obj;\n\t\t\t\t\t\tif (obj.STATE)\n\t\t\t\t\t\t\tmodules.RoomEvent = obj;\n\t\t\t\t\t\tif (obj.attributes && obj.attributes.hostID)\n\t\t\t\t\t\t\tmodules.room = obj;\n\t\t\t\t\t\tif (obj._l)\n\t\t\t\t\t\t\tmodules.user = obj;\n\t\t\t\t\t\tif (obj.log)\n\t\t\t\t\t\t\tmodules.chatFacade = obj;\n\t\t\t\t\t\tif (obj.defaultSettings)\n\t\t\t\t\t\t\tmodules.plugOptions = obj;\n\t\t\t\t\t\tif (obj.hasOwnProperty(\"isorx\"))\n\t\t\t\t\t\t\tmodules.utils = obj;\n\t\t\t\t\t\tif (obj.SHOW && obj.SHOW === \"ShowDialogEvent:show\")\n\t\t\t\t\t\t\tmodules.ShowDialogEvent = obj;\n\t\t\t\t\t\tif (obj.prototype && obj.prototype.id && obj.prototype.id === \"dialog-gift-send\")\n\t\t\t\t\t\t\tmodules.GiftSendDialog = obj;\n\t\t\t\t\t\tif (obj.prototype && obj.prototype.defaults && obj.prototype.defaults._position)\n\t\t\t\t\t\t\tmodules.User = obj;\n\t\t\t\t\t});\n\t\t\t\t\tmodules.lang = require('lang/Lang');\n\t\t\t\t\tupdateStatus('Initalizating API & Events listener', 4);\n\t\t\t\t\t// Add custom events to the API\n\t\t\t\t\tpi._extendAPI.init();\n\t\t\t\t\tfor (var event in pi._event) {\n\t\t\t\t\t\tAPI.on(event, pi._event[event]);\n\t\t\t\t\t}\n\t\t\t\t\tpi._tool.plugSocketHook.init();\n\t\t\t\t\tmodules.context.on('chat:receive', pi._modulesEvent.chatReceive);\n\t\t\t\t\tmodules.originalChatDelete = modules.context._events['chat:delete'][0].callback;\n\t\t\t\t\tmodules.context._events['chat:delete'][0].callback = pi._modulesEvent.chatDelete;\n\t\t\t\t\tmodules.context.on('change:streamDisabled', pi._modulesEvent.streamDisabled);\n\n\t\t\t\t\t// Bind events to their handler\n\t\t\t\t\twindow.onbeforeunload = pi._DOMEvent.navWarn;\n\t\t\t\t\t$(window).on('keydown', pi._DOMEvent.keyboardShortcuts);\n\t\t\t\t\t$(window).on('dblclick', pi._DOMEvent.translate);\n\t\t\t\t\t$('#volume, #playback-controls').on('mousewheel', pi._DOMEvent.volumeWheel);\n\t\t\t\t\t$('.button.staff').on('click', pi._DOMEvent.collideRanks);\n\t\t\t\t\t$('#chat-popout-button').on('click', pi._DOMEvent.popout);\n\t\t\t\t\t$(\"#chat-input-field\").on('input', pi._DOMEvent.chatAutocompletion);\n\t\t\t\t\t$(document).on('ajaxSuccess', pi._DOMEvent.updateRoomSettings);\n\t\t\t\t\t// Execute it at least once, avoid to wait a gain of XP\n\t\t\t\t\tpi._DOMEvent.levelPercentage();\n\n\t\t\t\t\t// Retrieve user settings if available\n\t\t\t\t\tupdateStatus('Loading user settings', 5);\n\t\t\t\t\tvar ls = localStorage.getItem('pi-settings');\n\t\t\t\t\tif (typeof ls === 'string') {\n\t\t\t\t\t\tvar userSettings = JSON.parse(ls);\n\n\t\t\t\t\t\tfor (var item in settings) {\n\t\t\t\t\t\t\t// Adding new elements on update release\n\t\t\t\t\t\t\tif (typeof userSettings[item] === 'undefined') {\n\t\t\t\t\t\t\t\tuserSettings[item] = settings[item];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor (var userItem in userSettings) {\n\t\t\t\t\t\t\t// Checking if user has more settings than necessary\n\t\t\t\t\t\t\tif (typeof settings[userItem] === 'undefined') {\n\t\t\t\t\t\t\t\tdelete userSettings[userItem];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlocalStorage.setItem('pi-settings', JSON.stringify(userSettings));\n\t\t\t\t\t\tsettings = userSettings;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpi._tool.saveSettings();\n\t\t\t\t\t}\n\n\t\t\t\t\t// Those settings are available even after reload\n\t\t\t\t\tif (sessionStorage.getItem('modSkipWarn') === null) {\n\t\t\t\t\t\tsessionStorage.setItem('modSkipWarn', false);\n\t\t\t\t\t\tsessionStorage.setItem('modQuitWarn', false);\n\t\t\t\t\t\tsessionStorage.setItem('trustWarn', false);\n\t\t\t\t\t\tsessionStorage.setItem('fastBanWarn', false);\n\t\t\t\t\t\tsessionStorage.setItem('helpCommands', false);\n\t\t\t\t\t\tsessionStorage.setItem('removeLabelWarn', false);\n\t\t\t\t\t}\n\t\t\t\t\t// setInterval\n\t\t\t\t\twindow.friendsOnline = setInterval(function() {\n\t\t\t\t\t\tpi._tool.getFriends(\n\t\t\t\t\t\t\tfunction(friends) {\n\t\t\t\t\t\t\t\tif (settings.unfriended) {\n\t\t\t\t\t\t\t\t\t// Not using sessionStorage here to be able to track\n\t\t\t\t\t\t\t\t\t// at any time, even after reboot\n\t\t\t\t\t\t\t\t\tvar friendsInStorage = localStorage.getItem('pi-friends');\n\n\t\t\t\t\t\t\t\t\tif (friendsInStorage !== null) {\n\t\t\t\t\t\t\t\t\t\tfriendsInStorage = JSON.parse(friendsInStorage);\n\n\t\t\t\t\t\t\t\t\t\tif (friends.length < friendsInStorage.length) {\n\t\t\t\t\t\t\t\t\t\t\tvar unfriends = friendsInStorage.filter(user => {\n\t\t\t\t\t\t\t\t\t\t\t\tlet inArray = false;\n\n\t\t\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < friends.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (friends[i].id === user.id) inArray = true;\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn !inArray;\n\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\tunfriends.forEach(function(friend) {\n\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.info.unfriended, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tfriend: friend.username,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsad: emoji.replace_colons(':cry:')\n\t\t\t\t\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t\t\t\t\t\t'info chat'\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tlocalStorage.setItem('pi-friends', JSON.stringify(friends));\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar friendsOnline = [];\n\t\t\t\t\t\t\t\tfor (var i = 0; i < friends.length; i++) {\n\t\t\t\t\t\t\t\t\tif (typeof friends[i].status == 'undefined') friendsOnline.push(friends[i]);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Display how many friends are online next to friends request count\n\t\t\t\t\t\t\t\tvar count = $('#friends-button > span')[0].innerText.replace(/[0-9]*\\//g,'');\n\t\t\t\t\t\t\t\tcount = friendsOnline.length + '/' + count;\n\t\t\t\t\t\t\t\t$('#friends-button > span')[0].innerText = count;\n\n\t\t\t\t\t\t\t\t// Notification for friend connect/disconnected/room change\n\t\t\t\t\t\t\t\tif (settings.friendConnect || settings.friendDisconnect || settings.friendRoomChange) {\n\t\t\t\t\t\t\t\t\tvar storage = sessionStorage.getItem('friendsOnline');\n\t\t\t\t\t\t\t\t\tif (storage === null) sessionStorage.setItem('friendsOnline', JSON.stringify(friendsOnline));\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\tstorage = JSON.parse(storage);\n\n\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < friendsOnline.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\tvar isInArray = false;\n\n\t\t\t\t\t\t\t\t\t\t\tfor (var j = 0; j < storage.length; j++) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (friendsOnline[i].id == storage[j].id) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tisInArray = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (friendsOnline[i].room.id !== storage[j].room.id &&\n\t\t\t\t\t\t\t\t\t\t\t\t \t    settings.friendRoomChange) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (friendsOnline[i].room.slug == 'dashboard')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlang.log.friendRoomChangeDashboard,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{friend: friendsOnline[i].username}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t), 'chat'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlang.log.friendRoomChange,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{friend: friendsOnline[i].username, link: friendsOnline[i].room.slug, name: friendsOnline[i].room.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t), 'chat'\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t).div.find('a').on('click', {friend: friendsOnline[i]}, function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet slug = e.data.friend.room.slug,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t    name = e.data.friend.room.name;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodules.context.dispatch(new modules.RoomEvent(modules.RoomEvent.JOIN, slug, name));\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (!isInArray && settings.friendConnect) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (typeof friendsOnline[i].room.name === 'undefined') {\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Went online in dashboard, message is slightly different\n\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlang.log.friendConnectDashboard,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{friend: friendsOnline[i].username}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t), 'chat'\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlang.log.friendConnect,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{friend: friendsOnline[i].username, link: friendsOnline[i].room.slug, name: friendsOnline[i].room.name}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t), 'chat'\n\t\t\t\t\t\t\t\t\t\t\t\t\t).div.find('a').on('click', {friend: friendsOnline[i]}, function(e) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet slug = e.data.friend.room.slug,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t    name = e.data.friend.room.name;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tmodules.context.dispatch(new modules.RoomEvent(modules.RoomEvent.JOIN, slug, name));\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tfor (var i = 0; i < storage.length; i++) {\n\t\t\t\t\t\t\t\t\t\t\tvar isInArray = false;\n\n\t\t\t\t\t\t\t\t\t\t\tfor (var j = 0; j < friendsOnline.length; j++) {\n\t\t\t\t\t\t\t\t\t\t\t\tif (storage[i].id == friendsOnline[j].id) isInArray = true;\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\tif (!isInArray && settings.friendDisconnect) {\n\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlang.log.friendDisconnect,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{friend: storage[i].username}\n\t\t\t\t\t\t\t\t\t\t\t\t\t), 'chat'\n\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tsessionStorage.setItem('friendsOnline', JSON.stringify(friendsOnline));\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t}, 30*1000);\n\t\t\t\t\twindow.roomURL = location.pathname;\n\t\t\t\t\twindow.checkIfRoomChanged = setInterval(function() {\n\t\t\t\t\t\tif (location.pathname !== window.roomURL) {\n\t\t\t\t\t\t\twindow.roomURL = location.pathname; // If not set, script will reload infinitely\n\t\t\t\t\t\t\tclearInterval(window.checkIfRoomChanged);\n\t\t\t\t\t\t\tpi._reload('roomChange');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 2*1000);\n\t\t\t\t\t// Creating DOM elements\n\t\t\t\t\tupdateStatus('Creating script environement', 6);\n\t\t\t\t\t// Menu icon\n\t\t\t\t\t$('#app').append($('<div id=\"pi-logo\"><div id=\"icon\"></div></div>'));\n\t\t\t\t\t// SoundCloud visualizer's custom iframe\n\t\t\t\t\t$('#playback-container').append($(\n\t\t\t\t\t\t'<iframe id=\"pi-frame\" frameborder=\"0\" src=\"\"></iframe>'\n\t\t\t\t\t).css({\n\t\t\t\t\t\t\"display\": \"none\",\n\t\t\t\t\t\t\"position\": \"absolute\",\n\t\t\t\t\t\t\"top\": \"0\",\n\t\t\t\t\t\t\"left\": \"0\",\n\t\t\t\t\t\t\"z-index\": \"5\",\n\t\t\t\t\t\t\"width\": \"100%\",\n\t\t\t\t\t\t\"height\": \"100%\"\n\t\t\t\t\t}));\n\t\t\t\t\t// Custom room background\n\t\t\t\t\t$('.room-background').after($('<div id=\"pi-background\"></div>').css({\n\t\t\t\t\t\t\"display\": \"none\",\n\t\t\t\t\t\t\"position\": \"absolute\",\n\t\t\t\t\t\t\"top\": (Math.min(54, ((Math.max(638, window.innerHeight)) - 54 - 800))),\n\t\t\t\t\t\t\"left\": (Math.max(1150, window.innerWidth) - 345 - 1600) / 2,\n\t\t\t\t\t\t\"width\": \"1600px\",\n\t\t\t\t\t\t\"height\": \"900px\",\n\t\t\t\t\t\t\"background\": \"url(\"+settings.customBGURL+\") no-repeat\"\n\t\t\t\t\t}));\n\t\t\t\t\t// Menu itself\n\t\t\t\t\t$('#app').append($(\n\t\t\t\t\t\t'<div id=\"pi-menu\" style=\"display: none;\">'+\n\t\t\t\t\t\t\t'<ul>'+\n\t\t\t\t\t\t\t\t'<h2>'+lang.menu.general.title+'</h2>'+\n\t\t\t\t\t\t\t\t'<ul style=\"display: none;\">'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-woot\">'+lang.menu.general.autoWoot+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-join\">'+lang.menu.general.autoJoin+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-keyShortcut\">'+lang.menu.general.keyboardShortcuts+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-chatCommands\">'+lang.menu.general.chatCommands+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-autoHideLogs\">'+lang.menu.general.autoHideLogs+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-autoHideLogsAfter\">'+\n\t\t\t\t\t\t\t\t\t\t'<label for=\"autoHideLogsAfter\">'+lang.menu.general.autoHidelogsLabel+'</label>'+\n\t\t\t\t\t\t\t\t\t\t'<input type=\"number\" min=\"1\" max=\"3600\" step=\"1\" value=\"'+settings.autoHideLogsAfter+'\" name=\"autoHideLogsAfter\"/>'+\n\t\t\t\t\t\t\t\t\t'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-mutemeh\">'+lang.menu.general.muteMeh+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-afkResponder\">'+lang.menu.general.afkResponder+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-afkMessage\">'+\n\t\t\t\t\t\t\t\t\t\t'<input type=\"text\" placeholder=\"'+lang.menu.general.afkResponderPlaceholder+'\"/>'+\n\t\t\t\t\t\t\t\t\t'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-navWarn\">'+lang.menu.general.navigationWarn+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-showVotes\">'+lang.menu.general.showVotes+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-betterClearChatLimit\">'+\n\t\t\t\t\t\t\t\t\t\t'<label for=\"betterClearLimit\">'+lang.menu.general.clearChatLimitLabel+'</label>'+\n\t\t\t\t\t\t\t\t\t\t'<input type=\"number\" min=\"0\" max=\"512\" step=\"1\" value=\"'+settings.betterClearChatLimit+'\" name=\"betterClearLimit\"/>'+\n\t\t\t\t\t\t\t\t\t'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-chatLimit\">'+\n\t\t\t\t\t\t\t\t\t\t'<label for=\"chatLimit\">'+lang.menu.general.chatLimitLabel+'</label>'+\n\t\t\t\t\t\t\t\t\t\t'<input type=\"number\" min=\"1\" max=\"512\" step=\"1\" value=\"'+settings.chatLimit+'\" name=\"chatLimit\"/>'+\n\t\t\t\t\t\t\t\t\t'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-skipNextMediaInHistory\">'+lang.menu.general.skipNextMediaHistory+'</li>'+\n\t\t\t\t\t\t\t\t'</ul>'+\n\t\t\t\t\t\t\t\t'<h2>'+lang.menu.customisation.title+'</h2>'+\n\t\t\t\t\t\t\t\t'<ul style=\"display: none;\">'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-video\">'+lang.menu.customisation.hideVideo+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-soundcloudVisu\">'+lang.menu.customisation.scVisu+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-css\">'+lang.menu.customisation.customStyle+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-customRanks\">'+lang.menu.customisation.customRanks+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-languageFlags\">'+lang.menu.customisation.languageFlags+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-friendsIcons\">'+lang.menu.customisation.friendsIcons+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-bg\">'+lang.menu.customisation.customBG+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-old-chat\">'+lang.menu.customisation.oldChat+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-old-footer\">'+lang.menu.customisation.oldFooter+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-small-history\">'+lang.menu.customisation.smallHistory+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-small-friends\">'+lang.menu.customisation.smallFriends+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-small-playlists\">'+lang.menu.customisation.smallPlaylists+'</li>'+\n\t\t\t\t\t\t\t\t'</ul>'+\n\t\t\t\t\t\t\t\t'<h2>'+lang.menu.moderation.title+'</h2>'+\n\t\t\t\t\t\t\t\t'<ul style=\"display: none;\">'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-showDeletedMsg\">'+lang.menu.moderation.showDeletedMsg+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-confirmDelete\">'+lang.menu.moderation.confirmChatDeletion+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-userInfo\">'+lang.menu.moderation.userInformation+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-stuckSkip\">'+lang.menu.moderation.skipStuckSongs+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-lengthA\">'+lang.menu.moderation.songLimit+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-songLength\">'+\n\t\t\t\t\t\t\t\t\t\t'<input type=\"text\" placeholder=\"'+lang.menu.moderation.songLimitPlaceholder+'\"/>'+\n\t\t\t\t\t\t\t\t\t'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-historyA\">'+lang.menu.moderation.historyAlert+'</li>'+\n\t\t\t\t\t\t\t\t'</ul>'+\n\t\t\t\t\t\t\t\t'<h2>'+lang.menu.notifications.title+'</h2>'+\n\t\t\t\t\t\t\t\t'<ul style=\"display: none;\">'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-systemNotifications\">'+lang.menu.notifications.systemNotifications+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-songStats\">'+lang.menu.notifications.songStats+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-boothAlert\">'+lang.menu.notifications.boothAlert+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-boothPosition\">'+\n\t\t\t\t\t\t\t\t\t\t'<label for=\"boothPosition\">'+lang.menu.notifications.boothPositionLabel+'</label>'+\n\t\t\t\t\t\t\t\t\t\t'<input type=\"number\" min=\"1\" max=\"50\" step=\"1\" value=\"'+settings.boothPosition+'\" name=\"boothPosition\"/>'+\n\t\t\t\t\t\t\t\t\t'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-userJoin\">'+lang.menu.notifications.userJoin+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-userLeave\">'+lang.menu.notifications.userLeave+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-userWoot\">'+lang.menu.notifications.userWoot+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-userGrab\">'+lang.menu.notifications.userGrab+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-userMeh\">'+lang.menu.notifications.userMeh+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-guestJoin\">'+lang.menu.notifications.guestJoin+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-guestLeave\">'+lang.menu.notifications.guestLeave+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-friendRoomChange\">'+lang.menu.notifications.friendRoomChange+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-friendConnect\">'+lang.menu.notifications.friendConnect+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-friendDisconnect\">'+lang.menu.notifications.friendDisconnect+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-unfriended\">'+lang.menu.notifications.unfriended+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-gainNotification\">'+lang.menu.notifications.gainNotification+'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-gainNotificationMinXP\">'+\n\t\t\t\t\t\t\t\t\t\t'<label for=\"gainNotificationMinXP\">'+lang.menu.notifications.gainNotificationMinXPLabel+'</label>'+\n\t\t\t\t\t\t\t\t\t\t'<input type=\"number\" min=\"1\" max=\"1000\" step=\"1\" value=\"'+settings.minimumGain.xp+'\" name=\"gainNotificationMinXP\"/>'+\n\t\t\t\t\t\t\t\t\t'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-gainNotificationMinPP\">'+\n\t\t\t\t\t\t\t\t\t\t'<label for=\"gainNotificationMinPP\">'+lang.menu.notifications.gainNotificationMinPPLabel+'</label>'+\n\t\t\t\t\t\t\t\t\t\t'<input type=\"number\" min=\"1\" step=\"1\" value=\"'+settings.minimumGain.pp+'\" name=\"gainNotificationMinPP\"/>'+\n\t\t\t\t\t\t\t\t\t'</li>'+\n\t\t\t\t\t\t\t\t\t'<li id=\"pi-userLevelUp\">'+lang.menu.notifications.userLevelUp+'</li>'+\n\t\t\t\t\t\t\t\t'</ul>'+\n\t\t\t\t\t\t\t\t'<h2>'+lang.menu.about.title+'</h2>'+\n\t\t\t\t\t\t\t\t'<p style=\"display: none;\">'+\n\t\t\t\t\t\t\t\t\t'Plug-It '+pi._tool.getReadableVersion()+'.<br>'+\n\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.menu.about.developedBy, {\"plug-profile\": '<a target=\"_blank\" href=\"https://plug.dj/@/wibla\" target=\"blank\">WiBla</a><br>'})+\n\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.menu.about.followUs, {twitter: '<a target=\"_blank\" href=\"https://twitter.com/plugit_dj\" target=\"blank\">Twitter</a><br>'})+\n\t\t\t\t\t\t\t\t\tpi._tool.replaceString(lang.menu.about.joinDiscord, {discord: '<a target=\"_blank\" href=\"https://discord.gg/DptCswA\" target=\"blank\">Discord</a><br>'})+\n\t\t\t\t\t\t\t\t\t'<a target=\"_blank\" href=\"https://chrome.google.com/webstore/detail/plug-it-extension/bikeoipagmbnkipclndbmfkjdcljocej\">'+lang.menu.about.rateExtension+'</a><br>'+\n\t\t\t\t\t\t\t\t\t'<a target=\"_blank\" href=\"https://crowdin.com/project/plug-it\">'+lang.menu.about.translate+'</a><br>'+\n\t\t\t\t\t\t\t\t\t'<a target=\"_blank\" href=\"https://github.com/Plug-It/pi/issues\">'+lang.menu.about.reportBug+'</a><br>'+\n\t\t\t\t\t\t\t\t\t'<span id=\"pi-off\">'+lang.menu.about.shutdown+'</span>'+\n\t\t\t\t\t\t\t\t'</p>'+\n\t\t\t\t\t\t\t'</ul>'+\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t));\n\t\t\t\t\t// Menu css\n\t\t\t\t\t$('head').append($('<link id=\"pi-menu-CSS\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.menu_css+'\">'));\n\t\t\t\t\t// DelChat icon\n\t\t\t\t\t$('#chat-popout-button').before(\n\t\t\t\t\t\t'<div id=\"pi-delchat\" class=\"chat-header-button\">'+\n\t\t\t\t\t\t\t'<i class=\"icon icon-chat\"></i>'+\n\t\t\t\t\t\t\t'<i class=\"icon icon-delete\"></i>'+\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t);\n\t\t\t\t\t// AFK icon\n\t\t\t\t\t$('#chat-popout-button').before(\n\t\t\t\t\t\t'<div id=\"pi-afk\" class=\"chat-header-button\">'+\n\t\t\t\t\t\t\t'<i class=\"icon pi-afk off\"></i>'+\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t);\n\t\t\t\t\t// Toggle stream icon\n\t\t\t\t\t$('#chat-popout-button').before(\n\t\t\t\t\t\t'<div id=\"pi-toggleStream\" class=\"chat-header-button\">'+\n\t\t\t\t\t\t\t// Notice we init the icon on off state\n\t\t\t\t\t\t\t'<i class=\"icon pi-toggleStream off\"></i>'+\n\t\t\t\t\t\t'</div>'\n\t\t\t\t\t);\n\t\t\t\t\t// Init toggleStream with the correct class\n\t\t\t\t\tif (!modules.plugOptions.settings.streamDisabled)\n\t\t\t\t\t\t$('.pi-toggleStream').removeClass('off');\n\t\t\t\t\t// Moderation toolbar\n\t\t\t\t\twindow.modToolbar = {\n\t\t\t\t\t\tinit: function(forced) {\n\t\t\t\t\t\t\t// Forced is used when user has its role changes and hasPerm will return a false result\n\t\t\t\t\t\t\tif (API.hasPermission(null, API.ROLE.BOUNCER) || forced) {\n\t\t\t\t\t\t\t\tif ($('#pi-rmvDJ, #pi-skip').length > 0) this.kill();\n\t\t\t\t\t\t\t\t// Moderation tools\n\t\t\t\t\t\t\t\t$('#playback-container').append($(\n\t\t\t\t\t\t\t\t\t'<div id=\"pi-rmvDJ\">'+\n\t\t\t\t\t\t\t\t\t\t'<i class=\"icon icon-leave-waitlist\"></i>'+\n\t\t\t\t\t\t\t\t\t'</div>'+\n\t\t\t\t\t\t\t\t\t'<div id=\"pi-skip\">'+\n\t\t\t\t\t\t\t\t\t\t'<i class=\"icon icon-skip\"></i>'+\n\t\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t\t).css({top: settings.showVideo ? '281px' : '0px'}));\n\t\t\t\t\t\t\t\tif (typeof pi.dom !== 'undefined') {\n\t\t\t\t\t\t\t\t\tpi.dom.skip = $('#pi-rmvDJ')[0];\n\t\t\t\t\t\t\t\t\tpi.dom.rmvDJ = $('#pi-skip')[0];\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t$('#pi-rmvDJ').on('click', function() {pi.removeDJ();});\n\t\t\t\t\t\t\t\t$('#pi-skip').on('click', function() {pi.forceSkip();});\n\t\t\t\t\t\t\t\t$('#pi-rmvDJ, #pi-skip').on('mousewheel', pi._DOMEvent.volumeWheel);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tkill: function() {\n\t\t\t\t\t\t\t$('#pi-rmvDJ, #pi-skip').remove();\n\t\t\t\t\t\t\tdelete pi.dom.rmvDJ;\n\t\t\t\t\t\t\tdelete pi.dom.skip;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tmodToolbar.init();\n\t\t\t\t\t// Click Event Binding\n\t\t\t\t\t$('#pi-logo, #pi-menu').on('click', function(e) {\n\t\t\t\t\t\tif (e.target.id === 'pi-logo' || e.target.id === 'icon') {\n\t\t\t\t\t\t\t$('#pi-menu').toggle(250);\n\t\t\t\t\t\t} else if (e.target.tagName !== 'H2') {\n\t\t\t\t\t\t\tpi.menu(e.target.id.replace('pi-', ''));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-menu h2').on('click', function(e) {\n\t\t\t\t\t\tvar $openMenus = $('#pi-menu h2+*:not([style*=\"display: none\"])');\n\t\t\t\t\t\tif ($openMenus.length !== 0) {\n\t\t\t\t\t\t\t$openMenus.not(e.target.nextSibling).slideToggle({duration: 400,easing: 'linear'});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$(this).next().slideToggle({duration: 400,easing: 'linear'});\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-autoHideLogsAfter input').on('change', function() {\n\t\t\t\t\t\tsettings.AutoHideLogsAfter = parseInt(this.value);\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-betterClearChatLimit input').on('change', function() {\n\t\t\t\t\t\tsettings.betterClearChatLimit = parseInt(this.value);\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-chatLimit input').on('change', function() {\n\t\t\t\t\t\tsettings.chatLimit = parseInt(this.value);\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-afkMessage input').on('change', function() {\n\t\t\t\t\t\tsettings.afkMessage = this.value;\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-songLength input').on('change', function() {\n\t\t\t\t\t\tsettings.songLength = parseInt(this.value);\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-boothPosition input').on('change', function() {\n\t\t\t\t\t\tsettings.boothPosition = parseInt(this.value);\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-gainNotificationMinXP input').on('change', function() {\n\t\t\t\t\t\tsettings.minimumGain.xp = parseInt(this.value);\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-gainNotificationMinPP input').on('change', function() {\n\t\t\t\t\t\tsettings.minimumGain.pp = parseInt(this.value);\n\t\t\t\t\t});\n\t\t\t\t\t$(window).on('resize', pi._DOMEvent.resize);\n\t\t\t\t\t$('#pi-menu input').on('blur', function() {pi._tool.saveSettings});\n\t\t\t\t\t$('#pi-delchat').on('click', function(e) {\n\t\t\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\t\t\tAPI.sendChat('/clear');\n\t\t\t\t\t\t} else if (e.shiftKey) {\n\t\t\t\t\t\t\tdocument.getSelection().removeAllRanges();\n\t\t\t\t\t\t\t$('#chat .from.Plug-It').closest('.cm').remove();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpi.betterClearChat(settings.betterClearChatLimit);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-afk').on('click', function(e) {\n\t\t\t\t\t\tif (e.ctrlKey) {\n\t\t\t\t\t\t\tlet afkMsg = prompt(\"AFK message:\", settings.afkMessage);\n\t\t\t\t\t\t\tif (afkMsg === null || afkMsg.length === 0) return;\n\t\t\t\t\t\t\tsettings.afkMessage = $('#pi-afkMessage input')[0].value = afkMsg;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpi.menu('afkResponder');\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-toggleStream').on('click', function(e) {\n\t\t\t\t\t\tvar streamDisabled = modules.plugOptions.settings.streamDisabled;\n\n\t\t\t\t\t\tstreamDisabled = !streamDisabled;\n\t\t\t\t\t\tmodules.plugOptions.settings.streamDisabled = streamDisabled;\n\n\t\t\t\t\t\tmodules.context.trigger('change:streamDisabled');\n\t\t\t\t\t\tmodules.plugOptions.save();\n\t\t\t\t\t});\n\t\t\t\t\t// Tooltips\n\t\t\t\t\t$('#now-playing-media').on('mouseenter', function() {\n\t\t\t\t\t\tpi._tool.tooltip(true, 'left', $(this).offset().left,0, this.innerText);\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-rmvDJ').on('mouseenter', function() {\n\t\t\t\t\t\tlet x = $(this).offset().left + ($(this).width()/2);\n\t\t\t\t\t\tlet y = $(this).offset().top - ($(this).height());\n\t\t\t\t\t\tpi._tool.tooltip(true, 'left', x,y, lang.tooltips.rmvDJ);\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-skip').on('mouseenter', function() {\n\t\t\t\t\t\tlet x = $(this).offset().left + ($(this).width()/2);\n\t\t\t\t\t\tlet y = $(this).offset().top - ($(this).height());\n\t\t\t\t\t\tpi._tool.tooltip(true, 'left', x,y, lang.tooltips.skip);\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-delchat').on('mouseenter', function() {\n\t\t\t\t\t\tlet x = $(this).offset().left + ($(this).width()/2);\n\t\t\t\t\t\tlet y = $(this).offset().top - ($(this).height());\n\t\t\t\t\t\tpi._tool.tooltip(true, 'right', x,y, lang.tooltips.clearChat);\n\t\t\t\t\t\t// Since tootlip is point on the right but x & y are from top left,\n\t\t\t\t\t\t// instead of calculating the width of the tooltip (which depends on the translation),\n\t\t\t\t\t\t// just apply a translate effect, much easier.\n\t\t\t\t\t\t$('#tooltip').css({transform: 'translate(-100%, 0)'});\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-afk').on('mouseenter', function() {\n\t\t\t\t\t\tlet x = $(this).offset().left + ($(this).width()/2);\n\t\t\t\t\t\tlet y = $(this).offset().top - ($(this).height());\n\t\t\t\t\t\tpi._tool.tooltip(true, 'right', x,y, lang.tooltips.afk);\n\t\t\t\t\t\t// Since tootlip is point on the right but x & y are from top left,\n\t\t\t\t\t\t// instead of calculating the width of the tooltip (which depends on the translation),\n\t\t\t\t\t\t// just apply a translate effect, much easier.\n\t\t\t\t\t\t$('#tooltip').css({transform: 'translate(-100%, 0)'});\n\t\t\t\t\t});\n\t\t\t\t\t$('#pi-toggleStream').on('mouseenter', function() {\n\t\t\t\t\t\tlet x = $(this).offset().left + ($(this).width()/2);\n\t\t\t\t\t\tlet y = $(this).offset().top - ($(this).height());\n\t\t\t\t\t\tpi._tool.tooltip(true, 'right', x,y, lang.tooltips.toggleStream);\n\t\t\t\t\t\t// Since tootlip is point on the right but x & y are from top left,\n\t\t\t\t\t\t// instead of calculating the width of the tooltip (which depends on the translation),\n\t\t\t\t\t\t// just apply a translate effect, much easier.\n\t\t\t\t\t\t$('#tooltip').css({transform: 'translate(-100%, 0)'});\n\t\t\t\t\t});\n\t\t\t\t\t$('#now-playing-media, #pi-rmvDJ, #pi-skip, #pi-delchat, #pi-afk, #pi-toggleStream').on('mouseleave', function() {pi._tool.tooltip();});\n\t\t\t\t\t// Show votes\n\t\t\t\t\t$(\"#woot, #grab, #meh\").on('mouseenter', function() {\n\t\t\t\t\t\tif (settings.showVotes) {\n\t\t\t\t\t\t\tlet votes;\n\t\t\t\t\t\t\tswitch (this.id) {\n\t\t\t\t\t\t\t\tcase 'woot': votes = session.woots; break;\n\t\t\t\t\t\t\t\tcase 'grab': votes = session.grabs; break;\n\t\t\t\t\t\t\t\tcase 'meh':  votes = session.mehs;  break;\n\t\t\t\t\t\t\t\tdefault: votes = []; break;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpi._tool.showVotes(true, this.id, votes);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\t$(\"#woot, #grab, #meh\").on('mouseleave', function(e) {\n\t\t\t\t\t\t// do not remove element if moving from #votes to #pi-votes\n\t\t\t\t\t\tif (!$(e.toElement).closest('#pi-votes').length) pi._tool.showVotes(false);\n\t\t\t\t\t});\n\t\t\t\t\t// Fully loaded\n\t\t\t\t\tpi.dom = {\n\t\t\t\t\t\t// Menu\n\t\t\t\t\t\t// General\n\t\t\t\t\t\twoot: $('#pi-woot')[0],\n\t\t\t\t\t\tjoin: $('#pi-join')[0],\n\t\t\t\t\t\tkeyShortcut: $('#pi-keyShortcut')[0],\n\t\t\t\t\t\tchatCommands: $('#pi-chatCommands')[0],\n\t\t\t\t\t\tautoHideLogs: $('#pi-autoHideLogs')[0],\n\t\t\t\t\t\tautoHideLogsAfter: $('#pi-autoHideLogsAfter')[0],\n\t\t\t\t\t\tbetterMeh: $('#pi-mutemeh')[0],\n\t\t\t\t\t\tafkResponder: $('#pi-afkResponder')[0],\n\t\t\t\t\t\tafkMessage: $('#pi-afkMessage')[0],\n\t\t\t\t\t\tnavWarn: $('#pi-navWarn')[0],\n\t\t\t\t\t\tshowVotes: $('#pi-showVotes')[0],\n\t\t\t\t\t\tbetterClearChatLimit: $('#pi-betterClearChatLimit')[0],\n\t\t\t\t\t\tchatLimit: $('#pi-chatLimit')[0],\n\t\t\t\t\t\tskipNextMediaInHistory: $('#pi-skipNextMediaInHistory')[0],\n\t\t\t\t\t\t// Customisation\n\t\t\t\t\t\tvideo: $('#pi-video')[0],\n\t\t\t\t\t\tsoundcloudVisu: $('#pi-soundcloudVisu')[0],\n\t\t\t\t\t\tcss: $('#pi-css')[0],\n\t\t\t\t\t\tcustomRanks: $('#pi-customRanks')[0],\n\t\t\t\t\t\tlanguageFlags: $('#pi-languageFlags')[0],\n\t\t\t\t\t\tfriendsIcons: $('#pi-friendsIcons')[0],\n\t\t\t\t\t\tbg: $('#pi-bg')[0],\n\t\t\t\t\t\toldChat: $('#pi-old-chat')[0],\n\t\t\t\t\t\toldFooter: $('#pi-old-footer')[0],\n\t\t\t\t\t\tsmallHistory: $('#pi-small-history')[0],\n\t\t\t\t\t\tsmallFriends: $('#pi-small-friends')[0],\n\t\t\t\t\t\tsmallPlaylists: $('#pi-small-playlists')[0],\n\t\t\t\t\t\t// Moderation\n\t\t\t\t\t\tshowDeletedMsg: $('#pi-showDeletedMsg')[0],\n\t\t\t\t\t\tconfirmDelete: $('#pi-confirmDelete')[0],\n\t\t\t\t\t\tuserInfo: $('#pi-userInfo')[0],\n\t\t\t\t\t\tstuckSkip: $('#pi-stuckSkip')[0],\n\t\t\t\t\t\tlengthA: $('#pi-lengthA')[0],\n\t\t\t\t\t\tsongLength: $('#pi-songLength')[0],\n\t\t\t\t\t\thistoryAlert: $('#pi-historyA')[0],\n\t\t\t\t\t\t// Notifications\n\t\t\t\t\t\tsystemNotifications: $('#pi-systemNotifications')[0],\n\t\t\t\t\t\tsongStats: $('#pi-songStats')[0],\n\t\t\t\t\t\tboothAlert: $('#pi-boothAlert')[0],\n\t\t\t\t\t\tboothPosition: $('#pi-boothPosition')[0],\n\t\t\t\t\t\tuserJoin: $('#pi-userJoin')[0],\n\t\t\t\t\t\tuserLeave: $('#pi-userLeave')[0],\n\t\t\t\t\t\tuserWoot: $('#pi-userWoot')[0],\n\t\t\t\t\t\tuserGrab: $('#pi-userGrab')[0],\n\t\t\t\t\t\tmehA: $('#pi-userMeh')[0],\n\t\t\t\t\t\tguestJoin: $('#pi-guestJoin')[0],\n\t\t\t\t\t\tguestLeave: $('#pi-guestLeave')[0],\n\t\t\t\t\t\tfriendRoomChange: $('#pi-friendRoomChange')[0],\n\t\t\t\t\t\tfriendConnect: $('#pi-friendConnect')[0],\n\t\t\t\t\t\tfriendDisconnect: $('#pi-friendDisconnect')[0],\n\t\t\t\t\t\tunfriended: $('#pi-unfriended')[0],\n\t\t\t\t\t\tgainNotification: $('#pi-gainNotification')[0],\n\t\t\t\t\t\tgainNotificationMinXP: $('#pi-gainNotificationMinXP')[0],\n\t\t\t\t\t\tgainNotificationMinPP: $('#pi-gainNotificationMinPP')[0],\n\t\t\t\t\t\tuserLevelUp: $('#pi-userLevelUp')[0],\n\t\t\t\t\t\t// About\n\t\t\t\t\t\toff: $('#pi-off')[0],\n\t\t\t\t\t\t// Mod Bar\n\t\t\t\t\t\trmvDJ: $('#pi-rmvDJ')[0],\n\t\t\t\t\t\tskip: $('#pi-skip')[0],\n\t\t\t\t\t\t// Other\n\t\t\t\t\t\tDelChat: $('#pi-delchat')[0],\n\t\t\t\t\t\t// Plug\n\t\t\t\t\t\tstream: $('#playback-container')[0],\n\t\t\t\t\t\tplayback: $('#playback')[0]\n\t\t\t\t\t};\n\n\t\t\t\t\tdelete pi._load; // Init only once\n\t\t\t\t\tpi._tool.log(pi._tool.replaceString(lang.log.loaded, {version: pi._tool.getReadableVersion()}) + ' ' + (new Date().getTime() - startTime) + 'ms');\n\t\t\t\t\t// If userSettings is undefined: first time we run the script\n\t\t\t\t\tif (!userSettings) {\n\t\t\t\t\t\tpi._tool.log(lang.log.help, 'info chat');\n\t\t\t\t\t\tpi._tool.log(lang.log.preRelease, 'warn chat');\n\t\t\t\t\t}\n\t\t\t\t\t// Initialise the menu & setup script\n\t\t\t\t\tpi.menu('init');\n\t\t\t\t\tpi.muteMeh();\n\t\t\t\t\t// Delete load status\n\t\t\t\t\t$('#pi-status').css({opacity:'0'});\n\t\t\t\t\tsetTimeout(function() {$('#pi-status').remove();}, 250);\n\t\t\t\t\tpi._tool.getRoomSettings();\n\t\t\t\t},\n\t\t\t\t_reload: function(reason) {\n\t\t\t\t\tif (typeof reason === 'string' && reason === 'roomChange') {\n\t\t\t\t\t\tpi._tool.log(lang.info.roomChange, 'info');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpi._tool.log(lang.log.reloading);\n\t\t\t\t\t}\n\n\t\t\t\t\tpi._close();\n\t\t\t\t\t$.getScript(scriptURL);\n\t\t\t\t},\n\t\t\t\t_close: function() {\n\t\t\t\t\t// Unbind API events\n\t\t\t\t\tfor (var event in pi._event) {\n\t\t\t\t\t\tAPI.off(event, pi._event[event]);\n\t\t\t\t\t}\n\t\t\t\t\tpi._tool.plugSocketHook.kill();\n\t\t\t\t\tmodules.context.off('chat:receive', pi._modulesEvent.chatReceive);\n\t\t\t\t\tmodules.context._events['chat:delete'][0].callback = modules.originalChatDelete;\n\t\t\t\t\tmodules.context.off('change:streamDisabled', pi._modulesEvent.streamDisabled);\n\t\t\t\t\t// modules.context._events['chat:delete'].push(modules.events.chatDelete);\n\t\t\t\t\tmodules = null;\n\n\t\t\t\t\t// Allow to reload\n\t\t\t\t\twindow.scriptURL = url.script;\n\t\t\t\t\twindow.onbeforeunload = null;\n\n\t\t\t\t\tclearInterval(friendsOnline);\n\t\t\t\t\tclearInterval(checkIfRoomChanged);\n\n\t\t\t\t\tfriendsOnline = null;\n\t\t\t\t\troomURL = null;\n\t\t\t\t\tcheckIfRoomChanged = null;\n\n\t\t\t\t\t// Unbind events BEFORE removing elements\n\t\t\t\t\t$(window).off('keydown', pi._DOMEvent.keydown);\n\t\t\t\t\t$(window).off('dblclick', pi._DOMEvent.translate);\n\t\t\t\t\t$(window).off('resize', pi._DOMEvent.resize);\n\t\t\t\t\t$('#volume, #playback-controls').off('mousewheel', pi._DOMEvent.mousewheel);\n\t\t\t\t\t$('.button.staff').off('click', pi._DOMEvent.collideRanks);\n\t\t\t\t\t$('#chat-popout-button').off('click', pi._DOMEvent.popout);\n\t\t\t\t\t$(\"#chat-input-field\").off('input', pi._DOMEvent.chatAutocompletion);\n\t\t\t\t\t$(document).off('ajaxSuccess', pi._DOMEvent.updateRoomSettings);\n\t\t\t\t\t$('.group').css('cursor', '');\n\n\t\t\t\t\t$(\".room-background\").show();\n\t\t\t\t\t$('[id*=\"pi-\"], .icon[class*=\"pi-\"]').each(function() {\n\t\t\t\t\t\tthis.remove();\n\t\t\t\t\t});\n\n\t\t\t\t\t$('#now-playing-media, #woot, #grab, #meh').off('mouseenter');\n\t\t\t\t\t$('#now-playing-media, #woot, #grab, #meh').off('mouseleave');\n\t\t\t\t\t// Preventing making the video definitly disapear\n\t\t\t\t\tif (!settings.showVideo) {\n\t\t\t\t\t\tif (pi._tool.getPlugSettings().videoOnly) {\n\t\t\t\t\t\t\tpi.dom.playback.style.height = window.innerHeight - 185+'px';\n\t\t\t\t\t\t\t$(pi.dom.stream).css({visibility:'visible', height:'100%'});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpi.dom.playback.style.height = '271px';\n\t\t\t\t\t\t\t$(pi.dom.stream).css({visibility:'visible', height:'281px'});\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('#playback-controls, #no-dj').css('visibility', 'visible');\n\t\t\t\t\t}\n\n\t\t\t\t\tpi._extendAPI.kill();\n\n\t\t\t\t\tpi = null;\n\t\t\t\t},\n\t\t\t\t_extendAPI: {\n\t\t\t\t\tinit: function() {\n\t\t\t\t\t\tAPI.GLOBAL_ROLE = {\n\t\t\t\t\t\t\tADMIN: 5000,\n\t\t\t\t\t\t\tAMBASSADOR: 3000,\n\t\t\t\t\t\t\tMODERATOR: 2500,\n\t\t\t\t\t\t\tPLOT: 750,\n\t\t\t\t\t\t\tPROMOTER: 500\n\t\t\t\t\t\t};\n\t\t\t\t\t\tAPI.GUEST_JOIN = 'guestJoin';\n\t\t\t\t\t\tAPI.GUEST_LEAVE = 'guestLeave';\n\t\t\t\t\t\tAPI.EARN = 'earn';\n\n\t\t\t\t\t\tAPI.moderateForceQuit = function() {\n\t\t\t\t\t\t\tif (API.hasPermission(null, API.ROLE.BOUNCER) && API.enabled) {\n\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\turl: '/_/booth/remove/'+API.getDJ().id,\n\t\t\t\t\t\t\t\t\tmethod: 'DELETE'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tAPI.getUserByName = function(name) {\n\t\t\t\t\t\t\tif (!API.enabled) return;\n\t\t\t\t\t\t\tif (typeof name == 'undefined') {\n\t\t\t\t\t\t\t\tthrow new Error('A name must be provided.');\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvar user = API.getUsers().filter(u => u.username === name);\n\t\t\t\t\t\t\t\treturn (user.length > 0 ? user[0] : null);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tAPI.getUserByID = function(id, callback) {\n\t\t\t\t\t\t\tif (!API.enabled || isNaN(id) || typeof callback !== 'function') return;\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\turl: '/_/users/'+id,\n\t\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t\tcallback(data.data[0]);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\terror: function(e) {\n\t\t\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\t\t\t\t\t\tAPI.addFriendByID = function(id) {\n\t\t\t\t\t\t\tif (isNaN(id) || !API.enabled) return;\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\t\t\turl: '/_/friends',\n\t\t\t\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\t\t\t\t'id': id\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tsuccess: function() {\n\t\t\t\t\t\t\t\t\tAPI.getUserByID(id, (user) => {\n\t\t\t\t\t\t\t\t\t\tmodules.context.trigger('notify', 'icon-add-friend', modules.lang.messages.friendRequest.split('%NAME%').join(user.username));\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\terror: function(e) {\n\t\t\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\t\tcontentType: 'application/json'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\t\t\t\t\t\tAPI.moderateKickUser = function(id, time) {\n\t\t\t\t\t\t\tif (arguments.length < 2 || !API.enabled) return;\n\n\t\t\t\t\t\t\tvar duration;\n\t\t\t\t\t\t\tif (time>=24*60*60) duration = 'f';\n\t\t\t\t\t\t\telse if (time>=60*60) duration = 'd';\n\t\t\t\t\t\t\telse duration = 'h';\n\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\ttype: 'POST',\n\t\t\t\t\t\t\t\turl: '/_/bans/add',\n\t\t\t\t\t\t\t\tdata: JSON.stringify({\n\t\t\t\t\t\t\t\t\t'userID': id,\n\t\t\t\t\t\t\t\t\t'reason': 1,\n\t\t\t\t\t\t\t\t\t'duration': duration\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\t\tcontentType: 'application/json',\n\t\t\t\t\t\t\t\terror: function(err) {\n\t\t\t\t\t\t\t\t\tif (typeof err.responseJSON.data[0] !== 'undefined') {\n\t\t\t\t\t\t\t\t\t\tpi._tool.log(['Could not ban user: ', err.responseJSON.data[0]], 'error');\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tpi._tool.log(['Could not ban user: ', err], 'error');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tsuccess: function() {\n\t\t\t\t\t\t\t\t\tpi._tool.log('User was succesfully banned for '+time+' seconds.', 'chat');\n\n\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\t\ttype: 'DELETE',\n\t\t\t\t\t\t\t\t\t\t\turl: '/_/bans/'+id,\n\t\t\t\t\t\t\t\t\t\t\terror: function(err) {\n\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(['Could not unban user: ', err], 'error');\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tsuccess: function() {\n\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log('User was unbanned.', 'success chat');\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}, time*1000);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t};\n\t\t\t\t\t\tAPI.gift = function(id, amount, customName) {\n\t\t\t\t\t\t\tif (isNaN(id) || isNaN(amount) || !API.enabled || API.getUser().sub < 1) return;\n\n\t\t\t\t\t\t\tvar user = API.getUser(id);\n\t\t\t\t\t\t\tif (!user.username) {\n\t\t\t\t\t\t\t\tAPI.getUserByID(id, (user) => {\n\t\t\t\t\t\t\t\t\tcustomName = typeof customName === 'string' ? customName : user.username;\n\t\t\t\t\t\t\t\t\tamount = typeof amount == 'undefined' ? 25 : amount;\n\t\t\t\t\t\t\t\t\tpi._tool.showGiftDialog(id, customName, amount);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tcustomName = typeof customName === 'string' ? customName : user.username;\n\t\t\t\t\t\t\t\tamount = typeof amount == 'undefined' ? 25 : amount;\n\t\t\t\t\t\t\t\tpi._tool.showGiftDialog(id, customName, amount);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tAPI.getActivePlaylist = function() {\n\t\t\t\t\t\t\tif (!API.enabled) return;\n\t\t\t\t\t\t\tlet currentPL, name, id, count, allPL;\n\t\t\t\t\t\t\tcurrentPL = $('#playlist-menu .row.selected');\n\t\t\t\t\t\t\tname = currentPL.children()[1].innerText;\n\t\t\t\t\t\t\tcount = currentPL.children()[2].innerText;\n\t\t\t\t\t\t\tallPL = JSON.parse(_.find(require.s.contexts._.defined,function(m){return m&&m._read})._read())[1]['p'];\n\n\t\t\t\t\t\t\tfor (var PL in allPL) {\n\t\t\t\t\t\t\t\tif (allPL[PL].name === name) {\n\t\t\t\t\t\t\t\t\tid = allPL[PL].id;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tname: name,\n\t\t\t\t\t\t\t\tid: id,\n\t\t\t\t\t\t\t\titemCount: count\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tAPI.getRoomName = function() {\n\t\t\t\t\t\t\tif (!API.enabled) return;\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\treturn modules.room.get('name');\n\t\t\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\t\t\treturn $('#room-name span').text();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t\tAPI.moderateDeleteChat = function(cid) {\n\t\t\t\t\t\t\tif (API.enabled && cid) {\n\t\t\t\t\t\t\t\t$.ajax({url: '/_/chat/'+cid, method: 'DELETE'});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t\tkill: function() {\n\t\t\t\t\t\tdelete API.GLOBAL_ROLE;\n\t\t\t\t\t\tdelete API.GUEST_JOIN;\n\t\t\t\t\t\tdelete API.GUEST_LEAVE;\n\t\t\t\t\t\tdelete API.EARN;\n\n\t\t\t\t\t\tdelete API.moderateForceQuit;\n\t\t\t\t\t\tdelete API.getUserByName;\n\t\t\t\t\t\tdelete API.getUserByID;\n\t\t\t\t\t\tdelete API.addFriendByID;\n\t\t\t\t\t\tdelete API.moderateKickUser;\n\t\t\t\t\t\tdelete API.gift;\n\t\t\t\t\t\tdelete API.getActivePlaylist;\n\t\t\t\t\t\tdelete API.getRoomName();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t_tool: {\n\t\t\t\t\tapplyRoomSettings: function() {\n\t\t\t\t\t\tfor (var script in roomSettings) {\n\t\t\t\t\t\t\tfor (var rule in roomSettings[script]) {\n\t\t\t\t\t\t\t\t// Do not load room settings if \"room\" key != room URL\n\t\t\t\t\t\t\t\tif (rule === 'room' && roomSettings[script][rule] !== location.pathname.slice(1)) {\n\t\t\t\t\t\t\t\t\treturn pi._tool.log('Could not load room settings: room value must match room URL.', 'error');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (typeof roomSettings[script][rule].import !== 'undefined') {\n\t\t\t\t\t\t\t\t\troomSettings[rule] = roomSettings[script][rule].import[0];\n\t\t\t\t\t\t\t\t\troomSettings.rule = roomSettings[script][rule].rule;\n\t\t\t\t\t\t\t\t} else if (rule === 'rules') {\n\t\t\t\t\t\t\t\t\tfor (var rule2 in roomSettings[script][rule]) {\n\t\t\t\t\t\t\t\t\t\tif (roomSettings[rule] === undefined) roomSettings[rule] = {}\n\n\t\t\t\t\t\t\t\t\t\tif (typeof roomSettings[script][rule][rule2] === 'string') {\n\t\t\t\t\t\t\t\t\t\t\troomSettings[rule][rule2] = (roomSettings[script][rule][rule2] === 'true');\n\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\troomSettings[rule][rule2] = roomSettings[script][rule][rule2];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\troomSettings[rule] = roomSettings[script][rule];\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tdelete roomSettings[script];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof roomSettings.css !== 'undefined') {\n\t\t\t\t\t\t\tlet $roomStyle = $('#pi-room-style');\n\n\t\t\t\t\t\t\t// In case of update, remove previous menu item\n\t\t\t\t\t\t\tif ($roomStyle.length) $roomStyle.remove();\n\n\t\t\t\t\t\t\t$roomStyle = $('<li id=\"pi-room-style\">'+roomSettings.room+' style</li>');\n\t\t\t\t\t\t\tpi.dom.roomStyle = $roomStyle[0];\n\t\t\t\t\t\t\tpi.dom.roomStyle.className = settings.roomStyle ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\t$('#pi-css').before($roomStyle);\n\n\t\t\t\t\t\t\tif (settings.roomStyle) {\n\t\t\t\t\t\t\t\tpi.toggleStyle('roomStyle');\n\t\t\t\t\t\t\t\tpi._tool.log('This room is using a custom style made by '+ roomSettings.author +', you can disable it via the menu.');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tcheckForUpdates: function(isForced) {\n\t\t\t\t\t\tgetLastCommit('https://api.github.com/repos/Plug-It/pi/commits/pre-release', function(data) {\n\t\t\t\t\t\t\tif (thisCommit.sha !== data.sha) {\n\t\t\t\t\t\t\t\tif (isForced) {\n\t\t\t\t\t\t\t\t\tpi._tool.log(lang.log.forcingReload);\n\t\t\t\t\t\t\t\t\tpi._reload();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\tlang.log.updateAvailable,\n\t\t\t\t\t\t\t\t\t\t\t{whatsnew: data.commit.message}\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t'info chat',\n\t\t\t\t\t\t\t\t\t\tfunction(){pi._reload();}\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tgetFriends: function(callback) {\n\t\t\t\t\t\t/* Sadly, this is the only way to get friends\n\t\t\t\t\t\t * It's ugly, I know. In order to update, you\n\t\t\t\t\t\t * have to make a call every x sec/min.\n\t\t\t\t\t\t * You can thank plug.\n\t\t\t\t\t\t */\n\n\t\t\t\t\t\tif (!session.floodAPI) {\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\turl: '/_/friends',\n\t\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t\tcallback(data.data);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t},\n\t\t\t\t\tgetPlaylist: function(id, callback) {\n\t\t\t\t\t\tif (isNaN(id) || typeof callback !== 'function' || session.floodAPI) return;\n\t\t\t\t\t\tlet cache = _.find(require.s.contexts._.defined,function(m){return m&&m._read})._read();\n\t\t\t\t\t\tcache = JSON.parse(cache);\n\t\t\t\t\t\tlet thisPL = cache[1]['p'][id]['items'];\n\n\t\t\t\t\t\tif (Object.keys(thisPL).length !== 0) {\n\t\t\t\t\t\t\tlet data = [];\n\t\t\t\t\t\t\tfor (var cid in thisPL) {\n\t\t\t\t\t\t\t\tdata.push(cache[1]['m'][cid]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcallback(data, true); // true = cached\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\turl: '/_/playlists/'+id+'/media',\n\t\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t\tcallback(data.data, false); // false = non cached\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tgetPlaylists: function(callback) {\n\t\t\t\t\t\tif (typeof callback !== 'function' || session.floodAPI) return;\n\n\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\turl: '/_/playlists',\n\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t// return array sorted by playlist name\n\t\t\t\t\t\t\t\tcallback(data.data.sort((a,b) => a.name.localeCompare(b.name)));\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tgetPlugSettings: function(id) {\n\t\t\t\t\t\tif (typeof id == 'undefined') id = API.getUser().id;\n\t\t\t\t\t\tvar json = JSON.parse(localStorage.getItem('settings'));\n\t\t\t\t\t\tfor (var i = 1; i < 20; i++) {\n\t\t\t\t\t\t\tif (typeof json[i][id] !== 'undefined') return json[i][id];\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tgetRank: function(id) {\n\t\t\t\t\t\tlet result = [], user;\n\n\t\t\t\t\t\tif (!id) {\n\t\t\t\t\t\t\tuser = API.getUser();\n\t\t\t\t\t\t\tid = user.id;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse user = API.getUser(id);\n\n\t\t\t\t\t\tfor (var rank in ranks) {\n\t\t\t\t\t\t\tfor (var users in ranks[rank]) {\n\t\t\t\t\t\t\t\tif (id == ranks[rank][users]) result.push(rank);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Self assignable roles\n\t\t\t\t\t\tif (settings.bot.indexOf(id) !== -1) result.push('Bot');\n\t\t\t\t\t\tif (settings.discordbot.indexOf(id) !== -1) result.push('Discord Bot');\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t},\n\t\t\t\t\tgetReadableVersion: function() {\n\t\t\t\t\t\tlet subVersion = '';\n\n\t\t\t\t\t\tif (pi.version.pre) {\n\t\t\t\t\t\t\tsubVersion = ' Pre ' + pi.version.pre;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn pi.version.major+'.'+pi.version.minor+'.'+pi.version.patch+subVersion;\n\t\t\t\t\t},\n\t\t\t\t\tgetRoomRules: function(which) {\n\t\t\t\t\t\tif (typeof roomSettings.rules === 'undefined') return true;\n\t\t\t\t\t\tif (typeof roomSettings.rules[which] === 'undefined') return true;\n\t\t\t\t\t\telse return roomSettings.rules[which];\n\t\t\t\t\t},\n\t\t\t\t\tgetRoomSettings: function() {\n\t\t\t\t\t\tif (session.floodAPI) return;\n\t\t\t\t\t\t$.getJSON('/_/rooms/state', function(data) {\n\t\t\t\t\t\t\tdata = data.data[0];\n\t\t\t\t\t\t\tlet url = data.meta.description;\n\t\t\t\t\t\t\tlet re = new RegExp('@(pi|p3|rcs)=(https?:\\/\\/[^\\\\@,;]*json)', 'ig');\n\n\t\t\t\t\t\t\tif (re.test(url)) {\n\t\t\t\t\t\t\t\tlet match = url.match(re);\n\n\t\t\t\t\t\t\t\tfor (var i = 0; i < match.length; i++) {\n\t\t\t\t\t\t\t\t\tlet scriptName = match[i].slice(1, match[i].indexOf(\"=\"));\n\n\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\turl: match[i].replace(/@(pi|p3|rcs)=/ig, ''),\n\t\t\t\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t\t\t\tif (typeof data !== 'object') data = JSON.parse(data);\n\t\t\t\t\t\t\t\t\t\t\troomSettings[scriptName] = data;\n\t\t\t\t\t\t\t\t\t\t\troomSettingsLoaded();\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\terror: function(e) {\n\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\t\t\t\t\t\tlang.error.cannotLoadScriptRoomSettings,\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tscript: scriptName,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\terror: e\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\t'error console'\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tfunction roomSettingsLoaded() {\n\t\t\t\t\t\t\t\t\tif (Object.keys(roomSettings).length !== match.length) return;\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\tpi._tool.applyRoomSettings();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t\tisRank: function(rank, id) {\n\t\t\t\t\t\tif (!rank) return null;\n\t\t\t\t\t\tvar result = pi._tool.getRank(id);\n\n\t\t\t\t\t\tfor (var ranks in result) {\n\t\t\t\t\t\t\tresult[ranks] = result[ranks].toLowerCase();\n\t\t\t\t\t\t\trank = rank.toLowerCase();\n\t\t\t\t\t\t\tif (result[ranks] == rank) return true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t\tloadEmote: function(which) {\n\t\t\t\t\t\tif (typeof which !== 'string') return;\n\n\t\t\t\t\t\t// Only 4 options, switch is not faster\n\t\t\t\t\t\tif (which === 'tasty') {\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\turl: url.emotes.tasty,\n\t\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t\temotes.tastycat = data.emotes;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (which === 'twitch') {\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\turl: url.emotes.twitch,\n\t\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t\temotes.twitch = {};\n\t\t\t\t\t\t\t\t\tfor (var emote in data.emotes) {\n\t\t\t\t\t\t\t\t\t\temotes.twitch[emote] = data.template.small.replace('{image_id}', data.emotes[emote].image_id);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (which === 'twitchSub') {\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\turl: url.emotes.twitchSub,\n\t\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t\temotes.twitchSub = {};\n\t\t\t\t\t\t\t\t\tfor (var emote in data.unknown_emotes.emotes) {\n\t\t\t\t\t\t\t\t\t\temotes.twitchSub[data.unknown_emotes.emotes[emote].code] =\n\t\t\t\t\t\t\t\t\t\t\tdata.template.small.replace('{image_id}', data.unknown_emotes.emotes[emote].image_id);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tfor (var channel in data.channels) {\n\t\t\t\t\t\t\t\t\t\tfor (emote in data.channels[channel].emotes) {\n\t\t\t\t\t\t\t\t\t\t\temotes.twitchSub[data.channels[channel].emotes[emote].code] =\n\t\t\t\t\t\t\t\t\t\t\t\tdata.template.small.replace('{image_id}', data.channels[channel].emotes[emote].image_id);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else if (which === 'betterTTV') {\n\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\turl: url.emotes.betterDiscord,\n\t\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t\temotes.betterTTV = JSON.parse(data);\n\t\t\t\t\t\t\t\t\tfor (var emote in emotes) {\n\t\t\t\t\t\t\t\t\t\temotes.betterTTV[emote] = 'https://cdn.betterttv.net/emote/' + emotes.betterTTV[emote] + '/1x';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\t\turl: url.emotes.betterTTV,\n\t\t\t\t\t\t\t\t\t\tsuccess: function(data) {\n\t\t\t\t\t\t\t\t\t\t\tfor (var emote in data.emotes) {\n\t\t\t\t\t\t\t\t\t\t\t\temotes.betterTTV[data.emotes[emote].regex] = \"https:\" + data.emotes[emote].url;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tlog: function(txt, placeType, callback, ...cbArgs) {\n\t\t\t\t\t\tlet type, emoticon, time;\n\t\t\t\t\t\tif (typeof placeType === 'undefined') placeType = 'log';\n\t\t\t\t\t\tif (placeType.indexOf('log') > -1) {\n\t\t\t\t\t\t\ttype = 'log';\n\t\t\t\t\t\t\temoticon = 'log';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (placeType.indexOf('info') > -1) {\n\t\t\t\t\t\t\ttype = 'info';\n\t\t\t\t\t\t\temoticon = ':information_source:';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (placeType.indexOf('warn') > -1) {\n\t\t\t\t\t\t\ttype = 'warn';\n\t\t\t\t\t\t\temoticon = ':warning:';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (placeType.indexOf('error') > -1) {\n\t\t\t\t\t\t\ttype = 'error';\n\t\t\t\t\t\t\temoticon = ':exclamation:';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (placeType.indexOf('debug') > -1) {\n\t\t\t\t\t\t\ttype = 'debug';\n\t\t\t\t\t\t\temoticon = ':octocat:';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (placeType.indexOf('success') > -1) {\n\t\t\t\t\t\t\ttype = 'success';\n\t\t\t\t\t\t\temoticon = ':white_check_mark:';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\ttype = 'log';\n\t\t\t\t\t\t\temoticon = 'log';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (placeType.indexOf('console') === -1) {\n\t\t\t\t\t\t\tconst timestamp = pi._tool.getPlugSettings().chatTimestamps;\n\t\t\t\t\t\t\tif (timestamp) {\n\t\t\t\t\t\t\t\ttime = new Date();\n\t\t\t\t\t\t\t\tlet h = time.getHours();\n\t\t\t\t\t\t\t\tlet m = time.getMinutes();\n\t\t\t\t\t\t\t\tm = m<10 ? '0'+m : m;\n\n\t\t\t\t\t\t\t\tif (timestamp == 12) {\n\t\t\t\t\t\t\t\t\tlet am;\n\n\t\t\t\t\t\t\t\t\tif (h >= 12) {\n\t\t\t\t\t\t\t\t\t\tam = 'pm';\n\t\t\t\t\t\t\t\t\t\th -= 12;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse am = 'am';\n\n\t\t\t\t\t\t\t\t\ttime = h+':'+m+am;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\th = h<10 ? '0'+h : h; // Add a 0 to hours only if timestamp is 24\n\t\t\t\t\t\t\t\t\ttime = h+':'+m;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar $logBox = $(\n\t\t\t\t\t\t\t\t'<div class=\"cm pi-'+type+' message deletable\">'+\n\t\t\t\t\t\t\t\t\t'<div class=\"delete-button\" style=\"display: none;\">'+lang.glossary.delete+'</div>'+\n\t\t\t\t\t\t\t\t\t\t'<div class=\"badge-box\">'+\n\t\t\t\t\t\t\t\t\t\t\t'<i class=\"bdg bdg-piLogo\"></i>'+\n\t\t\t\t\t\t\t\t\t\t'</div>'+\n\t\t\t\t\t\t\t\t\t\t'<div class=\"msg\">'+\n\t\t\t\t\t\t\t\t\t\t\t'<div class=\"from Plug-It\">'+\n\t\t\t\t\t\t\t\t\t\t\t(emoticon === 'log' ? '<i class=\"icon icon-pi\"></i>' : emoji.replace_colons(emoticon))+\n\t\t\t\t\t\t\t\t\t\t\t'<span class=\"un\">[Plug-It]</span>'+\n\t\t\t\t\t\t\t\t\t\t\t'<span class=\"timestamp\" style=\"display: '+ (timestamp ? 'inline-block' : 'none') +';\">'+time+'</span>'+\n\t\t\t\t\t\t\t\t\t\t'</div>'+\n\t\t\t\t\t\t\t\t\t\t'<div class=\"text cid-undefined\">'+(Array.isArray(txt) ? txt.join('<br />') : txt.replace(/\\\\n|\\n/g, '<br />'))+'</div>'+\n\t\t\t\t\t\t\t\t\t'</div>'+\n\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t// Delete button\n\t\t\t\t\t\t\t$logBox.on('mouseenter', function() {\n\t\t\t\t\t\t\t\t$logBox.find('.delete-button')[0].style.display = 'block';\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$logBox.on('mouseleave', function() {\n\t\t\t\t\t\t\t\t$logBox.find('.delete-button')[0].style.display = 'none';\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$logBox.find('.delete-button').on('click', function() {\n\t\t\t\t\t\t\t\t$logBox.remove();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t// Make the chat scroll to custom log\n\t\t\t\t\t\t\tvar $chat = $('#chat-messages');\n\t\t\t\t\t\t\t// Only if chat is overflowing & already scrolled to bottom\n\t\t\t\t\t\t\tif ($chat.height() + $chat.scrollTop() == $chat[0].scrollHeight && $chat[0].scrollHeight > $chat.height()) {\n\t\t\t\t\t\t\t\tvar scrollIntoView = setInterval(function() {\n\t\t\t\t\t\t\t\t\tif ($($logBox).length > 0) {\n\t\t\t\t\t\t\t\t\t\t$chat.scrollTop($chat[0].scrollHeight);\n\t\t\t\t\t\t\t\t\t\tclearInterval(scrollIntoView);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}, 5);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$('#chat-messages').append($logBox);\n\t\t\t\t\t\t\tif (typeof window.popout !== 'undefined') $('#chat-messages', popout.document).append($logBox);\n\n\t\t\t\t\t\t\tfunction autoHideLogs() {\n\t\t\t\t\t\t\t\tif (!document.hasFocus()) {\n\t\t\t\t\t\t\t\t\t// This acts like a $(window).one('focus');\n\t\t\t\t\t\t\t\t\twindow.onfocus = function() {\n\t\t\t\t\t\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\t\t\t\t\t\t$($logBox).fadeOut(1000, 'linear', () => $($logBox).remove());\n\t\t\t\t\t\t\t\t\t\t}, settings.autoHideLogsAfter*1000);\n\t\t\t\t\t\t\t\t\t\twindow.onfocus = undefined;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t$($logBox).fadeOut(1000, 'linear', () => $($logBox).remove());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (settings.autoHideLogs) {\n\t\t\t\t\t\t\t\tsetTimeout(autoHideLogs, settings.autoHideLogsAfter*1000);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Prevents message from merging, awaiting a better solution..\n\t\t\t\t\t\t\tAPI.chatLog('Don\\'t pay attention to this message please.');\n\t\t\t\t\t\t\tif (typeof popout === 'undefined') {\n\t\t\t\t\t\t\t\tif ($('.cm.log:last').length) $('.cm.log:last')[0].remove();\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tif ($('.cm.log:last', popout.document).length) $('.cm.log:last', popout.document)[0].remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (placeType.indexOf('chat') === -1) {\n\t\t\t\t\t\t\tif (type === 'success') type = 'log'; // Success is not a console's method\n\t\t\t\t\t\t\tconsole[type]('%c[%cPlug-It%c]%c','color: #EEE','color: #ABDA55','color: #EEE','',txt);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// This allow the log to be edited theoricaly at any time\n\t\t\t\t\t\t// (unless autoHideLogs is enabled and/or the log has been deleted)\n\t\t\t\t\t\tif (placeType.indexOf('console') === -1) {\n\t\t\t\t\t\t\tlet methods = {\n\t\t\t\t\t\t\t\tdiv: $logBox,\n\t\t\t\t\t\t\t\ttext: $logBox.find('.text')[0].innerText,\n\t\t\t\t\t\t\t\tedit: function(txt) {\n\t\t\t\t\t\t\t\t\t$logBox.find('.text')[0].innerHTML = (Array.isArray(txt) ? txt.join('<br>') : txt.toString());\n\t\t\t\t\t\t\t\t\treturn this;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tchangeType: function(newType) {\n\t\t\t\t\t\t\t\t\tif (newType === type) return methods;\n\t\t\t\t\t\t\t\t\t$logBox.toggleClass('pi-'+type + ' pi-'+newType);\n\t\t\t\t\t\t\t\t\tlet newNode, icon;\n\n\t\t\t\t\t\t\t\t\tswitch(newType) {\n\t\t\t\t\t\t\t\t\t\tcase 'log':\n\t\t\t\t\t\t\t\t\t\t\tnewNode = document.createElement('i');\n\t\t\t\t\t\t\t\t\t\t\tnewNode.className = 'icon icon-pi';\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'info':\n\t\t\t\t\t\t\t\t\t\t\tnewNode = $.parseHTML(emoji.replace_colons(':information_source:'))[0];\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'warn':\n\t\t\t\t\t\t\t\t\t\t\tnewNode = $.parseHTML(emoji.replace_colons(':warning:'))[0];\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'error':\n\t\t\t\t\t\t\t\t\t\t\tnewNode = $.parseHTML(emoji.replace_colons(':exclamation:'))[0];\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'debug':\n\t\t\t\t\t\t\t\t\t\t\tnewNode = $.parseHTML(emoji.replace_colons(':octocat:'))[0];\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'success':\n\t\t\t\t\t\t\t\t\t\t\tnewNode = $.parseHTML(emoji.replace_colons(':white_check_mark:'))[0];\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\ticon = $logBox[0].children[2].children[0];\n\t\t\t\t\t\t\t\t\ticon.replaceChild(newNode,icon.firstChild);\n\n\t\t\t\t\t\t\t\t\ttype = newType; // important for multiple changes\n\t\t\t\t\t\t\t\t\treturn this;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tremoveCallback: function() {\n\t\t\t\t\t\t\t\t\t$logBox.off('click');\n\t\t\t\t\t\t\t\t\t$logBox.css('cursor', '');\n\t\t\t\t\t\t\t\t\treturn this;\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tdelete: function() {\n\t\t\t\t\t\t\t\t\t$logBox.remove();\n\t\t\t\t\t\t\t\t\treturn this;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t// Callback\n\t\t\t\t\t\t\tif (typeof callback === 'function') {\n\t\t\t\t\t\t\t\t$logBox.css('cursor', 'pointer');\n\t\t\t\t\t\t\t\t$logBox.on('click', function(e) {\n\t\t\t\t\t\t\t\t\tcallback.call(methods, ...cbArgs);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn methods;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmodal: function(set, type, callback, data) {\n\t\t\t\t\t\tif (set) {\n\t\t\t\t\t\t\tvar $dialog;\n\n\t\t\t\t\t\t\tswitch(type) {\n\t\t\t\t\t\t\t\tcase 'custom-bg':\n\t\t\t\t\t\t\t\t\tconst defaultURL = $('.room-background').css('background-image').split('\"')[1];\n\t\t\t\t\t\t\t\t\t$dialog = $(\n\t\t\t\t\t\t\t\t\t\t'<div id=\"dialog-media-update\" class=\"dialog\" style=\"height: auto;\">'+\n\t\t\t\t\t\t\t\t\t\t\t'<div class=\"dialog-frame\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t'<span class=\"title\">'+lang.modal.customBGTitle+'</span>'+\n\t\t\t\t\t\t\t\t\t\t\t\t'<i class=\"icon icon-dialog-close\"></i>'+\n\t\t\t\t\t\t\t\t\t\t\t'</div>'+\n\n\t\t\t\t\t\t\t\t\t\t\t'<div class=\"dialog-body\" style=\"height:300px;overflow-y:auto;\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"dialog-input-container\" style=\"position:relative;top:10px;\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<span class=\"dialog-input-label\">URL</span>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"dialog-input-background\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<input name=\"url\" type=\"text\" placeholder=\".jpg .png .gif..\" value=\"'+(settings.customBGURL !== null ? settings.customBGURL : 'Custom background URL')+'\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t'</div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<p style=\"position:relative;top:55px;\">'+lang.modal.additionalBackgrounds+'</p>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<figure style=\"position:relative;top:65px;\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<figcaption>Plug\\'s original backgrounds</figcaption>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background: url('+defaultURL+') 0 0 / 150px 84px\" data-src=\"default\" alt=\"Plug\\'s background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -150px -84px\" data-src=\"https://dl.dropboxusercontent.com/s/x2m4e4go92ecwn5/2k13winter.jpg\" alt=\"Plug\\'s 2013 winter background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -300px -84px\" data-src=\"https://dl.dropboxusercontent.com/s/06aezou89twexfi/2k14hw.jpg\" alt=\"Plug\\'s 2014 halloween background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -450px -84px\" data-src=\"https://dl.dropboxusercontent.com/s/pru886rp6sfhguo/2k14minecraft.jpg\" alt=\"Plug\\'s 2014 Minecraft background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -600px -84px\" data-src=\"https://dl.dropboxusercontent.com/s/yzwlvq9uk4vgyps/2k14tc.jpg\" alt=\"Plug\\'s 2014 TastyCat background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -750px -84px\" data-src=\"https://dl.dropboxusercontent.com/s/dw1g3g87clubjor/2k14tiki.jpg\" alt=\"Plug\\'s 2014 Tiki background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: 0 -168px\" data-src=\"https://dl.dropboxusercontent.com/s/n0vdz30m4edpvnm/2k14winter.jpg\" alt=\"Plug\\'s 2014 winter background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -150px -168px\" data-src=\"https://dl.dropboxusercontent.com/s/tt8385hnd61vu7t/2k15beach.jpg\" alt=\"Plug\\'s 2015 Beach background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -300px -168px\" data-src=\"https://dl.dropboxusercontent.com/s/tdiyz39fpepdamt/2k15diner.jpg\" alt=\"Plug\\'s 2015 Diner background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -450px -168px\" data-src=\"https://dl.dropboxusercontent.com/s/gdw01htqn3kb5ul/2k15island.jpg\" alt=\"Plug\\'s 2015 Island background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -600px -168px\" data-src=\"https://dl.dropboxusercontent.com/s/f05ranw1gjmrekj/2k15nyc.jpg\" alt=\"Plug\\'s 2015 New York City background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -750px -168px\" data-src=\"https://dl.dropboxusercontent.com/s/1e7isnah6dz8mks/2k15sea.jpg\" alt=\"Plug\\'s 2015 Sea background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: 0 -252px\" data-src=\"https://dl.dropboxusercontent.com/s/godmbmvf7iso1hp/2k15tasty.jpg\" alt=\"Plug\\'s 2015 Tasty background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t'</figure>'+\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<figure style=\"position:relative;top:65px;\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<figcaption>'+lang.modal.otherChoices+'</figcaption>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: 0 0\" data-src=\"https://dl.dropboxusercontent.com/s/guglxeg29z8xdyc/Plug-It.jpg\" alt=\"Plug-It background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -150px 0\" data-src=\"https://dl.dropboxusercontent.com/s/okazf75swvx5n3r/Plug-It-old.jpg\" alt=\"Plug-It Old background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: 0 -336px\" data-src=\"https://dl.dropboxusercontent.com/s/rs4yhqsmp557q46/2k14lounge.jpg\" alt=\"lounge background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -150px -336px\" data-src=\"https://dl.dropboxusercontent.com/s/rayu1kdzve55ynd/2k14worldonfire.jpg\" alt=\"WorldOnFire background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -300px -336px\" data-src=\"https://dl.dropboxusercontent.com/s/hwh25f5o39a4rft/2k15rtreesmusic.jpg\" alt=\"/r/trees background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -450px -336px\" data-src=\"https://dl.dropboxusercontent.com/s/rg7egwly5m41z5a/2k15thenation.jpg\" alt=\"The Nation background\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -600px -336px\" data-src=\"https://dl.dropboxusercontent.com/s/3kg8riyabo08y9a/JGI5G7x.jpg\" alt=\"Unknown\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -750px -336px\" data-src=\"https://dl.dropboxusercontent.com/s/gb3ogpqpg5mi15v/minecraft.jpg\" alt=\"Minecraft\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: 0 -420px\" data-src=\"https://dl.dropboxusercontent.com/s/nvc6xtx17oqlzlv/NYC-Custom.jpg\" alt=\"NYC - Custom\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -150px -420px\" data-src=\"https://dl.dropboxusercontent.com/s/30zbmkdi31jtxtl/plugalpha.jpg\" alt=\"Plug Alpha\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"thumbnail\" style=\"background-position: -300px -420px\" data-src=\"https://dl.dropboxusercontent.com/s/idchvsywitwvns5/plugalphaLounge.jpg\" alt=\"Plug Alpha Lounge\"></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t'</figure>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\t'<p style=\"position:relative;top:70px;\">'+lang.modal.customBGDisclaimer+'</p>'+\n\t\t\t\t\t\t\t\t\t\t\t\t'</div>'+\n\t\t\t\t\t\t\t\t\t\t\t'</div>'+\n\n\t\t\t\t\t\t\t\t\t\t\t'<div class=\"dialog-frame\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"button cancel\"><span>'+lang.glossary.cancel+'</span></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"button submit\"><span>'+lang.glossary.save+'</span></div>'+\n\t\t\t\t\t\t\t\t\t\t\t'</div>'+\n\t\t\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t$dialog.on('mouseover', '.thumbnail', function(e) {\n\t\t\t\t\t\t\t\t\t\tlet x = $(this).offset().left + ($(this).width()/2);\n\t\t\t\t\t\t\t\t\t\tlet y = $(this).offset().top;\n\t\t\t\t\t\t\t\t\t\tpi._tool.tooltip(true, 'right', x,y, this.attributes.alt.value);\n\t\t\t\t\t\t\t\t\t\t$('#tooltip').css({transform: 'translate(-100%, -175%)'});\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t$dialog.on('mouseleave', '.thumbnail', function(e) {pi._tool.tooltip();});\n\t\t\t\t\t\t\t\t\t$dialog.on('click', '.thumbnail', function(e) {\n\t\t\t\t\t\t\t\t\t\tif (e.target.dataset.src === 'default') pi.changeBG(true);\n\t\t\t\t\t\t\t\t\t\telse pi.changeBG(false, e.target.dataset.src);\n\n\t\t\t\t\t\t\t\t\t\tpi._tool.tooltip(false);\n\t\t\t\t\t\t\t\t\t\tpi._tool.modal(false);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 'confirmDelete':\n\t\t\t\t\t\t\t\t\t$dialog = $(\n\t\t\t\t\t\t\t\t\t\t'<div id=\"dialog-media\" class=\"dialog\">'+\n\t\t\t\t\t\t\t\t\t\t\t'<div class=\"dialog-frame\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t'<span class=\"title\">'+lang.modal.confirmDeleteTitle+'</span>'+\n\t\t\t\t\t\t\t\t\t\t\t\t'<i class=\"icon icon-dialog-close\"></i>'+\n\t\t\t\t\t\t\t\t\t\t\t'</div>'+\n\n\t\t\t\t\t\t\t\t\t\t\t'<div class=\"dialog-body\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t'<p>'+\n\t\t\t\t\t\t\t\t\t\t\t\t\tdata.un + ': ' + data.message +\n\t\t\t\t\t\t\t\t\t\t\t\t'</p>'+\n\t\t\t\t\t\t\t\t\t\t\t'</div>'+\n\n\t\t\t\t\t\t\t\t\t\t\t'<div class=\"dialog-frame\">'+\n\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"button cancel\"><span>'+lang.glossary.cancel+'</span></div>'+\n\t\t\t\t\t\t\t\t\t\t\t\t'<div class=\"button submit\"><span>'+lang.glossary.delete+'</span></div>'+\n\t\t\t\t\t\t\t\t\t\t\t'</div>'+\n\t\t\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\treturn pi._tool.log('Invalid dialog type.', 'console error');\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tfunction submit() {\n\t\t\t\t\t\t\t\tif (type === 'custom-bg')\n\t\t\t\t\t\t\t\t\tpi.changeBG(false, $dialog.find('input[name=\"url\"]')[0].value);\n\n\t\t\t\t\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t\t\t\t\t\tcallback();\n\n\t\t\t\t\t\t\t\tpi._tool.tooltip(false);\n\t\t\t\t\t\t\t\tpi._tool.modal(false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfunction cancel() {\n\t\t\t\t\t\t\t\tpi._tool.tooltip(false);\n\t\t\t\t\t\t\t\tpi._tool.modal(false);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$dialog.on('click', '.dialog-frame i, .button.cancel', () => {cancel();});\n\t\t\t\t\t\t\t$('#dialog-container').on('click', (e) => {\n\t\t\t\t\t\t\t\tif (e.target.id !== \"dialog-container\") return;\n\t\t\t\t\t\t\t\tcancel();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t$dialog.on('click', '.button.submit', () => {submit();});\n\t\t\t\t\t\t\t$dialog.on('submit', 'input[name=\"url\"]', () => {submit();});\n\n\t\t\t\t\t\t\t$('#dialog-container').append($dialog);\n\t\t\t\t\t\t\t$('#dialog-container').show();\n\t\t\t\t\t\t} else if (!set) {\n\t\t\t\t\t\t\t$('#dialog-container').hide();\n\t\t\t\t\t\t\t$('#dialog-container').html('');\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tnotify: function(title, content, events) {\n\t\t\t\t\t\tvar options = {\n\t\t\t\t\t\t\tbody: content,\n\t\t\t\t\t\t\ticon: \"https://raw.githubusercontent.com/Plug-It/pi/pre-release/img/other/icon-54-hover.png\"\n\t\t\t\t\t\t};\n\t\t\t\t\t\tvar n = new Notification(title,options);\n\t\t\t\t\t\tfor (var type in events) {\n\t\t\t\t\t\t\tn[type] = events[type];\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t// Courtesy of ReAnna https://github.com/extplug/ExtPlug/blob/master/src/plugins/SocketEventsPlugin.js\n\t\t\t\t\tplugSocketHook: {\n\t\t\t\t\t\tinit: function() {\n\t\t\t\t\t\t\tlet that = this;\n\t\t\t\t\t\t\tthis.socket = getSocket();\n\n\t\t\t\t\t\t\tif (this.socket) {\n\t\t\t\t\t\t\t\tthis.onConnect();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// make sure we still get an instance if the server reconnects, or\n\t\t\t\t\t\t\t// if ExtPlug loads before plug.dj connects, by overriding the WebSocket\n\t\t\t\t\t\t\t// constructor\n\t\t\t\t\t\t\tconst WS = WebSocket;\n\t\t\t\t\t\t\twindow.WebSocket = function WebSocketIntercept(arg) {\n\t\t\t\t\t\t\t\tconst ws = new WS(arg);\n\t\t\t\t\t\t\t\t// wait for plug.dj to add handlers\n\t\t\t\t\t\t\t\t_.defer(() => {\n\t\t\t\t\t\t\t\t\t// find the socket object again, this new connection might be\n\t\t\t\t\t\t\t\t\t// instantiated by a plugin or another extension, and that should not\n\t\t\t\t\t\t\t\t\t// be intercepted\n\t\t\t\t\t\t\t\t\tthat.socket = getSocket();\n\t\t\t\t\t\t\t\t\tthat.onConnect();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn ws;\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tWebSocket.prototype = WS.prototype;\n\n\t\t\t\t\t\t\tthis.WS = WS;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tkill: function() {\n\t\t\t\t\t\t\tif (this.WS) window.WebSocket = this.WS;\n\t\t\t\t\t\t\tif (this.advice) this.advice.remove();\n\n\t\t\t\t\t\t\tthis.WS = null;\n\t\t\t\t\t\t\tthis.advice = null;\n\t\t\t\t\t\t\tthis.socket = null;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tonConnect: function() {\n\t\t\t\t\t\t\tif (this.advice) this.advice.remove();\n\n\t\t\t\t\t\t\tthis.advice = meldBefore(this.socket, 'onmessage', (e) => {\n\n\t\t\t\t\t\t\t\tif (e.data !== 'h') {\n\t\t\t\t\t\t\t\t\tJSON.parse(e.data).forEach((message) => {\n\t\t\t\t\t\t\t\t\t\t// pi._tool.log(message, 'console info');\n\n\t\t\t\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\t\t\t\tswitch (message.a) {\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'chat':\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'chatDelete':\n\t\t\t\t\t\t\t\t\t\t\t\t\tpi._modulesEvent.chatDelete(message);\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'earn':\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (settings.gainNotification) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet PPEarned = message.p.pp - API.getUser().pp;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet XPEarned = message.p.xp - API.getUser().xp;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI.trigger(API.EARN, {pp:PPEarned, xp:XPEarned});\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'floodAPI':\n\t\t\t\t\t\t\t\t\t\t\t\t\tAPI.enabled = false;\n\t\t\t\t\t\t\t\t\t\t\t\t\tsession.floodAPI = true;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t// Not really an error but I want it to show a red message\n\t\t\t\t\t\t\t\t\t\t\t\t\tvar log = pi._tool.log(lang.error.APIFloodDetected, 'error');\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI.enabled = true;\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tsession.floodAPI = false;\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlog.edit('API reactivated').changeType('info');\n\t\t\t\t\t\t\t\t\t\t\t\t\t}, 10*1000);\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'modMute':\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (message.p.d === 'o' && API.hasPermission(null, API.ROLE.BOUNCER)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(`${message.p.t} has been unmuted by ${message.p.m}.`, 'chat info');\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'modStaff':\n\t\t\t\t\t\t\t\t\t\t\t\t\tmessage.p.u.forEach((e,i,a) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet self = API.getUser(); // Unefficient, should cache user somewhere...\n\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.i === self.id) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// From anything to rDJ or Grey\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.p <= 1 && self.role > e.p) modToolbar.kill();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// From Grey or rDJ to anything above\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\telse if (e.p >= 2 && self.role < e.p) modToolbar.init(true);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Fix for custom ranks & plug not removing the staff icon:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t// Plug only hides the icon but the css still shows the username color\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (e.p === 0) $('#footer-user .info .name i')[0].className = 'icon';\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'userJoin':\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'userLeave':\n\t\t\t\t\t\t\t\t\t\t\t\t\tif ((message.p.guest || message.p === 0) && (settings.guestJoin || settings.guestLeave)) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (message.a === 'userJoin' && settings.guestJoin)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI.trigger(API.GUEST_JOIN, modules.room.get('guests')+1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\telse if (message.a === 'userLeave' && settings.guestLeave)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tAPI.trigger(API.GUEST_LEAVE, modules.room.get('guests')-1);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'userUpdate':\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (settings.userLevelUp && message.p.level) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(`User leveled up: ${API.getUser(message.p.i).username} to level ${message.p.level} !`, 'info');\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else if (message.p.badge || message.p.avatarID) {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t// do not log it\n\t\t\t\t\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconsole.log(message);\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'roomWelcomeUpdate':\n\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(`${API.getUser(message.p.u).username} edited the room's welcome message to:\\n${message.p.w}`, 'console info');\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'roomDescriptionUpdate':\n\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(`${API.getUser(message.p.u).username} edited the room's description to:\\n${message.p.d}`, 'console info');\n\t\t\t\t\t\t\t\t\t\t\t\t\troomSettings = {};\n\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.getRoomSettings();\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\t// Unused events\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'advance':\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'djListCycle':\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'djListUpdate':\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'grab':\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'playlistCycle':\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'plugMessage':\n\t\t\t\t\t\t\t\t\t\t\t\tcase 'vote':\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(message, 'console info');\n\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\t\t\t\tpi._tool.log(['error while parsing socket message',e], 'console error');\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (message.a !== 'chatDelete')\n\t\t\t\t\t\t\t\t\t\t\tmodules.context.trigger(`socket:${message.a}`, message.p);\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t// Thanks Burkes for this (slightly modified)\n\t\t\t\t\treplaceString: function(string, object) {\n\t\t\t\t\t\tif (typeof string !== 'string' || typeof object !== 'object') return string;\n\n\t\t\t\t\t\tfor (var key in object) {\n\t\t\t\t\t\t\tstring = string.split('%%'+key.toUpperCase()+'%%').join(object[key]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn string;\n\t\t\t\t\t},\n\t\t\t\t\tsaveSettings: function() {\n\t\t\t\t\t\tlocalStorage.setItem('pi-settings', JSON.stringify(settings));\n\t\t\t\t\t},\n\t\t\t\t\tsetPlugSettings: function(option, value) {\n\t\t\t\t\t\t// Only make ajax call if option is whitelisted\n\t\t\t\t\t\tvar whiteList = ['videoOnly','chatTimestamps','emoji','tooltips','chatImages','notifyDJ','notifyScore','notifyFriendJoin','nsfw','friendAvatarsOnly'];\n\t\t\t\t\t\tfor (var i = 0; i < whiteList.length; i++) {\n\t\t\t\t\t\t\tif (option == whiteList[i] && !session.floodAPI) {\n\t\t\t\t\t\t\t\tvar data = {};\n\t\t\t\t\t\t\t\tdata[option] = value;\n\t\t\t\t\t\t\t\t$.ajax({\n\t\t\t\t\t\t\t\t\ttype: 'PUT',\n\t\t\t\t\t\t\t\t\turl: '/_/users/settings',\n\t\t\t\t\t\t\t\t\tdata: JSON.stringify(data),\n\t\t\t\t\t\t\t\t\terror: function(e) {\n\t\t\t\t\t\t\t\t\t\tpi._tool.log(e.responseJSON.data[0], 'error console');\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tdataType: 'json',\n\t\t\t\t\t\t\t\t\tcontentType: 'application/json'\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar json = JSON.parse(localStorage.getItem('settings'));\n\t\t\t\t\t\tvar id = API.getUser().id;\n\t\t\t\t\t\tfor (var i = 1; i < 5; i++) {\n\t\t\t\t\t\t\tif (typeof json[i] !== 'undefined') {\n\t\t\t\t\t\t\t\tif (typeof json[i][id] !== 'undefined') {\n\t\t\t\t\t\t\t\t\tfor (var obj in json[i][id]) {\n\t\t\t\t\t\t\t\t\t\tif (obj == option) json[i][id][obj] = value;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlocalStorage.setItem('settings', JSON.stringify(json));\n\t\t\t\t\t},\n\t\t\t\t\tshowGiftDialog(id, username, amount) {\n\t\t\t\t\t\tmodules.context.dispatch(new modules.ShowDialogEvent(modules.ShowDialogEvent.SHOW, new modules.GiftSendDialog({\n\t\t\t\t\t\t\tmodel: new modules.User({id: id, username: username})\n\t\t\t\t\t\t})));\n\t\t\t\t\t\t$('#dialog-gift-send .amount input')[0].value = amount;\n\t\t\t\t\t},\n\t\t\t\t\tshowVotes: function(set, type, votes) {\n\t\t\t\t\t\tif (set) {\n\t\t\t\t\t\t\t// reset\n\t\t\t\t\t\t\tif ($('#pi-votes').length) pi._tool.showVotes(false);\n\t\t\t\t\t\t\tvar list = '';\n\n\t\t\t\t\t\t\tif (votes.length !== 0) {\n\t\t\t\t\t\t\t\tfor (var i = 0; i < votes.length; i++) {\n\t\t\t\t\t\t\t\t\tlist += '<li>'+votes[i].rawun+'</li>\\n';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar $votes = $(\n\t\t\t\t\t\t\t\t'<div id=\"pi-votes\" class=\"'+type+'\">'+\n\t\t\t\t\t\t\t\t\t'<div id=\"header\">'+$('#'+type+' .label')[0].innerText.replace('!','')+'s</div>'+\n\t\t\t\t\t\t\t\t\t'<ul>'+list+'</ul>'+\n\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t$votes.on('mouseleave', function() {this.remove();});\n\t\t\t\t\t\t\t$('#vote').append($votes);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar piVotes = $('#pi-votes');\n\t\t\t\t\t\t\twhile (piVotes.length) {\n\t\t\t\t\t\t\t\tpiVotes.remove();\n\t\t\t\t\t\t\t\tpiVotes = $('#pi-votes');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\ttooltip: function(set, type, x,y, txt) {\n\t\t\t\t\t\tif (!pi._tool.getPlugSettings().tooltips) return;\n\t\t\t\t\t\tif (set) {\n\t\t\t\t\t\t\tif ($('#tooltip').length) $('#tooltip').remove();;\n\t\t\t\t\t\t\tvar $tooltip = $(\n\t\t\t\t\t\t\t\t'<div id=\"tooltip\" class=\"'+type+'\" style=\"top: '+y+'px; left: '+x+'px;\">'+\n\t\t\t\t\t\t\t\t\t'<span>'+txt+'</span>'+\n\t\t\t\t\t\t\t\t\t'<div class=\"corner\"></div>'+\n\t\t\t\t\t\t\t\t'</div>'\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t$('body').append($tooltip);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t// Trickery in case they could be multiple #tooltip to remove all of them\n\t\t\t\t\t\t\t// Jquery only getting one per ID, select with attribute..\n\t\t\t\t\t\t\t$('[id=\"tooltip\"]').remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tafk: function(msg) {\n\t\t\t\t\tif (typeof originalPlaceholder == 'undefined') window.originalPlaceholder = $(\"#chat-input-field\")[0].placeholder;\n\n\t\t\t\t\tif (settings.afk) {\n\t\t\t\t\t\t$(\"#chat-input-field\")[0].disabled = true;\n\t\t\t\t\t\t$(\"#chat-input-field\")[0].placeholder = lang.userchat.inputDisabled;\n\t\t\t\t\t\tpi.dom.afkResponder.className = 'pi-on';\n\t\t\t\t\t\t$('#pi-afk .pi-afk').removeClass('off');\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$(\"#chat-input-field\")[0].disabled = false;\n\t\t\t\t\t\t$(\"#chat-input-field\")[0].placeholder = originalPlaceholder;\n\t\t\t\t\t\tpi.dom.afkResponder.className = 'pi-off';\n\t\t\t\t\t\t$('#pi-afk .pi-afk').addClass('off');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tautojoin: function() {\n\t\t\t\t\tvar dj = API.getDJ();\n\n\t\t\t\t\tif (settings.autoDJ && pi._tool.getRoomRules('allowAutojoin')) {\n\t\t\t\t\t\tif (typeof dj !== 'undefined') {\n\t\t\t\t\t\t\tif (dj.id !== API.getUser().id && API.getWaitListPosition() === -1) {\n\t\t\t\t\t\t\t\tswitch (API.djJoin()) {\n\t\t\t\t\t\t\t\t\tcase 1:\n\t\t\t\t\t\t\t\t\t\tpi._tool.log(lang.error.autoJoin1, 'error chat');\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 2:\n\t\t\t\t\t\t\t\t\t\tpi._tool.log(lang.error.autoJoin2, 'error chat');\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\t\t\tpi._tool.log(lang.error.autoJoin3, 'error chat');\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tAPI.djJoin();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tautowoot: function() {\n\t\t\t\t\tif (settings.autoW && !$('#meh').is('.selected')) {\n\t\t\t\t\t\tif (pi._tool.getRoomRules('allowAutowoot')) $('#woot')[0].click();\n\t\t\t\t\t\t// set up a sessionStorage to show this message only once\n\t\t\t\t\t\t// else pi._tool.log('This room does not allow you to autowoot.');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbetterClearChat: function(x) {\n\t\t\t\t\tlet messages = $('#chat-messages > div').toArray();\n\n\t\t\t\t\tif (x < messages.length) {\n\t\t\t\t\t\t// jQuery.each() does not passes the array\n\t\t\t\t\t\tmessages.forEach(function(e,i,a) {\n\t\t\t\t\t\t\tif (i + x < a.length) $(e).remove();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tchangeBG: function(isDefault, src) {\n\t\t\t\t\tif (isDefault) {\n\t\t\t\t\t\t$('.room-background').show();\n\t\t\t\t\t\t$('#pi-background').hide();\n\n\t\t\t\t\t\tif ($('i.torch').length) {\n\t\t\t\t\t\t\t$('i.torch').show();\n\t\t\t\t\t\t\t$('i.torch.right').show();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsettings.customBG = false;\n\t\t\t\t\t\tpi.dom.bg.className = 'pi-off';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (typeof src === 'undefined' && !settings.customBGURL.length) {\n\t\t\t\t\t\t\tsrc = url.images.background;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsrc = (typeof src === 'string' ? src : url.images.background);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$('.room-background').hide();\n\t\t\t\t\t\t$('#pi-background').show();\n\t\t\t\t\t\t$('#pi-background').css('background', 'url('+src+') no-repeat');\n\n\t\t\t\t\t\tif ($('i.torch').length) {\n\t\t\t\t\t\t\t$('i.torch').hide();\n\t\t\t\t\t\t\t$('i.torch.right').hide();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsettings.customBG = true;\n\t\t\t\t\t\tsettings.customBGURL = src;\n\t\t\t\t\t\tpi.dom.bg.className = 'pi-on';\n\t\t\t\t\t}\n\n\t\t\t\t\tpi._tool.saveSettings();\n\t\t\t\t},\n\t\t\t\teta: function(log) {\n\t\t\t\t\tlet eta;\n\n\t\t\t\t\tif (API.getUser().id == API.getDJ().id) {\n\t\t\t\t\t\tif (log) pi._tool.log(lang.info.youPlay, 'info chat');\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t} else if (API.getWaitListPosition() == -1) {\n\t\t\t\t\t\tif (log) pi._tool.log(lang.info.notInWaitList, 'info chat');\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t} else if (API.getWaitListPosition() == 0) {\n\t\t\t\t\t\teta = API.getTimeRemaining();\n\t\t\t\t\t\tif (eta >= 3600) {\n\t\t\t\t\t\t\tvar etaH = Math.floor(eta/60);\n\t\t\t\t\t\t\tvar etaM = eta%60;\n\t\t\t\t\t\t\teta = etaH+'h'+etaM+'m';\n\t\t\t\t\t\t} else if (eta >= 60) {\n\t\t\t\t\t\t\tvar etaM = Math.floor(eta/60);\n\t\t\t\t\t\t\tvar etaS = eta%60;\n\t\t\t\t\t\t\tetasS = (etaS < 10 ? '0'+etaS : etaS);\n\t\t\t\t\t\t\teta = etaM+'m'+etaS+'s';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\teta = eta+'s';\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\teta = (API.getWaitListPosition())*4*60;\n\t\t\t\t\t\teta += API.getTimeRemaining();\n\t\t\t\t\t\tif (eta >= 3600) {\n\t\t\t\t\t\t\tvar etaH = Math.floor(eta/60/60);\n\t\t\t\t\t\t\tvar etaM = eta%60;\n\t\t\t\t\t\t\teta = etaH+'h'+etaM+'m';\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar etaM = Math.floor(eta/60);\n\t\t\t\t\t\t\tvar etaS = eta%60;\n\t\t\t\t\t\t\teta = etaM+'m'+etaS+'s';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (log) {\n\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\tpi._tool.replaceString(\n\t\t\t\t\t\t\t\tlang.log.eta,\n\t\t\t\t\t\t\t\t{time: eta}\n\t\t\t\t\t\t\t), 'info chat'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn eta;\n\t\t\t\t},\n\t\t\t\tforceSkip: function() {\n\t\t\t\t\tif (sessionStorage.getItem('modSkipWarn') == 'false') {\n\t\t\t\t\t\tsessionStorage.setItem('modSkipWarn', 'true');\n\t\t\t\t\t\tpi._tool.log(lang.warn.confirmSkip, 'warn chat');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsessionStorage.setItem('modSkipWarn', 'false');\n\t\t\t\t\t\tAPI.moderateForceSkip();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thideStream: function() {\n\t\t\t\t\tif (settings.showVideo) {\n\t\t\t\t\t\tif (pi._tool.getPlugSettings().videoOnly) {\n\t\t\t\t\t\t\tpi.dom.playback.style.height = window.innerHeight - 185+'px';\n\t\t\t\t\t\t\t$(pi.dom.stream).css({visibility:'visible', height:'100%'});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tpi.dom.playback.style.height = '271px';\n\t\t\t\t\t\t\t$(pi.dom.stream).css({visibility:'visible', height:'281px'});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (API.hasPermission(null,API.ROLE.BOUNCER)) {\n\t\t\t\t\t\t\t$([pi.dom.rmvDJ, pi.dom.skip]).css('top', '281px');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('#playback-controls, #no-dj').css('visibility', 'visible');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tpi.dom.playback.style.height = '0px';\n\t\t\t\t\t\t$(pi.dom.stream).css({visibility:'hidden', height:'0'});\n\t\t\t\t\t\tif (API.hasPermission(null,API.ROLE.BOUNCER)) {\n\t\t\t\t\t\t\t$([pi.dom.rmvDJ, pi.dom.skip]).css('top', '0');\n\t\t\t\t\t\t}\n\t\t\t\t\t\t$('#playback-controls, #no-dj').css('visibility', 'hidden');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmenu: function(choice) {\n\t\t\t\t\tswitch(choice) {\n\t\t\t\t\t\tcase 'woot':\n\t\t\t\t\t\t\tsettings.autoW = !settings.autoW;\n\t\t\t\t\t\t\tpi.dom.woot.className = settings.autoW ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.autowoot();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'join':\n\t\t\t\t\t\t\tsettings.autoDJ = !settings.autoDJ;\n\t\t\t\t\t\t\tpi.dom.join.className = settings.autoDJ ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.autojoin();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'keyShortcut':\n\t\t\t\t\t\t\tsettings.keyboardShortcuts = !settings.keyboardShortcuts;\n\t\t\t\t\t\t\tpi.dom.keyShortcut.className = settings.keyboardShortcuts ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'chatCommands':\n\t\t\t\t\t\t\tsettings.chatCommands = !settings.chatCommands;\n\t\t\t\t\t\t\tpi.dom.chatCommands.className = settings.chatCommands ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'autoHideLogs':\n\t\t\t\t\t\t\tsettings.autoHideLogs = !settings.autoHideLogs;\n\t\t\t\t\t\t\tpi.dom.autoHideLogs.className = settings.autoHideLogs ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'mutemeh':\n\t\t\t\t\t\t\tsettings.betterMeh = !settings.betterMeh;\n\t\t\t\t\t\t\tpi.dom.betterMeh.className =settings.betterMeh ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.muteMeh();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'afkResponder':\n\t\t\t\t\t\t\tsettings.afk = !settings.afk;\n\t\t\t\t\t\t\tpi.afk();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'navWarn':\n\t\t\t\t\t\t\tsettings.navWarn = !settings.navWarn;\n\t\t\t\t\t\t\tpi.dom.navWarn.className = settings.navWarn ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'showVotes':\n\t\t\t\t\t\t\tsettings.showVotes = !settings.showVotes;\n\t\t\t\t\t\t\tpi.dom.showVotes.className = settings.showVotes ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'skipNextMediaInHistory':\n\t\t\t\t\t\t\tsettings.skipNextMediaInHistory = !settings.skipNextMediaInHistory;\n\t\t\t\t\t\t\tpi.dom.skipNextMediaInHistory.className = settings.skipNextMediaInHistory ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'video':\n\t\t\t\t\t\t\tsettings.showVideo = !settings.showVideo;\n\t\t\t\t\t\t\tpi.dom.video.className = settings.showVideo ? 'pi-off' : 'pi-on';\n\t\t\t\t\t\t\tpi.hideStream();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'soundcloudVisu':\n\t\t\t\t\t\t\tsettings.scVisu = !settings.scVisu;\n\t\t\t\t\t\t\tpi.dom.soundcloudVisu.className = settings.scVisu ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.soundcloudVisu();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'room-style':\n\t\t\t\t\t\t\tsettings.roomStyle = !settings.roomStyle;\n\t\t\t\t\t\t\tpi.dom.roomStyle.className = settings.roomStyle ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('roomStyle');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'css':\n\t\t\t\t\t\t\tsettings.CSS = !settings.CSS;\n\t\t\t\t\t\t\tpi.dom.css.className = settings.CSS ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('customStyle');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'customRanks':\n\t\t\t\t\t\t\tsettings.customRanks = !settings.customRanks;\n\t\t\t\t\t\t\tpi.dom.customRanks.className = settings.customRanks ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('customRanks');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'languageFlags':\n\t\t\t\t\t\t\tsettings.languageFlags = !settings.languageFlags;\n\t\t\t\t\t\t\tpi.dom.languageFlags.className = settings.languageFlags ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tsettings.languageFlags ? $('.un ~ .pi-languageFlags').show() : $('.un ~ .pi-languageFlags').hide();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'friendsIcons':\n\t\t\t\t\t\t\tsettings.friendsIcons = !settings.friendsIcons;\n\t\t\t\t\t\t\tpi.dom.friendsIcons.className = settings.friendsIcons ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tsettings.friendsIcons ? $('.un ~ .pi-friendsIcons').show() : $('.un ~ .pi-friendsIcons').hide();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'bg':\n\t\t\t\t\t\t\tpi._tool.modal(true, 'custom-bg');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'old-chat':\n\t\t\t\t\t\t\tsettings.oldChat = !settings.oldChat;\n\t\t\t\t\t\t\tpi.dom.oldChat.className = settings.oldChat ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('oldChat');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'old-footer':\n\t\t\t\t\t\t\tsettings.oldFooter = !settings.oldFooter;\n\t\t\t\t\t\t\tpi.dom.oldFooter.className = settings.oldFooter ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('oldFooter');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'small-history':\n\t\t\t\t\t\t\tsettings.smallHistory = !settings.smallHistory;\n\t\t\t\t\t\t\tpi.dom.smallHistory.className = settings.smallHistory ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('smallHistory');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'small-friends':\n\t\t\t\t\t\t\tsettings.smallFriends = !settings.smallFriends;\n\t\t\t\t\t\t\tpi.dom.smallFriends.className = settings.smallFriends ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('smallFriends');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'small-playlists':\n\t\t\t\t\t\t\tsettings.smallPlaylists = !settings.smallPlaylists;\n\t\t\t\t\t\t\tpi.dom.smallPlaylists.className = settings.smallPlaylists ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('smallPlaylists');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'showDeletedMsg':\n\t\t\t\t\t\t\tsettings.showDeletedMsg = !settings.showDeletedMsg;\n\t\t\t\t\t\t\tpi.dom.showDeletedMsg.className = settings.showDeletedMsg ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tif (settings.showDeletedMsg) $('.cm.deleted').show();\n\t\t\t\t\t\t\telse $('.cm.deleted').hide();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'confirmDelete':\n\t\t\t\t\t\t\tsettings.confirmDelete = !settings.confirmDelete;\n\t\t\t\t\t\t\tpi.dom.confirmDelete.className = settings.confirmDelete ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'userInfo':\n\t\t\t\t\t\t\tsettings.userInfo = !settings.userInfo;\n\t\t\t\t\t\t\tpi.dom.userInfo.className = settings.userInfo ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tsettings.userInfo ? $('.un ~ .userInfo').show() : $('.un ~ .userInfo').hide();\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'stuckSkip':\n\t\t\t\t\t\t\tsettings.stuckSkip = !settings.stuckSkip;\n\t\t\t\t\t\t\tpi.dom.stuckSkip.className = settings.stuckSkip ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'lengthA':\n\t\t\t\t\t\t\tsettings.songLimit = !settings.songLimit;\n\t\t\t\t\t\t\tpi.dom.lengthA.className = settings.songLimit ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'historyA':\n\t\t\t\t\t\t\tsettings.historyAlert = !settings.historyAlert;\n\t\t\t\t\t\t\tpi.dom.historyAlert.className = settings.historyAlert ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'systemNotifications':\n\t\t\t\t\t\t\tsettings.systemNotifications = !settings.systemNotifications;\n\t\t\t\t\t\t\tpi.dom.systemNotifications.className = settings.systemNotifications ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tif (settings.systemNotifications && Notification.permission == 'default') {\n\t\t\t\t\t\t\t\tNotification.requestPermission(function(status){\n\t\t\t\t\t\t\t\t\tif (Notification.permission !== status) Notification.permission = status;\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'songStats':\n\t\t\t\t\t\t\tsettings.songStats = !settings.songStats;\n\t\t\t\t\t\t\tpi.dom.songStats.className = settings.songStats ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'boothAlert':\n\t\t\t\t\t\t\tsettings.boothAlert = !settings.boothAlert;\n\t\t\t\t\t\t\tpi.dom.boothAlert.className = settings.boothAlert ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'userJoin':\n\t\t\t\t\t\t\tsettings.userJoin = !settings.userJoin;\n\t\t\t\t\t\t\tpi.dom.userJoin.className = settings.userJoin ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'userLeave':\n\t\t\t\t\t\t\tsettings.userLeave = !settings.userLeave;\n\t\t\t\t\t\t\tpi.dom.userLeave.className = settings.userLeave ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'userWoot':\n\t\t\t\t\t\t\tsettings.userWoot = !settings.userWoot;\n\t\t\t\t\t\t\tpi.dom.userWoot.className = settings.userWoot ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'userGrab':\n\t\t\t\t\t\t\tsettings.userGrab = !settings.userGrab;\n\t\t\t\t\t\t\tpi.dom.userGrab.className = settings.userGrab ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'userMeh':\n\t\t\t\t\t\t\tsettings.userMeh = !settings.userMeh;\n\t\t\t\t\t\t\tpi.dom.mehA.className = settings.userMeh ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'guestJoin':\n\t\t\t\t\t\t\tsettings.guestJoin = !settings.guestJoin;\n\t\t\t\t\t\t\tpi.dom.guestJoin.className = settings.guestJoin ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'guestLeave':\n\t\t\t\t\t\t\tsettings.guestLeave = !settings.guestLeave;\n\t\t\t\t\t\t\tpi.dom.guestLeave.className = settings.guestLeave ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'friendRoomChange':\n\t\t\t\t\t\t\tsettings.friendRoomChange = !settings.friendRoomChange;\n\t\t\t\t\t\t\tpi.dom.friendRoomChange.className = settings.friendRoomChange ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'friendConnect':\n\t\t\t\t\t\t\tsettings.friendConnect = !settings.friendConnect;\n\t\t\t\t\t\t\tpi.dom.friendConnect.className = settings.friendConnect ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'friendDisconnect':\n\t\t\t\t\t\t\tsettings.friendDisconnect = !settings.friendDisconnect;\n\t\t\t\t\t\t\tpi.dom.friendDisconnect.className = settings.friendDisconnect ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'unfriended':\n\t\t\t\t\t\t\tsettings.unfriended = !settings.unfriended;\n\t\t\t\t\t\t\tpi.dom.unfriended.className = settings.unfriended ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'gainNotification':\n\t\t\t\t\t\t\tsettings.gainNotification = !settings.gainNotification;\n\t\t\t\t\t\t\tpi.dom.gainNotification.className = settings.gainNotification ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'userLevelUp':\n\t\t\t\t\t\t\tsettings.userLevelUp = !settings.userLevelUp;\n\t\t\t\t\t\t\tpi.dom.userLevelUp.className = settings.userLevelUp ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'init':\n\t\t\t\t\t\t\t// Init menu item's class\n\t\t\t\t\t\t\t// General\n\t\t\t\t\t\t\tpi.dom.woot.className = settings.autoW ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.autowoot();\n\t\t\t\t\t\t\tpi.dom.join.className = settings.autoDJ ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.autojoin();\n\t\t\t\t\t\t\tpi.dom.keyShortcut.className = settings.keyboardShortcuts ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.chatCommands.className = settings.chatCommands ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.autoHideLogs.className = settings.autoHideLogs ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.betterMeh.className =settings.betterMeh ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.afkResponder.className = settings.afk ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.afkMessage.children[0].value = settings.afkMessage;\n\t\t\t\t\t\t\tpi.afk();\n\t\t\t\t\t\t\tpi.dom.navWarn.className = settings.navWarn ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.showVotes.className = settings.showVotes ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.betterClearChatLimit.children[0].value = settings.betterClearChatLimit;\n\t\t\t\t\t\t\tpi.dom.chatLimit.children[0].value = settings.chatLimit;\n\t\t\t\t\t\t\tpi.dom.skipNextMediaInHistory.className = settings.skipNextMediaInHistory ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\t// Customisation\n\t\t\t\t\t\t\tpi.dom.video.className = settings.showVideo ? 'pi-off' : 'pi-on';\n\t\t\t\t\t\t\tpi.hideStream();\n\t\t\t\t\t\t\tpi.dom.soundcloudVisu.className = settings.scVisu ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.css.className = settings.CSS ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('customStyle');\n\t\t\t\t\t\t\tpi.dom.customRanks.className = settings.customRanks ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('customRanks');\n\t\t\t\t\t\t\tpi.dom.languageFlags.className = settings.languageFlags ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.friendsIcons.className = settings.friendsIcons ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tsettings.customBGURL !== null ? pi.changeBG(false, settings.customBGURL) : void 0;\n\t\t\t\t\t\t\tpi.dom.oldChat.className = settings.oldChat ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('oldChat');\n\t\t\t\t\t\t\tpi.dom.oldFooter.className = settings.oldFooter ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('oldFooter');\n\t\t\t\t\t\t\tpi.dom.smallHistory.className = settings.smallHistory ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('smallHistory');\n\t\t\t\t\t\t\tpi.dom.smallFriends.className = settings.smallFriends ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('smallFriends');\n\t\t\t\t\t\t\tpi.dom.smallPlaylists.className = settings.smallPlaylists ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.toggleStyle('smallPlaylists');\n\t\t\t\t\t\t\t// Moderation\n\t\t\t\t\t\t\tpi.dom.showDeletedMsg.className = settings.showDeletedMsg ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.confirmDelete.className = settings.confirmDelete ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.userInfo.className = settings.userInfo ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.stuckSkip.className = settings.stuckSkip ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.lengthA.className = settings.songLimit ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.songLength.children[0].value = settings.songLength;\n\t\t\t\t\t\t\tpi.dom.historyAlert.className = settings.historyAlert ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\t// Notifications\n\t\t\t\t\t\t\tpi.dom.systemNotifications.className = settings.systemNotifications ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.songStats.className = settings.songStats ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.boothAlert.className = settings.boothAlert ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.boothPosition.children[0].value = settings.boothPosition;\n\t\t\t\t\t\t\tpi.dom.userJoin.className = settings.userJoin ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.userLeave.className = settings.userLeave ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.userWoot.className = settings.userWoot ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.userGrab.className = settings.userGrab ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.mehA.className = settings.userMeh ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.guestJoin.className = settings.guestJoin ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.guestLeave.className = settings.guestLeave ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.friendRoomChange.className = settings.friendRoomChange ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.friendConnect.className = settings.friendConnect ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.friendDisconnect.className = settings.friendDisconnect ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.unfriended.className = settings.unfriended ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.gainNotification.className = settings.gainNotification ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\t\tpi.dom.gainNotificationMinXP.children[1].value = settings.minimumGain.xp;\n\t\t\t\t\t\t\tpi.dom.gainNotificationMinPP.children[1].value = settings.minimumGain.pp;\n\t\t\t\t\t\t\tpi.dom.userLevelUp.className = settings.userLevelUp ? 'pi-on' : 'pi-off';\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'off':\n\t\t\t\t\t\t\tpi._tool.saveSettings();\n\t\t\t\t\t\t\tpi._close();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tpi._tool.log('Unrecognized menu string: '+choice, 'console error');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (choice !== 'off') pi._tool.saveSettings();\n\t\t\t\t},\n\t\t\t\tmuteMeh: function() {\n\t\t\t\t\tlet vol = API.getVolume();\n\n\t\t\t\t\tfunction restoreVol() {\n\t\t\t\t\t\tAPI.setVolume(vol);\n\n\t\t\t\t\t\t// Turning the event off for BOTH\n\t\t\t\t\t\t// as we don't know which is called first\n\t\t\t\t\t\tAPI.off(API.ADVANCE, restoreVol);\n\t\t\t\t\t\t$('#woot').off('click', restoreVol);\n\n\t\t\t\t\t\t// Listen for meh again\n\t\t\t\t\t\t$('#meh').one('click', mute);\n\t\t\t\t\t}\n\t\t\t\t\tfunction mute() {\n\t\t\t\t\t\t// Meh is disabled, do not change volume\n\t\t\t\t\t\tif (!$('#meh').hasClass('disabled')) {\n\t\t\t\t\t\t\tvol = API.getVolume();\n\t\t\t\t\t\t\tAPI.setVolume(0);\n\t\t\t\t\t\t\tAPI.once(API.ADVANCE, restoreVol);\n\t\t\t\t\t\t\t$('#woot').one('click', restoreVol);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (settings.betterMeh) $('#meh').one('click', mute);\n\t\t\t\t\telse $('#meh').off('click', mute);\n\t\t\t\t},\n\t\t\t\tremoveDJ: function() {\n\t\t\t\t\tif (sessionStorage.getItem('modQuitWarn') == 'false') {\n\t\t\t\t\t\tsessionStorage.setItem('modQuitWarn', 'true');\n\t\t\t\t\t\tpi._tool.log(lang.warn.confirmEject, 'warn chat');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsessionStorage.setItem('modQuitWarn', 'false');\n\t\t\t\t\t\tAPI.moderateForceQuit();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsongLimit: function() {\n\t\t\t\t\tif (settings.songLimit) {\n\t\t\t\t\t\tif (API.getMedia() !== undefined) {\n\t\t\t\t\t\t\tif (API.getMedia().duration > settings.songLength) {\n\t\t\t\t\t\t\t\t// notif.play();\n\t\t\t\t\t\t\t\tpi._tool.log(pi._tool.replaceString(lang.warn.songLimit, {max:settings.songLength}), 'warn chat');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsoundcloudVisu: function(media) {\n\t\t\t\t\tlet $scFrame = $('#sc-frame');\n\t\t\t\t\tlet $myFrame = $('#pi-frame');\n\n\t\t\t\t\tif (typeof media === \"undefined\") media = API.getMedia();\n\n\t\t\t\t\tif (media.format === 1 && $('#pi-frame').is(':visible')) {\n\t\t\t\t\t\treturn $myFrame.hide();\n\t\t\t\t\t} else if (media.format === 1) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (settings.scVisu && !pi._tool.getPlugSettings().streamDisabled) {\n\t\t\t\t\t\tlet randomVisu = Math.floor(Math.random()*url.visu.length);\n\t\t\t\t\t\t$scFrame.hide();\n\t\t\t\t\t\t$myFrame.show();\n\t\t\t\t\t\t$myFrame[0].src = url.visu[randomVisu];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$scFrame.show();\n\t\t\t\t\t\t$myFrame.hide();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttoggleStyle: function(which) {\n\t\t\t\t\tswitch(which) {\n\t\t\t\t\t\tcase 'roomStyle':\n\t\t\t\t\t\t\tif (settings.roomStyle) {\n\t\t\t\t\t\t\t\tvar $roomLink = $('<link id=\"pi-custom-room-style\" rel=\"stylesheet\" type=\"text/css\" href=\"'+roomSettings.css+'\">');\n\t\t\t\t\t\t\t\t$('head').append($roomLink);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$('#pi-custom-room-style').remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'customStyle':\n\t\t\t\t\t\t\tif (settings.CSS) {\n\t\t\t\t\t\t\t\t$('head').append($('<link id=\"pi-CSS\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.blue_css+'\">'));\n\t\t\t\t\t\t\t\tpi.changeBG(false, settings.customBGURL !== null ? settings.customBGURL : url.images.background);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$('#pi-CSS').remove();\n\t\t\t\t\t\t\t\tpi.changeBG(true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'customRanks':\n\t\t\t\t\t\t\tif (settings.customRanks) {\n\t\t\t\t\t\t\t\t$('head').append($('<link id=\"pi-custom_ranks\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.custom_ranks+'\">'));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$('#pi-custom_ranks').remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'oldChat':\n\t\t\t\t\t\t\tif (settings.oldChat) {\n\t\t\t\t\t\t\t\t$('head').append($('<link id=\"pi-oldchat-CSS\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.old_chat+'\">'));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$('#pi-oldchat-CSS').remove();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// You found an easter egg !\n\t\t\t\t\t\t\twindow.WiBla = {\n\t\t\t\t\t\t\t\tlisten: 'always',\n\t\t\t\t\t\t\t\trulesTheWorld: 'not yet :troll:',\n\t\t\t\t\t\t\t\tisOnFire: function() {\n\t\t\t\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t\t\t\t\"%c                '@@             `.     @'          \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c     @@         @@@   @,    :'@@@@@#   @@          \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c     @@         @@;  +@@   @@@@@@@@@  ,@@          \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c    +@@    `    @@   :@+   @@@;  `@@  @@@          \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c    @@@   @@.   @@         @@`  `@@'  @@.          \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c    @@    @@   ;@@   @,   .@@ `@@@+   @@     ;@@@` \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c   +@@   ;@@   @@+  @@@   @@@@@@@    ,@@    @@@@@@ \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c   @@+   @@@   @@   @@:   @@@@@@,    @@@   @@@@@@; \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c   @@   ;@@;  :@@   @@    @@@@@@@@   @@.  #@@, @@  \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c  '@@   @@@,  @@.  ,@@   +@@   ,@@.  @@   @@; :@@  \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c  @@@  @@@@, `@@   @@@   @@;    @@  :@@  ,@@ ,@@@  \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c  @@; :@@@@+ @@`   @@,   @@   #@@@  @@@  @@@#@@@;  \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c  @@.`@@ ;@@@@@    @@   +@@@@@@@'   @@'  ;@@@@@@   \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c  @@@@@   @@@@     @@   +@@@@@'     @@,   @@@ @@   \\n\"+\n\t\t\t\t\t\t\t\t\t\t\"%c  :@@@     @:      ',               `#             \",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,0%,0%);   text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,5%,5%);   text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,10%,10%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,15%,15%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,20%,20%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,25%,25%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,30%,30%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,35%,35%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,40%,40%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,45%,45%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(210,50%,50%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(215,50%,50%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(220,50%,50%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(225,50%,50%); text-shadow: 0 0 20px\",\n\t\t\t\t\t\t\t\t\t\t\"color: hsl(230,50%,50%); text-shadow: 0 0 20px\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'oldFooter':\n\t\t\t\t\t\t\tif (settings.oldFooter) {\n\t\t\t\t\t\t\t\t$('head').append($('<link id=\"pi-oldfooter-CSS\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.old_footer+'\">'));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$('#pi-oldfooter-CSS').remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'smallHistory':\n\t\t\t\t\t\t\tif (settings.smallHistory) {\n\t\t\t\t\t\t\t\t$('head').append($('<link id=\"pi-smallHistory-CSS\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.small_history+'\">'));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$('#pi-smallHistory-CSS').remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'smallFriends':\n\t\t\t\t\t\t\tif (settings.smallFriends) {\n\t\t\t\t\t\t\t\t$('head').append($('<link id=\"pi-smallFriends-CSS\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.small_friends+'\">'));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$('#pi-smallFriends-CSS').remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'smallPlaylists':\n\t\t\t\t\t\t\tif (settings.smallPlaylists) {\n\t\t\t\t\t\t\t\t$('head').append($('<link id=\"pi-smallPlaylists-CSS\" rel=\"stylesheet\" type=\"text/css\" href=\"'+url.styles.small_playlists+'\">'));\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t$('#pi-smallPlaylists-CSS').remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tvoteAlert: function(data) {\n\t\t\t\t\tlet userInfo = (settings.userInfo ? ' Lvl:'+data.user.level+'|'+'Id:'+data.user.id : '');\n\t\t\t\t\tif (typeof data.vote == 'undefined' && data.user.grab && settings.userGrab) {\n\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\tpi._tool.replaceString(lang.log.grabbed, {\n\t\t\t\t\t\t\t\tuser: data.user.username,\n\t\t\t\t\t\t\t\t\"userInfo\": userInfo\n\t\t\t\t\t\t\t}), 'chat'\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (data.vote == 1 && !data.user.grab && settings.userWoot) {\n\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\tpi._tool.replaceString(lang.log.wooted, {\n\t\t\t\t\t\t\t\tuser: data.user.username,\n\t\t\t\t\t\t\t\t\"userInfo\": userInfo\n\t\t\t\t\t\t\t}), 'chat'\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (data.vote == -1 && settings.userMeh && pi._tool.getRoomRules('allowShowingMehs')) {\n\t\t\t\t\t\tpi._tool.log(\n\t\t\t\t\t\t\tpi._tool.replaceString(lang.log.meh, {\n\t\t\t\t\t\t\t\tuser: data.user.username,\n\t\t\t\t\t\t\t\t\"userInfo\": userInfo\n\t\t\t\t\t\t\t}), 'chat'\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tpi._load();\n\t\t}\n\t}\n\telse {\n\t\tvar waitForARoom = function() {\n\t\t\tif (location.pathname === '/dashboard' && location.origin.indexOf('plug') !== -1)\n\t\t\t\tsetTimeout(function() {waitForARoom();}, 1000);\n\t\t\telse load();\n\t\t}\n\n\t\ttry {\n\t\t\t// If not on plug, this will fail\n\t\t\tAPI.enabled;\n\t\t\t// else, will wait for user to go in a room\n\t\t\twaitForARoom();\n\t\t} catch(err) {\n\t\t\tconsole.log('You are trying to run Plug-It outside of plug.dj !');\n\t\t\tconsole.log(err);\n\t\t}\n\t}\n})();\n\n// Placed outside of closure to ensure eval can't access private vars\nfunction execute(code, log, executeWarn) {\n\tif (sessionStorage.getItem('trustWarn') == 'false') {\n\t\tsessionStorage.setItem('trustWarn', 'true');\n\t\tpi._tool.log(executeWarn, 'warn chat', function() { execute(code, this); this.delete(); });\n\t} else {\n\t\ttry {\n\t\t\teval(code);\n\t\t\tif (typeof log !== 'undefined') log.delete();\n\t\t} catch(err) {\n\t\t\tpi._tool.log(err.toString(), 'error chat');\n\t\t\t// put code back so user can try again\n\t\t\tsetTimeout(function(){\n\t\t\t\t$('#chat-input-field')[0].value = '/js ' + code;\n\t\t\t}, 250);\n\t\t}\n\t}\n}\n"],"names":["execute","code","log","executeWarn","sessionStorage","getItem","setItem","pi","_tool","this","delete","eval","err","toString","setTimeout","$","value","_v","_version","pre","indexOf","split","major","minor","patch","version","branch","root","load","updateStatus","txt","status","innerHTML","getLastCommit","url","callback","ajax","success","data","error","e","console","init","meldBefore","object","property","cb","const","originalFunction","arguments","call","remove","sudo","originalUser","modules","user","toJSON","set","id","guest","level","role","API","ROLE","HOST","gRole","silent","originalRoom","_","pick","room","joined","minChatLevel","originalMax","Math","max","getSocket","window","rcs","plugSock","sock","WebSocket","socket","send","prototype","CHAT_INTERCEPT_STRING","chatFacade","sendChat","lang","ranks","startTime","Date","getTime","delay","getUser","MANAGER","random","script","styles","blue_css","menu_css","popout","popout_blue","custom_ranks","old_chat","old_footer","small_history","small_friends","small_playlists","images","background","sounds","notification","jingle","visu","emotes","twitch","twitchSub","betterDiscord","betterTTV","tasty","settings","autoW","autoDJ","keyboardShortcuts","chatCommands","autoHideLogs","autoHideLogsAfter","betterMeh","navWarn","afk","afkMessage","showVotes","betterClearChatLimit","chatLimit","skipNextMediaInHistory","showVideo","scVisu","roomStyle","CSS","customRanks","languageFlags","friendsIcons","customBG","customBGURL","oldChat","oldFooter","smallHistory","smallFriends","smallPlaylists","showDeletedMsg","confirmDelete","gRoleCmdSelfDel","userInfo","stuckSkip","songLimit","songLength","historyAlert","systemNotifications","songStats","userJoin","userLeave","boothAlert","boothPosition","userMeh","userGrab","guestJoin","guestLeave","friendRoomChange","friendConnect","friendDisconnect","unfriended","friendEventsList","whiteList","active","blacklist","users","3537523","roomChange","connect","disconnect","gainNotification","minimumGain","xp","pp","userLevelUp","bot","discordbot","roomSettings","cooldown","afkResponder","voteShortcut","session","unread","floodAPI","woots","getUsers","filter","x","vote","grabs","grab","mehs","chat","Number","spaceOut","isNaN","replace","_event","advance","song","autojoin","dj","media","autowoot","ceil","soundcloudVisu","replaceString","info","lastPlay","username","author","title","score","positive","negative","hasPermission","BOUNCER","cid","getMedia","userchat","songStuck","moderateForceSkip","duration","getWaitListPosition","getNextMedia","inHistory","getActivePlaylist","type","JSON","stringify","beforeID","ids","nextMediaSkip","warn","nextMediaInHistory","dataType","contentType","msg","let","selector","sender","uid","length","className","prepend","glossary","on","find","style","display","moderateDeleteChat","off","preventDefault","shiftKey","modal","getRank","message","$strobe","append","strobeOn","strobeOff","$rainbow","rainbowOn","rainbowOff","a","b","menu","sound","getRoomRules","un","mention","document","hasFocus","notify","notifications","mentioned","text","reply","onclick","focus","close","onerror","hasClass","each","css","one","removeClass","getRoomName","onfocus","undefined","push","chatCommand","cmd","args","shift","slice","join","lastMention","getAttribute","noLastMention","i","uInt","setInterval","clearInterval","helpUserOrId","getUserByName","addFriendByID","gift","userNotFound","encoded","forEach","charCodeAt","eta","file","csv","attr","encodeURIComponent","click","setVolume","setPlugSettings","helpVol","dom","children","newBot","splice","removedBot","addedBot","removedDiscordBot","addedDiscordBot","self","NONE","noSufficentPermissions","time","pop","tool","selfKick","staffKick","kicking","moderateKickUser","BOUCNER","lastArg","toLowerCase","BAN","PERMA","selfBan","staffBan","DAY","HOUR","moderateBanUser","APIFloodInEffect","MUTE","LONG","selfMute","staffMute","MEDIUM","SHORT","method","userID","reason","roleID","COHOST","DJ","cannotRank","getDJ","youPlay","thisSong","grabed","checkingPlaylists","getPlaylists","playlists","getPlaylist","playlist","edit","checkingState","current","total","name","ee","ii","aa","isGrabed","notGrabed","changeType","excludedPL","match","skip","foundDuplicate","allSongs","allSongsPL","checkingDuplicates","j","duplicates","name1","name2","possibleDuplicate","duplicateFinished","noDuplicates","unlistedCommand","worstRegexp","toRename","pl","checkingStateRename","found","test","checkingRemoving","item","index","array","cleanAuthor","trim","cleanTitle","substr","labelChanged","newAuthor","newTitle","doneRenaming","songs","renaming","noRenaming","unavailableMove","cmdSettings","logToChat","logToFile","moveToTop","moveToBottom","confirm","BrokenSongsChangeSettings","logToConsole","consoleLog","chatLog","fileLog","moveTop","moveBottom","deleteSongs","checkingUnavailable","get","passed","format","items","brokenSong","source","SC","track","uploadStatus","Object","keys","moveMedia","direction","top","bottom","removeMedia","unavailableFinished","download","noUnavailable","me","piRole","none","whoami","rawun","blurb","language","profile","avatar","avatarID","badge","lvl","toUTCString","plugRole","plugitRole","rank","sub","silver","lastIndexOf","whois","slug","friend","isTrusted","_reload","_close","help","earn","amount","gain","totalXP","totalPP","minXP","minPP","friendJoin","grabUpdate","voteAlert","totalGuest","guests","historyUpdate","medias","djSkip","cannotSkipFinished","removeCallback","djInHistory","historydj","turns","modSkip","mod","scoreUpdate","leave","userSkip","voteUpdate","waitListUpdate","waitList","pos","getPlugSettings","chatSound","Audio","play","_modulesEvent","chatReceive","before","GLOBAL_ROLE","ADMIN","AMBASSADOR","MODERATOR","PLOT","PROMOTER","emoji","replace_colons","class","flag","Lang","languages","betterClearChat","previousMsgs","emojiRE","RegExp","exec","emote","texts","chatDelete","p","c","secret","String","fromCharCode","parseInt","mi","$chat","closest","utils","getSimpleTimestamp","$prevDelete","addClass","newCount","html","after","streamDisabled","plugOptions","_DOMEvent","chatAutocompletion","collideRanks","groupDetect","nextUntil","slideToggle","key","getVolume","ctrlKey","targetUser","innerText","fastBan","fastBanHelp","now","playlistID","historyID","playback","responseJSON","playlistFull","cannotGrab","responseText","cannotGetMediaID","post","backDivSelector","is","blur","levelPercentage","numbers","percentage","parseFloat","toFixed","dialogText","leaving","event","returnValue","open","$tyles","volumeWheel","resize","availWidth","innerWidth","availHeight","innerHeight","n","bgTop","min","videoOnly","width","height","BAR_HEIGHT","originalEvent","deltaY","translate","target","classList","contains","removeAttribute","encodeURI","translatedText","parse","setAttribute","add","_load","require","s","contexts","defined","obj","_moduleID","_events","context","STATE","RoomEvent","attributes","hostID","_l","defaultSettings","hasOwnProperty","SHOW","ShowDialogEvent","GiftSendDialog","defaults","_position","User","_extendAPI","plugSocketHook","originalChatDelete","onbeforeunload","updateRoomSettings","ls","localStorage","userSettings","userItem","saveSettings","friendsOnline","getFriends","friends","friendsInStorage","inArray","sad","count","storage","isInArray","friendRoomChangeDashboard","link","div","dispatch","JOIN","friendConnectDashboard","roomURL","location","pathname","checkIfRoomChanged","position","left","z-index","general","autoWoot","autoJoin","autoHidelogsLabel","muteMeh","afkResponderPlaceholder","navigationWarn","clearChatLimitLabel","chatLimitLabel","skipNextMediaHistory","customisation","hideVideo","customStyle","moderation","confirmChatDeletion","userInformation","skipStuckSongs","songLimitPlaceholder","boothPositionLabel","userWoot","gainNotificationMinXPLabel","gainNotificationMinPPLabel","about","getReadableVersion","developedBy","plug-profile","followUs","twitter","joinDiscord","discord","rateExtension","reportBug","shutdown","modToolbar","forced","kill","rmvDJ","removeDJ","forceSkip","toggle","tagName","$openMenus","not","nextSibling","easing","next","AutoHideLogsAfter","getSelection","removeAllRanges","afkMsg","prompt","trigger","save","tooltip","offset","y","tooltips","clearChat","transform","toggleStream","votes","toElement","woot","keyShortcut","video","bg","lengthA","mehA","gainNotificationMinXP","gainNotificationMinPP","DelChat","stream","loaded","preRelease","opacity","getRoomSettings","reloading","getScript","scriptURL","keydown","mousewheel","show","visibility","GUEST_JOIN","GUEST_LEAVE","EARN","moderateForceQuit","enabled","Error","u","getUserByID","messages","friendRequest","customName","showGiftDialog","currentPL","allPL","m","_read","PL","itemCount","applyRoomSettings","rule","import","rule2","$roomStyle","toggleStyle","checkForUpdates","isForced","thisCommit","sha","forcingReload","updateAvailable","whatsnew","commit","cache","thisPL","sort","localeCompare","json","result","subVersion","which","rules","getJSON","roomSettingsLoaded","meta","description","re","scriptName","cannotLoadScriptRoomSettings","loop","isRank","loadEmote","tastycat","template","small","image_id","unknown_emotes","channel","channels","regex","placeType","emoticon","timestamp","chatTimestamps","h","getHours","getMinutes","am","$logBox","Array","isArray","scrollTop","scrollHeight","scrollIntoView","fadeOut","methods","newType","toggleClass","newNode","icon","createElement","parseHTML","replaceChild","firstChild","cbArgs","submit","changeBG","$dialog","cancel","defaultURL","customBGTitle","additionalBackgrounds","otherChoices","customBGDisclaimer","alt","dataset","src","confirmDeleteTitle","hide","content","events","options","body","Notification","that","onConnect","WS","arg","ws","defer","advice","PPEarned","XPEarned","APIFloodDetected","d","string","toUpperCase","option","model","list","$votes","piVotes","$tooltip","originalPlaceholder","placeholder","disabled","inputDisabled","djJoin","autoJoin1","autoJoin2","autoJoin3","toArray","isDefault","notInWaitList","getTimeRemaining","etaH","floor","etaM","etaS","etasS","confirmSkip","hideStream","choice","permission","requestPermission","restoreVol","vol","ADVANCE","mute","once","confirmEject","$scFrame","$myFrame","randomVisu","$roomLink","WiBla","listen","rulesTheWorld","isOnFire","grabbed","wooted","meh","href","jQuery","right","text-align","padding","color","border-radius","box-shadow","transition","statusText","waitForARoom","origin"],"mappings":"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"}